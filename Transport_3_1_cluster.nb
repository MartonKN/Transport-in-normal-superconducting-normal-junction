(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    314238,       7764]
NotebookOptionsPosition[    312959,       7722]
NotebookOutlinePosition[    313338,       7739]
CellTagsIndexPosition[    313295,       7736]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   StyleBox[
    RowBox[{"System", " ", "parameters"}], "Title"], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClusterRunQ", "=", "1"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "If", " ", "the", " ", "simulation", " ", "is", " ", "run", " ", "on", 
      " ", "the", " ", "cluster"}], ",", " ", 
     RowBox[{"no", " ", "plots", " ", "are", " ", "allowed"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nxmaxBCS", "=", "12"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"SC", " ", "profile", " ", 
     RowBox[{"calculation", ":", " ", 
      RowBox[{"highest", " ", 
       RowBox[{"harm", ".", " ", "osc", ".", " ", "channel"}], " ", "in", " ",
        "the", " ", "x", " ", "direction"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nzmaxBCS", " ", "=", " ", "12"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"SC", " ", "profile", " ", 
     RowBox[{"calculation", ":", " ", 
      RowBox[{"highest", " ", 
       RowBox[{"harm", ".", " ", "osc", ".", " ", "channel"}], " ", "in", " ",
        "the", " ", "z", " ", "direction"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nChBCS", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"nxmaxBCS", "+", "1"}], ")"}], 
      RowBox[{"(", 
       RowBox[{"nzmaxBCS", "+", "1"}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nxmaxTr", "=", "25"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Transport", " ", 
     RowBox[{"calculation", ":", " ", 
      RowBox[{"highest", " ", 
       RowBox[{"harm", ".", " ", "osc", ".", " ", "channel"}], " ", "in", " ",
        "the", " ", "x", " ", "direction"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nzmaxTr", " ", "=", " ", "2"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Transport", " ", 
     RowBox[{"calculation", ":", " ", 
      RowBox[{"highest", " ", 
       RowBox[{"harm", ".", " ", "osc", ".", " ", "channel"}], " ", "in", " ",
        "the", " ", "z", " ", "direction"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nChTr", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
      RowBox[{"(", 
       RowBox[{"nzmaxTr", "+", "1"}], ")"}]}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Nxmax", "=", "0"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "highest", " ", "COM", " ", "channel", " ", "in", " ", "which", " ", "we",
      " ", "consider", " ", "superconductivity", " ", "in", " ", "the", " ", 
     "x", " ", "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Nzmax", "=", "0"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "highest", " ", "COM", " ", "channel", " ", "in", " ", "which", " ", "we",
      " ", "consider", " ", "superconductivity", " ", "in", " ", "the", " ", 
     "z", " ", "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tStart", "=", 
     RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Measure", " ", "time", " ", "consumed", " ", "by", " ", "the", " ", 
     "computation"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Channel", " ", "parameters"}], "Text"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Clear", "[", 
     RowBox[{
     "Vg", ",", "Vg0", ",", "\[Nu]x0", ",", "\[Nu]z0", ",", "\[Omega]x", ",", 
      "\[Omega]z"}], "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mass", " ", "=", " ", 
     FractionBox[
      RowBox[{"6", " ", 
       SuperscriptBox["10", 
        RowBox[{"-", "3"}]]}], 
      RowBox[{"6", " ", 
       SuperscriptBox["10", "23"]}]]}], 
    RowBox[{"(*", "kg", "*)"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"hbar", " ", "=", " ", 
     FractionBox[
      RowBox[{"6.626", " ", 
       SuperscriptBox["10", 
        RowBox[{"-", "34"}]]}], 
      RowBox[{"2", "\[Pi]"}]]}], " ", 
    RowBox[{"(*", "Js", "*)"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"a0", "=", 
     RowBox[{"0.52917721067", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "10"}]]}]}], " ", 
    RowBox[{"(*", "m", "*)"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Bohr", " ", "radius"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kB", " ", "=", " ", 
     RowBox[{"1.38064852", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "23"}]]}]}], " ", 
    RowBox[{"(*", 
     RowBox[{"J", "/", "K"}], "*)"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Boltzmann", " ", "constant"}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"a", " ", "=", "  ", 
     RowBox[{
      RowBox[{"-", "10621"}], " ", "a0"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Scattering", " ", "length"}], "Code"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Mu]", " ", "=", " ", 
     RowBox[{"3.91", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "7"}]], " ", "kB"}]}], " ", 
    RowBox[{"(*", "K", "*)"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"T", " ", "=", 
     RowBox[{"6.37", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "8"}]], " ", "kB"}]}], " ", 
    RowBox[{"(*", "K", "*)"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"experimental", " ", "temperature"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"widths", " ", "of", " ", "confining", " ", "beam"}], " ", "*)"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dV", " ", "=", " ", 
     RowBox[{"18.1", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}]}], " ", 
    RowBox[{"(*", "m", "*)"}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dz", " ", "=", " ", 
     RowBox[{"21.2", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}]}], " ", 
    RowBox[{"(*", "m", "*)"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dx", " ", "=", " ", 
     RowBox[{"5.6", " ", 
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]]}]}], " ", 
    RowBox[{"(*", "m", "*)"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Gate", " ", "and", " ", "confining", " ", "potentials"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Vg", "[", "y_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "Vg0", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Vg0", " ", "=", "  ", 
         RowBox[{"8.75", " ", 
          SuperscriptBox["10", "3"]}]}], " ", 
        RowBox[{"(*", 
         RowBox[{"Hz", " ", "=", " ", 
          RowBox[{"0.42", " ", "\[Mu]K"}]}], "*)"}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"Vg0", " ", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", 
            SuperscriptBox["y", "2"]}], "/", 
           SuperscriptBox["dV", "2"]}], "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}]}]}], " ", 
      "\[IndentingNewLine]", "]"}]}], ";"}], "  ", 
   RowBox[{"(*", " ", 
    RowBox[{"Gate", " ", "potential"}], " ", "*)"}], " ", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Omega]z", "[", "y_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Nu]z0", ",", "\[Nu]zBg"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Nu]zBg", "=", "150"}], 
        RowBox[{"(*", "Hz", "*)"}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Nu]z0", "  ", "=", " ", 
         RowBox[{"9.2", " ", 
          SuperscriptBox["10", "3"]}]}], " ", 
        RowBox[{"(*", "Hz", "*)"}], ";", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Nu]zBg", "+", 
           RowBox[{"\[Nu]z0", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", 
               SuperscriptBox["y", "2"]}], "/", 
              SuperscriptBox["dz", "2"]}], "]"}]}]}], ")"}], 
         RowBox[{"(", 
          RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "  ", 
   RowBox[{"(*", " ", 
    RowBox[{"z", " ", "confinement"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Omega]x", "[", "y_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Nu]x0", ",", "\[Nu]xBg"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Nu]xBg", "=", "195"}], 
        RowBox[{"(*", "Hz", "*)"}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Nu]x0", " ", "=", " ", 
         RowBox[{"12.5", " ", 
          SuperscriptBox["10", "3"]}]}], " ", 
        RowBox[{"(*", "Hz", "*)"}], ";", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Nu]xBg", "+", 
           RowBox[{"\[Nu]x0", " ", 
            RowBox[{"Exp", "[", 
             RowBox[{
              RowBox[{"-", 
               SuperscriptBox["y", "2"]}], "/", 
              SuperscriptBox["dx", "2"]}], "]"}]}]}], ")"}], " ", 
         RowBox[{"(", 
          RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "  ", 
   RowBox[{"(*", " ", 
    RowBox[{"x", " ", "confinement"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Oscillator", " ", "lengths"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lx", "[", "y_", "]"}], " ", ":=", " ", 
     SqrtBox[
      FractionBox["hbar", 
       RowBox[{"mass", " ", 
        RowBox[{
         RowBox[{"\[Omega]x", "[", "y", "]"}], "/", "hbar"}]}]]]}], ";", "  ", 
    RowBox[{
     RowBox[{"lz", "[", "y_", "]"}], " ", ":=", " ", 
     SqrtBox[
      FractionBox["hbar", 
       RowBox[{"mass", " ", 
        RowBox[{
         RowBox[{"\[Omega]z", "[", "y", "]"}], "/", "hbar"}]}]]]}], ";"}], 
   "  ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Note", ":", " ", 
      RowBox[{
      "I", " ", "use", " ", "a", " ", "somewhat", " ", "clumsy", " ", 
       "notation", " ", 
       RowBox[{"here", ".", " ", "\[Omega]x"}], " ", "and", " ", "\[Omega]z", 
       " ", "are", " ", "of", " ", "dimension", " ", "energy", " ", "and", 
       " ", "not", " ", "freqency"}]}], ",", " ", 
     RowBox[{
     "and", " ", "they", " ", "actually", " ", "denote", " ", "hbar", " ", 
      "\[Omega]x", " ", "and", " ", "hbar", " ", 
      RowBox[{"\[Omega]z", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Fermi", " ", "wavelength"}], "Text"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kF", " ", "=", " ", 
     FractionBox[
      SqrtBox[
       RowBox[{"2", " ", "mass", " ", "\[Mu]"}]], "hbar"]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Fermi", " ", "wavelength"}], " ", "*)"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{"\[Lambda]F", "=", 
     FractionBox[
      RowBox[{"2", "\[Pi]", " "}], "kF"]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Fermi", " ", "wavelength", " ", "in", " ", "the", " ", "3", "D", " ", 
     RowBox[{"leads", ":", " ", 
      RowBox[{"natural", " ", "unit", " ", "of", " ", "length"}]}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"vF", "=", 
     FractionBox[
      RowBox[{"hbar", " ", "kF"}], "mass"]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Fermi", " ", "velocity"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kFa", " ", "=", " ", 
     RowBox[{"kF", " ", "a"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Interaction", " ", "strength"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Channel", " ", "length"}], "Text"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ymaxBCS", " ", "=", " ", 
     RowBox[{"2.25", "dx"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"SC", " ", "profile", " ", "calculation"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yminBCS", " ", "=", 
     RowBox[{"-", "ymaxBCS"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ymaxTr", " ", "=", " ", 
     RowBox[{"1.5", "dz"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Transport", " ", "calculation"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"yminTr", "=", 
     RowBox[{"-", "ymaxTr"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Filenames", " ", "for", " ", "saving"}], "Text"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"saveFilename", " ", "=", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{
            RowBox[{"NotebookFileName", "[", "]"}], ",", "\"\<.nb\>\""}], 
           "]"}], "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "<>", "\"\<_\>\""}]}], ";"}], "\[IndentingNewLine]", ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"saveFilename", " ", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"StringSplit", "[", 
           RowBox[{"$InputFileName", ",", "\"\<.m\>\""}], "]"}], 
          "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "<>", 
         "\"\<_\>\""}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ParamsFilename", "=", 
     RowBox[{"saveFilename", "<>", "\"\<params.m\>\""}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SmxFilename", "=", 
     RowBox[{"saveFilename", "<>", "\"\<tS.dat\>\""}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Common", " ", "definitions", " ", "for", " ", "both", " ", 
      "calculations"}], "Title"], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Matrix", " ", "elements"}], "Subsubsection"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Phi]n", "[", 
      RowBox[{"n_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       FractionBox[
        RowBox[{"Exp", "[", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"x", "^", "2"}]}], "/", "2"}], "]"}], 
        SqrtBox[
         RowBox[{
          SuperscriptBox["2", "n"], 
          RowBox[{"n", "!"}], " ", 
          SqrtBox["\[Pi]"]}]]], 
       RowBox[{"HermiteH", "[", 
        RowBox[{"n", ",", "x"}], "]"}]}], ")"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Hermite", " ", "function", " ", "in", " ", "lab", " ", "frame"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Phi]\[Nu]", "[", 
      RowBox[{"\[Nu]_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       FractionBox["1", 
        SuperscriptBox["2", 
         RowBox[{"1", "/", "4"}]]], 
       RowBox[{"\[Phi]n", "[", 
        RowBox[{"\[Nu]", ",", 
         FractionBox["x", 
          SqrtBox["2"]]}], "]"}]}], ")"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Hermite", " ", "function", " ", "in", " ", "relative", " ", 
     "coordinates"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]_", "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Mod", "[", 
         RowBox[{"\[Nu]", ",", "2"}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"-", "1"}], ")"}], 
         RowBox[{"\[Nu]", "/", "2"}]], 
        SqrtBox[
         FractionBox[
          RowBox[{"Binomial", "[", 
           RowBox[{"\[Nu]", ",", 
            RowBox[{"\[Nu]", "/", "2"}]}], "]"}], 
          RowBox[{
           SqrtBox[
            RowBox[{"2", "\[Pi]"}]], 
           SuperscriptBox["2", "\[Nu]"]}]]]}], ",", "0"}], "]"}]}], ";"}], 
   " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]", "]"}], " ", "\[Equal]", " ", 
     RowBox[{"\[Phi]\[Nu]", "[", 
      RowBox[{"\[Nu]", ",", "0"}], "]"}]}], " ", "*)"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"mxElement", "[", 
       RowBox[{"n1", ",", "n2", ",", "N", ",", "\[Nu]"}], "]"}], "\[Equal]", 
      "<", "n1"}], ",", 
     RowBox[{"n2", "|", "N"}], ",", 
     RowBox[{"\[Nu]", ">"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mxElement", "[", 
      RowBox[{"n1_", ",", "n2_", ",", "\[CapitalNu]_", ",", "\[Nu]_"}], "]"}],
      " ", ":=", " ", 
     RowBox[{"(", 
      RowBox[{
       SqrtBox[
        FractionBox[
         RowBox[{
          RowBox[{"n1", "!"}], " ", 
          RowBox[{"n2", "!"}]}], 
         RowBox[{
          RowBox[{"\[CapitalNu]", "!"}], " ", 
          RowBox[{"\[Nu]", "!"}]}]]], 
       FractionBox["1", 
        SqrtBox[
         SuperscriptBox["2", 
          RowBox[{"\[CapitalNu]", "+", "\[Nu]"}]]]], 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"\[Nu]", "\[GreaterEqual]", "n1"}], ",", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"-", "1"}], ")"}], 
           RowBox[{"n1", "-", "\[Nu]"}]], 
          RowBox[{"Binomial", "[", 
           RowBox[{"\[Nu]", ",", "n1"}], "]"}], 
          RowBox[{"Hypergeometric2F1", "[", 
           RowBox[{
            RowBox[{"-", "n1"}], ",", 
            RowBox[{"-", "\[CapitalNu]"}], ",", 
            RowBox[{"\[Nu]", "-", "n1", "+", "1"}], ",", 
            RowBox[{"-", "1"}]}], "]"}]}], ",", " ", 
         RowBox[{
          RowBox[{"Binomial", "[", 
           RowBox[{"\[CapitalNu]", ",", 
            RowBox[{"n1", "-", "\[Nu]"}]}], "]"}], 
          RowBox[{"Hypergeometric2F1", "[", 
           RowBox[{
            RowBox[{"-", "\[Nu]"}], ",", 
            RowBox[{"n1", "-", "\[Nu]", "-", "\[CapitalNu]"}], ",", 
            RowBox[{"n1", "-", "\[Nu]", "+", "1"}], ",", 
            RowBox[{"-", "1"}]}], "]"}]}]}], "]"}]}], ")"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"VCl", "[", 
      RowBox[{"NCM_", ",", "n1_", ",", "n2_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"n1", "+", "n2"}], "\[GreaterEqual]", "NCM"}], ",", 
       RowBox[{
        RowBox[{"mxElement", "[", 
         RowBox[{"n1", ",", "n2", ",", "NCM", ",", 
          RowBox[{"n1", "+", "n2", "-", "NCM"}]}], "]"}], 
        RowBox[{"\[Phi]\[Nu]0", "[", 
         RowBox[{"n1", "+", "n2", "-", "NCM"}], "]"}]}], ",", "0"}], "]"}]}], 
    ";"}], " ", "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     SuperscriptBox[
      SubscriptBox["V", "N"], 
      RowBox[{
       SubscriptBox["n", "1"], 
       SubscriptBox["n", "2"]}]], " ", "matrix", " ", "in", " ", "my", " ", 
     RowBox[{"calculations", " ", "--"}], " ", "same", " ", "for", " ", "x", 
     " ", "and", " ", "z", " ", "directions"}], " ", "*)"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Definitions", " ", "for", " ", "the", " ", "BCS", " ", "calculation"}], 
     "Title"], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Ordering", " ", "of", " ", 
      RowBox[{"(", 
       RowBox[{"nx", ",", "nz"}], ")"}], " ", "channels"}], "Subsubsection"], 
    " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"i2nxnzBCS", "[", "i_", "]"}], " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Floor", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"i", "-", "1"}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"nzmaxBCS", "+", "1"}], ")"}]}], "]"}], ",", " ", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{"i", "-", "1"}], ",", " ", 
         RowBox[{"nzmaxBCS", "+", "1"}]}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nxnz2iBCS", "[", "nxnz_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"nxnz", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
        "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"nzmaxBCS", "+", "1"}], ")"}], " ", 
        RowBox[{
        "nxnz", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"indBCS", " ", "=", " ", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"nx", ",", "nz"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"nx", ",", "0", ",", "nxmaxBCS"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"nz", ",", "0", ",", "nzmaxBCS"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nxmaxBCS", "+", "1"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"nzmaxBCS", "+", "1"}], ")"}]}], ",", "2"}], "}"}]}], 
      "]"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Array", " ", "of", " ", "all", " ", "indices"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Checked", " ", "the", " ", "above", " ", "functions", " ", 
     "numerically"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Matrix", " ", "elements"}], "Subsubsection"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"VNBCS", " ", "=", " ", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Nxmax", "+", "1"}], ",", 
         RowBox[{"Nzmax", "+", "1"}], ",", "nChBCS", ",", "nChBCS"}], "}"}]}],
       "]"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"VNBCS", "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"Nx", "+", "1"}], ",", 
        RowBox[{"Nz", "+", "1"}], ",", "i1", ",", "i2"}], 
       "\[RightDoubleBracket]"}], " ", "=", " ", 
      SuperscriptBox[
       SubscriptBox["V", 
        RowBox[{"(", 
         RowBox[{"Nx", ",", "Nz"}], ")"}]], "n1n2"]}], ",", " ", 
     RowBox[{
      RowBox[{"with", " ", "n1"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"i2nxnzBCS", "[", "i1", "]"}], " ", "and", " ", "n2"}], "=", 
       RowBox[{
        RowBox[{"i2nxnzBCS", "[", "i2", "]"}], "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"For", "[", 
     RowBox[{
      RowBox[{"iNx", "=", "0"}], ",", 
      RowBox[{"iNx", "\[LessEqual]", "Nxmax"}], ",", 
      RowBox[{"iNx", "++"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"iNz", "=", "0"}], ",", 
         RowBox[{"iNz", "\[LessEqual]", "Nzmax"}], ",", 
         RowBox[{"iNz", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i1", "=", "1"}], ",", 
            RowBox[{"i1", "\[LessEqual]", "nChBCS"}], ",", 
            RowBox[{"i1", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"nx1", ",", "nz1"}], "}"}], "=", 
              RowBox[{"i2nxnzBCS", "[", "i1", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"i2", "=", "1"}], ",", 
               RowBox[{"i2", "\[LessEqual]", "nChBCS"}], ",", 
               RowBox[{"i2", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"nx2", ",", "nz2"}], "}"}], "=", 
                 RowBox[{"i2nxnzBCS", "[", "i2", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"VNBCS", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{"iNx", "+", "1"}], ",", 
                   RowBox[{"iNz", "+", "1"}], ",", "i1", ",", "i2"}], 
                  "\[RightDoubleBracket]"}], " ", "=", 
                 RowBox[{"(", " ", 
                  RowBox[{
                   RowBox[{"VCl", "[", 
                    RowBox[{"iNx", ",", "nx1", ",", "nx2"}], "]"}], " ", 
                   RowBox[{"VCl", "[", 
                    RowBox[{"iNz", ",", "nz1", ",", "nz2"}], "]"}]}], ")"}]}],
                 ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"VNind", ":", " ", 
     RowBox[{
     "Auxiliary", " ", "array", " ", "containing", " ", "those", " ", 
      "elements", " ", "of", " ", "V", " ", "that", " ", "are", " ", "not", 
      " ", "zero"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"VNind", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Nxmax", "+", "1"}], ",", 
         RowBox[{"Nzmax", "+", "1"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"For", "[", 
     RowBox[{
      RowBox[{"iNx", "=", "0"}], ",", 
      RowBox[{"iNx", "\[LessEqual]", "Nxmax"}], ",", 
      RowBox[{"iNx", "++"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"iNz", "=", "0"}], ",", 
         RowBox[{"iNz", "\[LessEqual]", "Nzmax"}], ",", 
         RowBox[{"iNz", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"i1", "=", "1"}], ",", 
            RowBox[{"i1", "\[LessEqual]", "nChBCS"}], ",", 
            RowBox[{"i1", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"For", "[", 
              RowBox[{
               RowBox[{"i2", "=", "1"}], ",", 
               RowBox[{"i2", "\[LessEqual]", "nChBCS"}], ",", 
               RowBox[{"i2", "++"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Abs", "[", 
                    RowBox[{"VNBCS", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"iNx", "+", "1"}], ",", 
                    RowBox[{"iNz", "+", "1"}], ",", "i1", ",", "i2"}], 
                    "\[RightDoubleBracket]"}], "]"}], ">", "0"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"VNind", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"iNx", "+", "1"}], ",", 
                    RowBox[{"iNz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                    "=", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"VNind", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"iNx", "+", "1"}], ",", 
                    RowBox[{"iNz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", "i2"}], "}"}], "}"}]}], "}"}], ",", 
                    "1"}], "]"}]}], ";"}]}], "]"}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], "\n", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Bound", " ", "state", " ", "energy"}], "Subsubsection"], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"w", "[", 
      RowBox[{"\[Alpha]_", ",", "\[Omega]x_", ",", "\[Omega]z_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[Nu]xMax", ",", "\[Nu]zMax", ",", "A", ",", "I1", ",", "I2", ",", 
         "I3", ",", "I4", ",", "I5", ",", "f2", ",", "f2S", ",", 
         "\[Delta]\[Alpha]2", ",", "x0", ",", "maxPow2", ",", "coeffs2", ",", 
         "s2", ",", "s3", ",", "f3", ",", "x3max", ",", "\[Epsilon]"}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Nu]xMax", " ", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", 
             RowBox[{"Ceiling", "[", " ", 
              RowBox[{"\[Alpha]", " ", 
               SqrtBox[
                FractionBox["\[Omega]z", "\[Omega]x"]]}], "]"}]}], "]"}], "+",
            "2"}], ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Nu]zMax", " ", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", 
             RowBox[{"Ceiling", "[", " ", 
              RowBox[{"\[Alpha]", " ", 
               SqrtBox[
                FractionBox["\[Omega]x", "\[Omega]z"]]}], "]"}]}], "]"}], "+",
            "2"}], ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"A", " ", "=", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{
            FractionBox["1", "2"], 
            RowBox[{"(", 
             RowBox[{
              SqrtBox[
               FractionBox["\[Omega]x", "\[Omega]z"]], "+", 
              SqrtBox[
               FractionBox["\[Omega]z", "\[Omega]x"]]}], ")"}]}], "+", 
           "\[Alpha]", "-", 
           RowBox[{"4", "\[Pi]", " ", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]x", "]"}], "]"}], "^", 
               "2"}], ",", 
              RowBox[{"{", 
               RowBox[{"\[Nu]x", ",", "0", ",", "\[Nu]xMax", ",", "2"}], 
               "}"}]}], "]"}], "  ", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]z", "]"}], "]"}], "^", 
               "2"}], ",", 
              RowBox[{"{", 
               RowBox[{"\[Nu]z", ",", "0", ",", "\[Nu]zMax", ",", "2"}], 
               "}"}]}], "]"}]}]}], ")"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"I1", "=", 
         RowBox[{"(", 
          RowBox[{"2", "A"}], ")"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
           "I2", " ", "usually", " ", "oscillates", " ", "heavily", " ", 
            "around", " ", "x"}], "\[Rule]", "0"}], ",", " ", 
          RowBox[{
          "we", " ", "thus", " ", "create", " ", "its", " ", "series", " ", 
           "form"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f2", "[", "x_", "]"}], ":=", 
         RowBox[{
          FractionBox["1", 
           SqrtBox["x"]], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"\[Alpha]", " ", "x"}], "]"}], 
             SqrtBox[
              FractionBox[
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   SqrtBox[
                    FractionBox["\[Omega]x", "\[Omega]z"]], "+", 
                   SqrtBox[
                    FractionBox["\[Omega]z", "\[Omega]x"]]}], ")"}], "x"}], 
                "]"}], 
               RowBox[{
                RowBox[{"Sinh", "[", 
                 RowBox[{
                  SqrtBox[
                   FractionBox["\[Omega]x", "\[Omega]z"]], "x"}], "]"}], 
                RowBox[{"Sinh", "[", 
                 RowBox[{
                  SqrtBox[
                   FractionBox["\[Omega]z", "\[Omega]x"]], "x"}], "]"}]}]]]}],
             "-", 
            FractionBox["1", "x"], "-", "A", "-", 
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"\[Alpha]", " ", "x"}], "]"}], "4", "\[Pi]", " ", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Abs", "[", 
                  RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]x", "]"}], "]"}], "^", 
                 "2"}], " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", "x"}], " ", "\[Nu]x", " ", 
                  SqrtBox[
                   FractionBox["\[Omega]x", "\[Omega]z"]]}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Nu]x", ",", "0", ",", "\[Nu]xMax", ",", "2"}], 
                "}"}]}], "]"}], " ", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Abs", "[", 
                  RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]z", "]"}], "]"}], "^", 
                 "2"}], " ", 
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", "x"}], " ", "\[Nu]z", " ", 
                  SqrtBox[
                   FractionBox["\[Omega]z", "\[Omega]x"]]}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Nu]z", ",", "0", ",", "\[Nu]zMax", ",", "2"}], 
                "}"}]}], "]"}]}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"maxPow2", "=", "3"}], ";", "\[IndentingNewLine]", 
        RowBox[{"s2", "=", 
         RowBox[{"Series", "[", 
          RowBox[{
           RowBox[{"f2", "[", "x0", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x0", ",", "0", ",", "maxPow2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"coeffs2", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"SeriesCoefficient", "[", 
            RowBox[{"s2", ",", 
             RowBox[{"i", "-", 
              RowBox[{"1", "/", "2"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "maxPow2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f2S", "[", "x_", "]"}], ":=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
            "coeffs2", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
             " ", 
            SuperscriptBox["x", 
             RowBox[{"i", "-", 
              RowBox[{"1", "/", "2"}]}]]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "maxPow2"}], "}"}]}], "]"}]}], ";", 
        " ", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"f2S", "[", "1", "]"}], "-", 
              RowBox[{"Normal", "[", "s2", "]"}]}], "/.", 
             RowBox[{"x0", "\[Rule]", "1"}]}], "]"}], ">", 
           SuperscriptBox["10", 
            RowBox[{"-", "5"}]]}], ",", 
          RowBox[{
          "Print", "[", 
           "\"\<Taylor expansion in function w[] unreliable.\>\"", "]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Taylor", " ", "series", " ", "approximation", " ", "to", " ", 
           RowBox[{
            RowBox[{"f2", "[", "]"}], ".", " ", "Negative"}], " ", "powers", 
           " ", "are", " ", "due", " ", "to", " ", "numerical", " ", 
           "error"}], ",", " ", 
          RowBox[{"and", " ", "are", " ", "thus", " ", "cut", " ", 
           RowBox[{"off", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Delta]\[Alpha]2", "=", "0.001"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"I2", " ", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"NIntegrate", "[", 
            RowBox[{
             RowBox[{"f2", "[", "x", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "\[Delta]\[Alpha]2", ",", "1"}], "}"}], ",", 
             RowBox[{"AccuracyGoal", "\[Rule]", "5"}]}], "]"}], " ", "+", " ", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              FractionBox[
               RowBox[{
               "coeffs2", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}], 
               RowBox[{"i", "+", 
                RowBox[{"1", "/", "2"}]}]], " ", 
              SuperscriptBox["\[Delta]\[Alpha]2", 
               RowBox[{"i", "+", 
                RowBox[{"1", "/", "2"}]}]]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "maxPow2"}], "}"}]}], "]"}]}], 
          ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
           "The", " ", "integrand", " ", "of", " ", "I3", " ", "is", " ", 
            "also", " ", "numerically", " ", "unstable", " ", "for", " ", 
            "x"}], "\[Rule]", "\[Infinity]"}], ",", " ", 
          RowBox[{
          "we", " ", "thus", " ", "substitute", " ", "it", " ", "with", " ", 
           "its", " ", "Taylor", " ", "expansion", " ", "at", " ", "large", 
           " ", "x", " ", 
           RowBox[{"values", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"x3max", "=", 
         RowBox[{"Max", "[", 
          RowBox[{
           FractionBox["10", 
            RowBox[{
             RowBox[{"2", " ", "\[Nu]xMax", " ", 
              SqrtBox[
               RowBox[{"\[Omega]x", "/", "\[Omega]z"}]]}], "-", "\[Alpha]"}]],
            ",", 
           FractionBox["10", 
            RowBox[{
             RowBox[{"2", " ", "\[Nu]zMax", " ", 
              SqrtBox[
               RowBox[{"\[Omega]z", "/", "\[Omega]x"}]]}], "-", "\[Alpha]"}]],
            ",", "2"}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Number", " ", "between", " ", "2", " ", "and", " ", "5"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"s3", "=", 
         RowBox[{"Normal", "[", 
          RowBox[{"Series", "[", 
           RowBox[{
            SqrtBox[
             FractionBox["1", 
              RowBox[{"1", "-", "\[Epsilon]"}]]], ",", 
            RowBox[{"{", 
             RowBox[{"\[Epsilon]", ",", "0", ",", 
              RowBox[{"Max", "[", 
               RowBox[{"\[Nu]xMax", ",", "\[Nu]zMax", ",", "3"}], "]"}]}], 
             "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f3", "[", "x_", "]"}], ":=", 
         RowBox[{"Expand", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"Exp", "[", 
             RowBox[{"\[Alpha]", " ", "x"}], "]"}], 
            SqrtBox["x"]], 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"2", 
              RowBox[{"(", 
               RowBox[{"s3", "/.", 
                RowBox[{"\[Epsilon]", "\[Rule]", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], 
                   SqrtBox[
                    FractionBox["\[Omega]x", "\[Omega]z"]], "x"}], "]"}]}]}], 
               ")"}], 
              RowBox[{"(", 
               RowBox[{"s3", "/.", 
                RowBox[{"\[Epsilon]", "\[Rule]", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "2"}], 
                   SqrtBox[
                    FractionBox["\[Omega]z", "\[Omega]x"]], "x"}], "]"}]}]}], 
               ")"}]}], "-", 
             RowBox[{"4", "\[Pi]", " ", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Abs", "[", 
                   RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]x", "]"}], "]"}], "^", 
                  "2"}], " ", 
                 RowBox[{
                  RowBox[{"Abs", "[", 
                   RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]z", "]"}], "]"}], "^", 
                  "2"}], " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{
                   RowBox[{"-", "x"}], 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"\[Nu]x", " ", 
                    SqrtBox[
                    FractionBox["\[Omega]x", "\[Omega]z"]]}], " ", "+", " ", 
                    RowBox[{"\[Nu]z", " ", 
                    SqrtBox[
                    FractionBox["\[Omega]z", "\[Omega]x"]]}]}], ")"}]}], 
                  "]"}]}], " ", ",", 
                RowBox[{"{", 
                 RowBox[{"\[Nu]x", ",", "0", ",", "\[Nu]xMax", ",", "2"}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\[Nu]z", ",", "0", ",", "\[Nu]zMax", ",", "2"}], 
                 "}"}]}], "]"}]}]}], ")"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"I3", " ", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"NIntegrate", "[", 
            RowBox[{
             RowBox[{
              FractionBox[
               RowBox[{"Exp", "[", 
                RowBox[{"\[Alpha]", " ", "x"}], "]"}], 
               SqrtBox["x"]], 
              RowBox[{"(", 
               RowBox[{
                SqrtBox[
                 FractionBox["4", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", "2"}], 
                    SqrtBox[
                    FractionBox["\[Omega]x", "\[Omega]z"]], "x"}], "]"}]}], 
                    ")"}], 
                   RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", "2"}], 
                    SqrtBox[
                    FractionBox["\[Omega]z", "\[Omega]x"]], "x"}], "]"}]}], 
                    ")"}]}]]], "-", 
                RowBox[{"4", "\[Pi]", " ", 
                 RowBox[{"Sum", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]x", "]"}], "]"}], "^", 
                    "2"}], " ", 
                    RowBox[{
                    RowBox[{"Abs", "[", 
                    RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]z", "]"}], "]"}], "^", 
                    "2"}], " ", 
                    RowBox[{"Exp", "[", 
                    RowBox[{
                    RowBox[{"-", "x"}], 
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{"\[Nu]x", " ", 
                    SqrtBox[
                    FractionBox["\[Omega]x", "\[Omega]z"]]}], " ", "+", " ", 
                    RowBox[{"\[Nu]z", " ", 
                    SqrtBox[
                    FractionBox["\[Omega]z", "\[Omega]x"]]}]}], ")"}]}], 
                    "]"}]}], " ", ",", 
                   RowBox[{"{", 
                    RowBox[{"\[Nu]x", ",", "0", ",", "\[Nu]xMax", ",", "2"}], 
                    "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"\[Nu]z", ",", "0", ",", "\[Nu]zMax", ",", "2"}], 
                    "}"}]}], "]"}]}]}], ")"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "1", ",", "x3max"}], "}"}], ",", 
             RowBox[{"AccuracyGoal", "\[Rule]", "5"}]}], "]"}], "+", 
           RowBox[{"NIntegrate", "[", 
            RowBox[{
             RowBox[{"f3", "[", "x", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "x3max", ",", "\[Infinity]"}], "}"}], ",", 
             RowBox[{"AccuracyGoal", "\[Rule]", "5"}]}], "]"}]}], ")"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{"f3", "[", "x", "]"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"x", ",", "x3max", ",", "\[Infinity]"}], "}"}], ",", " ", 
            RowBox[{"AccuracyGoal", "\[Rule]", "5"}]}], "]"}], " ", "takes", 
          " ", "up", " ", "most", " ", "of", " ", "the", " ", "computational",
           " ", 
          RowBox[{"time", "."}]}], " ", "*)"}], " ", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Currently", " ", "the", " ", "runtime", " ", "is", " ", "not", " ",
            "so", " ", "bad"}], ",", " ", 
          RowBox[{
          "but", " ", "if", " ", "once", " ", "I", " ", "need", " ", "to", 
           " ", "speed", " ", "up", " ", "this", " ", "function", " ", "then",
            " ", "I", " ", "should", " ", "evaluate", " ", "this", " ", 
           "particular", " ", "integral", " ", 
           RowBox[{"analytically", ".", " ", "This"}], " ", "can", " ", "be", 
           " ", "done", " ", 
           RowBox[{"easily", "."}]}]}], " ", "*)"}], " ", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"I4", " ", "=", " ", 
         RowBox[{"-", "2"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"I5", " ", "=", 
         RowBox[{"(", 
          RowBox[{"\[ImaginaryI]", " ", 
           SqrtBox["\[Pi]"], " ", "4", "\[Pi]", " ", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]x", "]"}], "]"}], "^", 
               "2"}], " ", 
              RowBox[{
               RowBox[{"Abs", "[", 
                RowBox[{"\[Phi]\[Nu]0", "[", "\[Nu]z", "]"}], "]"}], "^", 
               "2"}], " ", 
              FractionBox["1", 
               SqrtBox[
                RowBox[{"\[Alpha]", "-", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"\[Nu]x", " ", 
                    SqrtBox[
                    FractionBox["\[Omega]x", "\[Omega]z"]]}], "+", 
                   RowBox[{"\[Nu]z", " ", 
                    SqrtBox[
                    FractionBox["\[Omega]z", "\[Omega]x"]]}]}], ")"}]}]]]}], 
             " ", ",", 
             RowBox[{"{", 
              RowBox[{"\[Nu]x", ",", "0", ",", "\[Nu]xMax", ",", "2"}], "}"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"\[Nu]z", ",", "0", ",", "\[Nu]zMax", ",", "2"}], 
              "}"}]}], "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{"I1", "+", "I2", "+", "I3", "+", "I4", "+", "I5"}], 
         ")"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"EB", "[", 
      RowBox[{"\[Omega]x_", ",", "\[Omega]z_", ",", "a_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x0", ",", "f", ",", "lx", ",", "lz", ",", "\[Alpha]points", ",", 
         "points", ",", "\[Alpha]", ",", "\[Epsilon]B", ",", "wAppr"}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Energy", " ", "of", " ", "the", " ", "bound", " ", "state", " ", 
          "in", " ", "the", " ", 
          RowBox[{"(", 
           RowBox[{"Nx", ",", "Nz"}], ")"}]}], "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"0", ",", "0"}], ")"}], " ", "channel", " ", "at", " ", 
          "trapping", " ", "frequencies", " ", 
          RowBox[{"(", 
           RowBox[{"\[Omega]x", ",", "\[Omega]z"}], ")"}], " ", "and", " ", 
          "scattering", " ", "length", " ", "a"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "We", " ", "subtract", " ", "the", " ", "singular", " ", "part", 
           " ", "of", " ", "w", " ", "both", " ", "for", " ", "\[Alpha]"}], 
          "\[Rule]", 
          RowBox[{
           RowBox[{"0", " ", "and", " ", "for", " ", "\[Alpha]"}], "\[Rule]", 
           
           RowBox[{"\[Infinity]", ".", " ", "Then"}]}]}], ",", " ", 
         RowBox[{
         "the", " ", "rest", " ", "is", " ", "approximated", " ", "by", " ", 
          RowBox[{"interpolation", "."}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "The", " ", "resulting", " ", "function", " ", "can", " ", "be", " ", 
         "evaluated", " ", "much", " ", 
         RowBox[{"faster", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lx", "=", 
         SqrtBox[
          FractionBox["hbar", 
           RowBox[{"mass", " ", 
            RowBox[{"\[Omega]x", "/", "hbar"}]}]]]}], ";", " ", 
        RowBox[{"lz", "=", 
         SqrtBox[
          FractionBox["hbar", 
           RowBox[{"mass", " ", 
            RowBox[{"\[Omega]z", "/", "hbar"}]}]]]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Note", " ", "that", " ", "I", " ", "use", " ", "a", " ", 
           "somewhat", " ", "clumsy", " ", "notation", " ", 
           RowBox[{"here", ".", " ", "\[Omega]x"}], " ", "and", " ", 
           "\[Omega]z", " ", "are", " ", "of", " ", "dimension", " ", 
           "energy", " ", "and", " ", "not", " ", "freqency"}], ",", " ", 
          RowBox[{
          "and", " ", "they", " ", "actually", " ", "denote", " ", "hbar", 
           " ", "\[Omega]x", " ", "and", " ", "hbar", " ", 
           RowBox[{"\[Omega]z", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"\[Alpha]points", " ", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "300"}], 
            RowBox[{"Table", "[", 
             RowBox[{
              SuperscriptBox["x", "2"], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "0", ",", "1", ",", "0.02"}], "}"}]}], 
             "]"}]}], "-", "0.0001"}], ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"points", " ", "=", " ", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "\[Alpha]points", "\[LeftDoubleBracket]", "i", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"Re", "[", 
              RowBox[{
               RowBox[{
                FractionBox["1", 
                 SqrtBox[
                  RowBox[{"4", "\[Pi]"}]]], 
                RowBox[{"w", "[", 
                 RowBox[{
                  RowBox[{
                  "\[Alpha]points", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], ",", "\[Omega]x", ",", 
                  "\[Omega]z"}], "]"}]}], "-", 
               FractionBox["1", 
                SqrtBox[
                 RowBox[{"Abs", "[", 
                  RowBox[{
                  "\[Alpha]points", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "]"}]]], "+", 
               SqrtBox[
                RowBox[{
                 RowBox[{"Abs", "[", 
                  RowBox[{
                  "\[Alpha]points", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "]"}], "+", "1"}]]}], "]"}]}], 
            "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "\[Alpha]points", "]"}]}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"f", "=", 
         RowBox[{"Interpolation", "[", "points", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"wAppr", "[", "\[Alpha]_", "]"}], ":=", 
         RowBox[{
          SqrtBox[
           RowBox[{"4", "\[Pi]"}]], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Quiet", "@", 
             RowBox[{"f", "[", "\[Alpha]", "]"}]}], "+", 
            FractionBox["1", 
             SqrtBox[
              RowBox[{"Abs", "[", "\[Alpha]", "]"}]]], "-", 
            SqrtBox[
             RowBox[{
              RowBox[{"Abs", "[", "\[Alpha]", "]"}], "+", "1"}]]}], ")"}]}]}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]B", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"\[Alpha]", "/.", 
             RowBox[{"FindRoot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 FractionBox["1", 
                  SqrtBox[
                   RowBox[{"4", "\[Pi]"}]]], 
                 RowBox[{"wAppr", "[", "\[Alpha]", "]"}]}], "\[Equal]", 
                RowBox[{"-", 
                 FractionBox[
                  SqrtBox[
                   RowBox[{"lx", " ", "lz"}]], "a"]}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[Alpha]", ",", 
                 RowBox[{"-", "0.5"}], ",", 
                 RowBox[{"-", "600"}], ",", 
                 RowBox[{"-", "0.000001"}]}], "}"}]}], "]"}]}], ")"}], 
           SqrtBox[
            RowBox[{"\[Omega]x", " ", "\[Omega]z"}]]}], ")"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Finds", " ", "the", " ", "approximate", " ", "bound", " ", "state", " ", 
     "energy", " ", "at", " ", "scattering", " ", "length", " ", 
     RowBox[{"a", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Works", " ", "very", " ", "well", " ", "for", " ", 
       RowBox[{"a", "/", 
        SqrtBox[
         RowBox[{"lx", " ", "lz"}]]}]}], ">", 
      RowBox[{"0.1", " ", "and", " ", "for", " ", "a"}], "<", 
      RowBox[{
      "0", " ", "but", " ", "very", " ", "badly", " ", "for", " ", "0"}], "<", 
      RowBox[{"a", "/", 
       SqrtBox[
        RowBox[{"lx", " ", "lz"}]]}], "<", 
      RowBox[{"0.1", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"weakly", " ", "interacting", " ", "BEC"}], ")"}], ".", " ", 
        "\[IndentingNewLine]", "Since"}], " ", "we", " ", "are", " ", 
       "interested", " ", "in", " ", "the", " ", "BCS", " ", "side"}]}], ",", 
     " ", 
     RowBox[{"this", " ", "is", " ", 
      RowBox[{"fine", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox["Hamiltonian", "Subsubsection"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Function", " ", "providing", " ", "the", " ", "Hamiltonians", " ", "and",
      " ", "their", " ", "diagonalization", " ", "matrices"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Note", " ", "that", " ", "the", " ", "chemical", " ", "potential", " ", 
      "\[Mu]", " ", "is", " ", "the", " ", "absolute", " ", "one"}], ",", " ", 
     RowBox[{
     "not", " ", "the", " ", "one", " ", "measured", " ", "from", " ", "the", 
      " ", "bottom", " ", "of", " ", "the", " ", "lowest", " ", "harmonic", 
      " ", "oscillator", " ", "channel"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Hamiltonians", "[", 
      RowBox[{
      "q_", ",", "\[Omega]x_", ",", "\[Omega]z_", ",", "\[Mu]_", ",", "Vg_", 
       ",", "\[CapitalDelta]0_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[Xi]", ",", "\[CapitalDelta]", ",", "Nxmax\[CapitalDelta]", ",", 
         "Nzmax\[CapitalDelta]", ",", "iNx", ",", "iNz", ",", "H", ",", 
         "\[Mu]1", ",", "\[Epsilon]", ",", "U", ",", "ord", ",", "P", ",", 
         "UP", ",", "\[Epsilon]P", ",", "u", ",", "v"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Mu]1", " ", "=", 
         RowBox[{"(", " ", 
          RowBox[{"\[Mu]", "+", "Vg", "-", 
           FractionBox[
            RowBox[{"\[Omega]x", "+", "\[Omega]z"}], "2"]}], ")"}]}], ";", 
        " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Chemical", " ", "potential", " ", "measured", " ", "from", " ", 
          "the", " ", "bottom", " ", "of", " ", "the", " ", "lowest", " ", 
          "harmonic", " ", "oscillator", " ", "channel"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"\[Xi]", " ", "=", 
         RowBox[{"(", 
          RowBox[{
           FractionBox[
            RowBox[{
             SuperscriptBox["hbar", "2"], 
             SuperscriptBox["q", "2"]}], 
            RowBox[{"2", " ", "mass"}]], " ", "+", " ", 
           RowBox[{"indBCS", ".", 
            RowBox[{"{", 
             RowBox[{"\[Omega]x", ",", "\[Omega]z"}], "}"}]}], "-", 
           "\[Mu]1"}], ")"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"\[CapitalDelta]", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"nChBCS", ",", "nChBCS"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Nxmax\[CapitalDelta]", ",", "Nzmax\[CapitalDelta]"}], 
          "}"}], "=", 
         RowBox[{"Dimensions", "[", "\[CapitalDelta]0", "]"}]}], ";", " ", 
        RowBox[{"Nxmax\[CapitalDelta]", "-=", "1"}], ";", " ", 
        RowBox[{"Nzmax\[CapitalDelta]", "-=", "1"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"iNx", "=", "0"}], ",", 
          RowBox[{"iNx", "\[LessEqual]", "Nxmax\[CapitalDelta]"}], ",", 
          RowBox[{"iNx", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"iNz", "=", "0"}], ",", 
             RowBox[{"iNz", "\[LessEqual]", "Nzmax\[CapitalDelta]"}], ",", 
             RowBox[{"iNz", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"\[CapitalDelta]", "=", 
               RowBox[{"(", 
                RowBox[{"\[CapitalDelta]", "+", 
                 RowBox[{
                  RowBox[{"\[CapitalDelta]0", "\[LeftDoubleBracket]", 
                   RowBox[{
                    RowBox[{"iNx", "+", "1"}], ",", 
                    RowBox[{"iNz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                  " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"VNBCS", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"iNx", "+", "1"}], ",", 
                    RowBox[{"iNz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                    ")"}], "\[ConjugateTranspose]"}]}]}], ")"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"H", " ", "=", " ", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {
              RowBox[{"DiagonalMatrix", "[", "\[Xi]", "]"}], 
              "\[CapitalDelta]"},
             {
              RowBox[{"\[CapitalDelta]", "\[ConjugateTranspose]"}], 
              RowBox[{"DiagonalMatrix", "[", 
               RowBox[{"-", 
                RowBox[{"\[Xi]", "\[Conjugate]"}]}], "]"}]}
            }], ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", "Eigensystem", " ", "*)"}], "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Epsilon]", ",", "U"}], "}"}], "=", 
         RowBox[{"Eigensystem", "[", "H", "]"}]}], ";", " ", 
        RowBox[{"U", " ", "=", " ", 
         RowBox[{"U", "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]", "=", 
         RowBox[{"Re", "@", "\[Epsilon]"}]}], ";", " ", "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
           "Order", " ", "the", " ", "eigenstates", " ", "such", " ", "that", 
            " ", "the", " ", "\[Epsilon]"}], "=", 
           RowBox[{"{", 
            RowBox[{"\[Epsilon]0", ",", 
             RowBox[{"-", "\[Epsilon]0"}]}], "}"}]}], ",", " ", 
          RowBox[{
           RowBox[{"with", " ", "\[Epsilon]0"}], ">", "0."}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"ord", " ", "=", " ", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Ordering", "[", 
              RowBox[{"-", "\[Epsilon]"}], "]"}], "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", "nChBCS"}], "\[RightDoubleBracket]"}], ",", 
            RowBox[{
             RowBox[{"Ordering", "[", "\[Epsilon]", "]"}], 
             "\[LeftDoubleBracket]", 
             RowBox[{"1", ";;", "nChBCS"}], "\[RightDoubleBracket]"}]}], 
           "}"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"P", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "nChBCS"}], ",", 
             RowBox[{"2", "nChBCS"}]}], "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Permutation", " ", "matrix"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i1", "=", "1"}], ",", 
          RowBox[{"i1", "\[LessEqual]", 
           RowBox[{"2", "nChBCS"}]}], ",", 
          RowBox[{"i1", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"P", "\[LeftDoubleBracket]", 
             RowBox[{"i1", ",", 
              RowBox[{
              "ord", "\[LeftDoubleBracket]", "i1", 
               "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], "=", 
            "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"UP", "=", 
         RowBox[{"U", ".", 
          RowBox[{"P", "\[ConjugateTranspose]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]P", "=", 
         RowBox[{"Diagonal", "[", 
          RowBox[{"P", ".", 
           RowBox[{"DiagonalMatrix", "[", "\[Epsilon]", "]"}], ".", 
           RowBox[{"P", "\[ConjugateTranspose]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Define", " ", "parts", " ", "of", " ", "the", " ", "unitary", " ", 
          "transformation"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"u", "=", 
         RowBox[{"UP", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "nChBCS"}], ",", 
           RowBox[{"1", ";;", "nChBCS"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"v", "=", 
         RowBox[{"-", 
          RowBox[{"UP", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"nChBCS", "+", "1"}], ")"}], ";;", 
             RowBox[{"2", " ", "nChBCS"}]}], ",", 
            RowBox[{"1", ";;", "nChBCS"}]}], "\[RightDoubleBracket]"}]}]}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"UP", "=", 
         RowBox[{"ArrayFlatten", "@", 
          RowBox[{"(", GridBox[{
             {"u", 
              RowBox[{"v", "\[Conjugate]"}]},
             {
              RowBox[{"-", "v"}], 
              RowBox[{"u", "\[Conjugate]"}]}
            }], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"\[Xi]", ",", "H", ",", "\[Epsilon]P", ",", "UP"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"U", ".", 
       RowBox[{"DiagonalMatrix", "[", "\[Epsilon]", "]"}], ".", 
       RowBox[{"U", "\[ConjugateTranspose]"}]}], " ", "\[Equal]", " ", "H"}], 
     ",", " ", 
     RowBox[{"U", " ", "is", " ", "unitary", " ", 
      RowBox[{"(", 
       RowBox[{
       "and", " ", "real", " ", "if", " ", "\[CapitalDelta]", " ", "is", " ", 
        "real"}], ")"}]}], ",", " ", 
     RowBox[{
      RowBox[{
      "and", " ", "it", " ", "is", " ", "of", " ", "the", " ", "form", " ", 
       "U"}], " ", "\[Equal]", " ", 
      RowBox[{
       RowBox[{"(", GridBox[{
          {"u", 
           RowBox[{"v", "\[Conjugate]"}]},
          {
           RowBox[{"-", "v"}], 
           RowBox[{"u", "\[Conjugate]"}]}
         }], ")"}], "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Polynomial", " ", "interpolation"}], ",", " ", 
     RowBox[{"same", " ", "as", " ", "InterpolatingPolynomial"}], ",", " ", 
     RowBox[{"just", " ", "able", " ", "to", " ", "handle", " ", "vector"}], 
     ",", " ", 
     RowBox[{
     "matrix", " ", "and", " ", "tensor", " ", "valued", " ", "functions"}]}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"polint", "[", 
      RowBox[{"xy_", ",", "x0_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ydim", ",", "yElements", ",", "x", ",", "y", ",", "y0", ",", "i1", 
         ",", "i2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"xy", " ", "\[Equal]", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["x", "1"], ",", 
              SubscriptBox["y", "1"]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              SubscriptBox["x", "2"], ",", 
              SubscriptBox["y", "2"]}], "}"}], ",", " ", "..."}], "}"}]}], 
         ",", " ", 
         RowBox[{"where", " ", 
          SubscriptBox["y", "i"], " ", "are", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"scalar", "/", "vector"}], "/", "matrix"}], "/", 
           "tensor"}], " ", "values"}], ",", " ", 
         RowBox[{"all", " ", "the", " ", "same", " ", "dimensions"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ydim", " ", "=", " ", 
         RowBox[{"Dimensions", "[", 
          RowBox[{"xy", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"yElements", " ", "=", " ", 
         RowBox[{"Apply", "[", 
          RowBox[{"Times", ",", "ydim"}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "#elements", " ", "in", " ", "each", " ", "instance", " ", "of", " ",
           "y", " ", "is", " ", "the", " ", "product", " ", "of", " ", "the", 
          " ", "elements", " ", "of", " ", "ydim"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"x", "=", 
         RowBox[{"xy", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"y", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"xy", "\[LeftDoubleBracket]", 
           RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"y0", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", "yElements"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i1", "=", "1"}], ",", 
          RowBox[{"i1", "\[LessEqual]", "yElements"}], ",", 
          RowBox[{"i1", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
            "y0", "\[LeftDoubleBracket]", "i1", "\[RightDoubleBracket]"}], 
            "=", 
            RowBox[{"InterpolatingPolynomial", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                  "x", "\[LeftDoubleBracket]", "i2", 
                   "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"y", "\[LeftDoubleBracket]", 
                   RowBox[{"i1", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i2", "-", "1"}], ")"}], "yElements"}]}], 
                   "\[RightDoubleBracket]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i2", ",", "1", ",", 
                  RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}], ",", 
              "x0"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"y0", "=", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{"y0", ",", "ydim"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Romberg", " ", "integration", " ", "procedure", " ", 
      RowBox[{"a", "'"}], "la", " ", "Numerical", " ", 
      RowBox[{"Recipies", ".", "   ", 
       RowBox[{"qromb", "[", 
        RowBox[{"f", ",", "a", ",", "b"}], "]"}]}]}], "=", 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["\[Integral]", "a"], "b"], 
      RowBox[{"dx", " ", 
       RowBox[{"f", "[", "x", "]"}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "qromb", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AccuracyGoal", "\[Rule]", " ", "10"}], ",", 
       RowBox[{"MaxRecursion", "\[Rule]", "20"}], ",", 
       RowBox[{"MinRecursion", "\[Rule]", "5"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qromb", "::", "maxit"}], "=", 
     "\"\<Err: maximal number of integration steps reached.\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qromb", "[", 
      RowBox[{"f_", ",", "a_", ",", "b_", ",", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "JMIN", ",", "JMAX", ",", "EPS", ",", "k", ",", "s", ",", "h", ",", 
         "hs", ",", "s0", ",", "s1", ",", "\[CapitalDelta]s", ",", "\[Delta]",
          ",", "j"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"EPS", ":", " ", 
         RowBox[{"Required", " ", "precision"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"JMAX", ":", " ", 
         RowBox[{"Maximum", " ", "number", " ", "of", " ", "iterations"}]}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"JMIN", ":", " ", 
          RowBox[{"Minimum", " ", "number", " ", "of", " ", "iterations"}]}], 
         ",", " ", 
         RowBox[{
         "which", " ", "has", " ", "nevertheless", " ", "to", " ", "be", " ", 
          "at", " ", "least", " ", "k"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"k", "=", "5"}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Degree", " ", "of", " ", "fitting", " ", "polynomial"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"EPS", "=", 
         SuperscriptBox["10", 
          RowBox[{"-", 
           RowBox[{"Abs", "[", 
            RowBox[{"OptionValue", "[", "AccuracyGoal", "]"}], "]"}]}]]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"JMIN", " ", "=", " ", 
         RowBox[{"Max", "[", 
          RowBox[{
           RowBox[{"OptionValue", "[", "MinRecursion", "]"}], ",", "k"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"JMAX", " ", "=", " ", 
         RowBox[{"Max", "[", 
          RowBox[{
           RowBox[{"OptionValue", "[", "MaxRecursion", "]"}], ",", "JMIN"}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"s", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"JMAX", "+", "1"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Array", " ", "for", " ", "successive", " ", "approximations", " ", 
          "to", " ", "the", " ", "integral"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"h", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"JMAX", "+", "1"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Step", " ", "size", " ", "of", " ", "the", " ", "integral"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"hs", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", "2"}], "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Latest", " ", 
          RowBox[{"{", 
           RowBox[{"h", ",", "s"}], "}"}], " ", "values", " ", "for", " ", 
          "polynomial", " ", "fitting"}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"s0", "=", "\[Infinity]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"h", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "=", "1.0"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         " ", "=", " ", 
         RowBox[{"0.5", 
          RowBox[{"(", 
           RowBox[{"b", "-", "a"}], ")"}], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"f", "[", "a", "]"}], "+", 
            RowBox[{"f", "[", "b", "]"}]}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Delta]", "=", 
         RowBox[{"b", "-", "a"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"j", "=", "2"}], ",", 
          RowBox[{"j", "\[LessEqual]", 
           RowBox[{"JMAX", "+", "1"}]}], ",", 
          RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
            "s", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], "=", 
            
            RowBox[{"0.5", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"s", "\[LeftDoubleBracket]", 
                RowBox[{"j", "-", "1"}], "\[RightDoubleBracket]"}], "+", 
               RowBox[{"\[Delta]", " ", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"f", "[", "x", "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", 
                    RowBox[{"a", "+", 
                    RowBox[{"0.5", " ", "\[Delta]"}]}], ",", 
                    RowBox[{"b", "-", 
                    RowBox[{"0.5", " ", "\[Delta]"}]}], ",", "\[Delta]"}], 
                   "}"}]}], "]"}]}]}], ")"}]}]}], ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Next", " ", "step", " ", "of", " ", "Romberg", " ", 
             "integration"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
            "h", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], "=", 
            
            RowBox[{"0.25", 
             RowBox[{"h", "\[LeftDoubleBracket]", 
              RowBox[{"j", "-", "1"}], "\[RightDoubleBracket]"}]}]}], ";", 
           " ", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"This", " ", "step", " ", "is", " ", 
              RowBox[{"crucial", ":", " ", 
               RowBox[{
               "even", " ", "though", " ", "we", " ", "halved", " ", "the", 
                " ", "stepsize"}]}]}], ",", " ", 
             RowBox[{"the", " ", "factor", " ", "is", " ", "0.25"}], ",", " ", 
             RowBox[{
             "since", " ", "the", " ", "Simpson", " ", "formula", " ", "has", 
              " ", "quadratic", " ", "error", " ", 
              RowBox[{"term", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"\[Delta]", "/=", "2"}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{"Halve", " ", "the", " ", "step", " ", "size"}], " ", 
            "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"j", "+", "1"}], ">", "k"}], ",", " ", 
             RowBox[{"(*", " ", 
              RowBox[{
              "Do", " ", "polynomial", " ", "fitting", " ", "for", " ", "the",
                " ", "last", " ", "values", " ", "available"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"hs", "\[LeftDoubleBracket]", 
                RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "=", 
               RowBox[{"h", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"j", "-", "k", "+", "1"}], ";;", "j"}], 
                "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"hs", "\[LeftDoubleBracket]", 
                RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "=", 
               RowBox[{"s", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"j", "-", "k", "+", "1"}], ";;", "j"}], 
                "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"s1", " ", "=", " ", 
               RowBox[{"polint", "[", 
                RowBox[{"hs", ",", "0.0"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"\[CapitalDelta]s", "=", 
               RowBox[{"Abs", "[", 
                RowBox[{"s1", "-", "s0"}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", "\[CapitalDelta]s", "]"}], 
                    "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                    "<", 
                    RowBox[{"EPS", "  ", 
                    RowBox[{"Abs", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "s1", "]"}], 
                    "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
                    "]"}]}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"Flatten", "@", "\[CapitalDelta]s"}]}]}], "}"}]}],
                   "]"}], "&&", " ", 
                 RowBox[{"j", "\[GreaterEqual]", "JMIN"}]}], ",", 
                RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"s0", "=", "s1"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"j", "\[Equal]", 
           RowBox[{"JMAX", "+", "1"}]}], ",", 
          RowBox[{"Message", "[", 
           RowBox[{"qromb", "::", "maxit"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "s1"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"Checked", " ", "numerically"}], " ", "-", " ", 
      RowBox[{"benchmarked", " ", "against", " ", "NIntegrate"}]}], ",", " ", 
     
     RowBox[{
      RowBox[{"using", " ", "also", " ", "multi"}], "-", 
      RowBox[{"dimensional", " ", "functions"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dy", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"ymaxBCS", "-", "yminBCS"}], ")"}], "/", "11"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"y", " ", "=", 
     RowBox[{"Table", "[", 
      RowBox[{"y", ",", 
       RowBox[{"{", 
        RowBox[{"y", ",", "yminBCS", ",", "ymaxBCS", ",", "dy"}], "}"}]}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Epsilon]FMax", " ", "=", " ", 
     RowBox[{"Max", "[", 
      RowBox[{"\[Mu]", " ", "+", " ", 
       RowBox[{"Vg", "@", "y"}], " ", "-", " ", 
       FractionBox[
        RowBox[{
         RowBox[{"\[Omega]x", "@", "y"}], " ", "+", " ", 
         RowBox[{"\[Omega]z", "@", "y"}]}], "2.0"]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"qmax", " ", "=", " ", 
     RowBox[{"4.0", 
      RowBox[{
       SqrtBox[
        RowBox[{"2.0", "mass", " ", "\[Epsilon]FMax"}]], "/", "hbar"}]}]}], 
    ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Upper", " ", "limit", " ", "of", " ", "q"}], "-", 
     "integration"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RegularizingIntegral", "[", 
      RowBox[{"\[Omega]0_", ",", "\[Omega]x_", ",", "\[Omega]z_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Reg", ",", "Nx", ",", "Nz", ",", "kF2"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "\[Omega]0", " ", "is", " ", "the", " ", "frequency", " ", "at", " ", 
         "which", " ", "we", " ", "take", " ", "the", " ", "regularizing", 
         " ", 
         RowBox[{"term", ".", " ", "It"}], " ", "is", " ", "a", " ", "good", 
         " ", "idea", " ", "to", " ", "choose", " ", "it", " ", "at", " ", 
         "the", " ", "bound", " ", "state", " ", 
         RowBox[{"energy", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"kF2", "=", 
         FractionBox[
          SqrtBox[
           RowBox[{"mass", " ", "\[Mu]"}]], "hbar"]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Reg", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Nxmax", "+", "1"}], ",", 
             RowBox[{"Nzmax", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"Nx", "=", "0"}], ",", 
          RowBox[{"Nx", "\[LessEqual]", "Nxmax"}], ",", 
          RowBox[{"Nx", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"Nz", "=", "0"}], ",", 
             RowBox[{"Nz", "\[LessEqual]", "Nzmax"}], ",", 
             RowBox[{"Nz", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Reg", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"Nx", "+", "1"}], ",", 
                 RowBox[{"Nz", "+", "1"}]}], "\[RightDoubleBracket]"}], "=", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"-", 
                  FractionBox["kF2", "\[Mu]"]}], 
                 FractionBox["1", "\[Pi]"], 
                 RowBox[{"Re", "@", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"Abs", "[", 
                    RowBox[{"VNBCS", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"Nx", "+", "1"}], ",", 
                    RowBox[{"Nz", "+", "1"}], ",", "i2", ",", "i1"}], 
                    "\[RightDoubleBracket]"}], "]"}], "2"], 
                    FractionBox[
                    RowBox[{" ", 
                    RowBox[{"ArcTan", "[", 
                    FractionBox[
                    RowBox[{"qmax", "/", "kF2"}], 
                    SqrtBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    "indBCS", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    "indBCS", "\[LeftDoubleBracket]", "i2", 
                    "\[RightDoubleBracket]"}]}], ")"}], ".", 
                    RowBox[{"{", 
                    RowBox[{
                    FractionBox["\[Omega]x", "\[Mu]"], ",", 
                    FractionBox["\[Omega]z", "\[Mu]"]}], "}"}]}], "-", 
                    FractionBox[
                    RowBox[{" ", "\[Omega]0"}], "\[Mu]"]}], ")"}]]], "]"}]}], 
                    
                    SqrtBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    "indBCS", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    "indBCS", "\[LeftDoubleBracket]", "i2", 
                    "\[RightDoubleBracket]"}]}], ")"}], ".", 
                    RowBox[{"{", 
                    RowBox[{
                    FractionBox["\[Omega]x", "\[Mu]"], ",", 
                    FractionBox["\[Omega]z", "\[Mu]"]}], "}"}]}], "-", 
                    FractionBox["\[Omega]0", "\[Mu]"]}], ")"}]]]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", "1", ",", "nChBCS"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i2", ",", "1", ",", "nChBCS"}], "}"}]}], 
                   "]"}]}]}], ")"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "Reg"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Reg", "\[LeftDoubleBracket]", 
      RowBox[{
       RowBox[{"Nx", "+", "1"}], ",", 
       RowBox[{"Nz", "+", "1"}]}], "\[RightDoubleBracket]"}], " ", "\[Equal]",
      " ", 
     RowBox[{
      RowBox[{"\[Integral]", 
       RowBox[{
        FractionBox["dq", 
         RowBox[{"2", "\[Pi]"}]], 
        RowBox[{
         SubscriptBox["\[Sum]", "n1n2"], " ", 
         RowBox[{
          FractionBox[
           RowBox[{"|", 
            SuperscriptBox[
             RowBox[{
              SubscriptBox["V", "N"], "\[ConjugateTranspose]"}], 
             RowBox[{" ", 
              RowBox[{
               SubscriptBox["n", "1"], 
               SubscriptBox["n", "2"]}]}]], 
            SuperscriptBox["|", "2"]}], 
           RowBox[{"\[Omega]0", " ", "-", " ", 
            RowBox[{"(", 
             RowBox[{
              FractionBox[
               RowBox[{
                SuperscriptBox["hbar", "2"], " ", 
                SuperscriptBox["q", "2"]}], "m"], " ", "+", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n1", "+", "n2"}], ")"}], "\[Omega]"}]}], ")"}]}]], "   ",
           "that", " ", "appears", " ", "in", " ", "the", " ", "calculation", 
          " ", "of", " ", "the", " ", "mean"}]}]}]}], "-", 
      RowBox[{"field", " ", "ground", " ", "state", " ", "energy"}]}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", 
     RowBox[{"numerically", ":", " ", 
      RowBox[{
      "compared", " ", "against", " ", "NIntegrate", " ", "and", " ", "also", 
       " ", "checked", " ", "that", " ", "it", " ", "really", " ", "removes", 
       " ", "the", " ", "singular", " ", "part", " ", "of", " ", "EMF"}]}]}], 
    " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Delta]\[Epsilon]\[Delta]fn", "[", 
      RowBox[{
      "q_", ",", "\[Omega]x_", ",", "\[Omega]z_", ",", "\[Mu]_", ",", "Vg_", 
       ",", "\[CapitalDelta]0_", ",", "T_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[Delta]fMF", ",", "\[Delta]\[Epsilon]MF", ",", "n1D", ",", "\[Xi]q",
          ",", "Eq", ",", "uq", ",", "vq", ",", "Uq", ",", "Hq", ",", "iq"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Auxiliary", " ", "function", " ", "used", " ", "by", " ", 
         RowBox[{
          RowBox[{"EFn", "[", "]"}], "."}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Xi]q", ",", "Hq", ",", "Eq", ",", "Uq"}], "}"}], " ", 
         "=", " ", 
         RowBox[{"Hamiltonians", "[", 
          RowBox[{
          "q", ",", "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", "Vg", 
           ",", "\[CapitalDelta]0"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Eq", " ", "=", " ", 
         RowBox[{"Eq", "\[LeftDoubleBracket]", 
          RowBox[{"1", ";;", "nChBCS"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"uq", "=", 
         RowBox[{"Uq", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "nChBCS"}], ",", 
           RowBox[{"1", ";;", "nChBCS"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vq", "=", 
         RowBox[{"-", 
          RowBox[{"Uq", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"nChBCS", "+", "1"}], ")"}], ";;", 
             RowBox[{"2", "nChBCS"}]}], ",", 
            RowBox[{"1", ";;", "nChBCS"}]}], "\[RightDoubleBracket]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"\[Delta]\[Epsilon]MF", " ", "=", " ", 
         FractionBox[
          RowBox[{" ", 
           RowBox[{"Total", "[", 
            RowBox[{"\[Xi]q", "-", "Eq"}], "]"}]}], 
          RowBox[{"2", "\[Pi]"}]]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Delta]fMF", "=", " ", 
         RowBox[{"-", 
          RowBox[{"(", 
           RowBox[{"T", " ", 
            FractionBox["2", 
             RowBox[{"2", "\[Pi]"}]], " ", 
            RowBox[{"Total", "@", 
             RowBox[{"Log", "[", 
              RowBox[{"1", " ", "+", " ", 
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{"-", "Eq"}], "/", "T"}], "]"}]}], "]"}]}]}], 
           ")"}]}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Factor", " ", "of", " ", "2", " ", "accounts", " ", "for", " ", 
          "the", " ", "spin"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"n1D", " ", "=", 
         RowBox[{"(", 
          RowBox[{
           FractionBox["2", 
            RowBox[{"2", "\[Pi]"}]], " ", 
           RowBox[{"Tr", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"vq", "\[ConjugateTranspose]"}], ".", "vq"}], " ", "+", 
             " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"uq", "\[ConjugateTranspose]"}], ".", "uq"}], " ", 
                "-", " ", 
                RowBox[{
                 RowBox[{"vq", "\[ConjugateTranspose]"}], ".", "vq"}]}], 
               ")"}], 
              RowBox[{"DiagonalMatrix", "[", 
               FractionBox["1", 
                RowBox[{"1", " ", "+", " ", 
                 RowBox[{"Exp", "[", 
                  RowBox[{"Eq", "/", "T"}], "]"}]}]], "]"}]}]}], "]"}]}], 
          ")"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Factor", " ", "of", " ", "2", " ", "accounts", " ", "for", " ", 
          "the", " ", "spin"}], " ", "*)"}], "        ", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"\[Delta]\[Epsilon]MF", ",", "\[Delta]fMF", ",", "n1D"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FreeEnergyAndDensity", "[", 
      RowBox[{
      "\[Omega]x_", ",", "\[Omega]z_", ",", "\[Mu]_", ",", "Vg_", ",", 
       "\[CapitalDelta]0_", ",", "T_", ",", "Reg_", ",", "\[Omega]0_", ",", 
       "a_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[CapitalDelta]FMF", ",", "FMF", ",", "\[CapitalDelta]EMF", ",", 
         "EMF", ",", "n1D", ",", "Nx", ",", "Nz", ",", "Nxmax\[CapitalDelta]",
          ",", "Nzmax\[CapitalDelta]", ",", "lx", ",", "lz"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Here", ",", " ", 
         RowBox[{
         "Reg", " ", "is", " ", "the", " ", "output", " ", "of", " ", 
          RowBox[{"RegularizingIntegral", "[", "]"}], " ", "at", " ", "the", 
          " ", "energy", " ", "\[Omega]0"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"FMF", ":", " ", 
         RowBox[{"Free", " ", "energy"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"EMF", ":", " ", 
         RowBox[{"Mean", "-", 
          RowBox[{
          "field", " ", "energy", " ", "of", " ", "the", " ", "ground", " ", 
           "state"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"n1D", ":", " ", 
         RowBox[{"1", "D", " ", "density"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"q", "-", 
         RowBox[{
         "integral", " ", "part", " ", "of", " ", "EMF", " ", "and", " ", 
          "FMF"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "\[CapitalDelta]EMF", ",", "\[CapitalDelta]FMF", ",", "n1D"}], 
          "}"}], "=", 
         RowBox[{"(", 
          RowBox[{"2", 
           RowBox[{"qromb", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Delta]\[Epsilon]\[Delta]fn", "[", 
               RowBox[{
               "#", ",", "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", 
                "Vg", ",", "\[CapitalDelta]0", ",", "T"}], "]"}], "&"}], ",", 
             "0", ",", "qmax", ",", 
             RowBox[{"MaxRecursion", "\[Rule]", "8"}], ",", 
             RowBox[{"AccuracyGoal", "\[Rule]", "10"}]}], "]"}]}], ")"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"lx", "=", 
         SqrtBox[
          FractionBox["hbar", 
           RowBox[{"mass", "  ", 
            RowBox[{"\[Omega]x", "/", "hbar"}]}]]]}], ";", 
        RowBox[{"lz", "=", 
         SqrtBox[
          FractionBox["hbar", 
           RowBox[{"mass", "  ", 
            RowBox[{"\[Omega]z", "/", "hbar"}]}]]]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Regularization", " ", "of", " ", "EMF"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"EMF", "=", "\[CapitalDelta]EMF"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Nxmax\[CapitalDelta]", ",", "Nzmax\[CapitalDelta]"}], 
          "}"}], "=", 
         RowBox[{"Dimensions", "[", "\[CapitalDelta]0", "]"}]}], ";", " ", 
        RowBox[{"Nxmax\[CapitalDelta]", "-=", "1"}], ";", " ", 
        RowBox[{"Nzmax\[CapitalDelta]", "-=", "1"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"Nx", "=", "0"}], ",", 
          RowBox[{"Nx", "\[LessEqual]", "Nxmax\[CapitalDelta]"}], ",", 
          RowBox[{"Nx", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"Nz", "=", "0"}], ",", 
             RowBox[{"Nz", "\[LessEqual]", "Nzmax\[CapitalDelta]"}], ",", 
             RowBox[{"Nz", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"EMF", "-=", 
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox[
                  RowBox[{"Abs", "[", 
                   RowBox[{"\[CapitalDelta]0", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"Nx", "+", "1"}], ",", 
                    RowBox[{"Nz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                   "]"}], "2"], " ", 
                 RowBox[{"Reg", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{"Nx", "+", "1"}], ",", 
                   RowBox[{"Nz", "+", "1"}]}], "\[RightDoubleBracket]"}]}], 
                ")"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "Regularizing", " ", "part", " ", "of", " ", "the", " ", 
                 "q"}], "-", "integral"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"EMF", "-=", 
               RowBox[{"(", 
                RowBox[{
                 FractionBox[
                  SuperscriptBox[
                   RowBox[{"Abs", "[", 
                    RowBox[{"\[CapitalDelta]0", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"Nx", "+", "1"}], ",", 
                    RowBox[{"Nz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                    "]"}], "2"], 
                  RowBox[{"4", "\[Pi]", 
                   SqrtBox[
                    RowBox[{" ", 
                    RowBox[{"\[Omega]x", " ", "\[Omega]z"}]}]]}]], " ", 
                 RowBox[{"(", 
                  RowBox[{
                   FractionBox["1", "a"], " ", "+", " ", 
                   RowBox[{
                    FractionBox["1", 
                    SqrtBox[
                    RowBox[{"4", "\[Pi]", " ", "lx", " ", "lz"}]]], 
                    RowBox[{"w", "[", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"\[Omega]0", "-", 
                    RowBox[{"Nx", " ", "\[Omega]x"}], "-", 
                    RowBox[{"Nz", " ", "\[Omega]z"}]}], 
                    SqrtBox[
                    RowBox[{"\[Omega]x", " ", "\[Omega]z"}]]], ",", 
                    "\[Omega]x", ",", "\[Omega]z"}], "]"}]}]}], ")"}]}], 
                ")"}]}], ";"}]}], " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "Interaction", " ", "effects", " ", "through", " ", "the", " ", 
              "function", " ", "w"}], " ", "*)"}], "\[IndentingNewLine]", 
            "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Free", " ", "energy"}], " ", "*)"}], "\[IndentingNewLine]", 
        
        RowBox[{"FMF", "=", 
         RowBox[{"\[CapitalDelta]FMF", "+", "EMF"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"FMF", ",", "n1D"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Checked", " ", "numerically"}], " ", "-", " ", 
     RowBox[{
     "benchmarked", " ", "against", " ", "the", " ", "previous", " ", 
      "version", " ", "in", " ", "Delta0_", "1", "D_wire", "_", "2.", 
      "nb"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Note", " ", "that", " ", "using", " ", "qromb", " ", "here", " ", "is", 
      " ", "indeed", " ", "necessary"}], ",", " ", 
     RowBox[{
     "since", " ", "NIntegrate", " ", "is", " ", "way", " ", "too", " ", 
      "slow", " ", "for", " ", 
      RowBox[{"us", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "qromb", " ", "outperforms", " ", "it", " ", "on", " ", "these", " ", 
     "simple", " ", "functions", " ", "by", " ", "a", " ", "factor", " ", 
     RowBox[{"of", " ", "~", "5"}], " ", "at", " ", 
     RowBox[{"least", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "Find\[CapitalDelta]00", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AccuracyGoal", "\[Rule]", " ", "8"}], ",", 
       RowBox[{"PrecisionGoal", "\[Rule]", "8"}], ",", 
       RowBox[{"MaxRecursion", "\[Rule]", "50"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Find\[CapitalDelta]00", "[", 
      RowBox[{
      "\[Omega]x_", ",", "\[Omega]z_", ",", "\[Mu]_", ",", "Vg_", ",", "T_", 
       ",", "a_", ",", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "f", ",", "\[CapitalDelta]00\[Mu]", ",", "\[Epsilon]B", ",", "Reg", 
         ",", "result", ",", "steps", ",", "fig", ",", "iters", ",", "acc", 
         ",", "prec"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"iters", "=", 
         RowBox[{"OptionValue", "[", "MaxRecursion", "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Maximum", " ", "number", " ", "of", " ", "functions", " ", 
          "evaluations"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"acc", "=", 
         RowBox[{"OptionValue", "[", "AccuracyGoal", "]"}]}], ";", "     ", 
        RowBox[{"(*", 
         StyleBox[" ",
          FontSize->12], 
         StyleBox[
          RowBox[{"Accuracy", " ", "goal"}],
          FontSize->12], 
         StyleBox[" ",
          FontSize->12], 
         StyleBox["*)",
          FontSize->12]}], "\[IndentingNewLine]", 
        RowBox[{"prec", "=", 
         RowBox[{"OptionValue", "[", "PrecisionGoal", "]"}]}], ";", 
        StyleBox[
         RowBox[{" ", 
          StyleBox[" ",
           FontSize->12]}]], 
        RowBox[{"(*", " ", 
         StyleBox[
          RowBox[{"Precision", " ", "goal"}],
          FontSize->12], 
         StyleBox[" ",
          FontSize->12], 
         StyleBox["*)",
          FontSize->12]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Define", " ", "free", " ", "energy", " ", "function"}], " ",
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]B", "=", 
         RowBox[{"EB", "[", 
          RowBox[{"\[Omega]x", ",", "\[Omega]z", ",", "a"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Reg", "=", 
         RowBox[{"RegularizingIntegral", "[", 
          RowBox[{"\[Epsilon]B", ",", "\[Omega]x", ",", "\[Omega]z"}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"\[CapitalDelta]00\[Mu]_", "?", "NumericQ"}], "]"}], ":=", 
         RowBox[{"Re", "@", 
          RowBox[{"First", "[", 
           FractionBox[
            RowBox[{"FreeEnergyAndDensity", "[", 
             RowBox[{
             "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", "Vg", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", "\[CapitalDelta]00\[Mu]", "}"}], "}"}], 
               "\[Mu]"}], ",", "T", ",", "Reg", ",", "\[Epsilon]B", ",", 
              "a"}], "]"}], 
            RowBox[{"kF", " ", "\[Mu]"}]], "]"}]}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "It", " ", "is", " ", "absolutely", " ", "necessary", " ", "to", " ", 
          RowBox[{"include", " ", "?", "NumericQ"}], " ", "in", " ", "the", 
          " ", 
          RowBox[{"definition", ".", " ", "Otherwise"}], " ", "FindMinimum", 
          " ", "will", " ", "try", " ", "to", " ", "substitute", " ", 
          "symbolic", " ", "values", " ", "into", " ", "our", " ", "free", 
          " ", "energy", " ", "function", " ", "and", " ", "the", " ", 
          "algorithm", " ", "will", " ", "break", " ", 
          RowBox[{"down", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "In", " ", "order", " ", "to", " ", "avoid", " ", "underflow", " ", 
           "or", " ", "overflow", " ", "in", " ", "the", " ", "computation"}],
           ",", " ", 
          RowBox[{
          "we", " ", "rescaled", " ", "\[CapitalDelta]00", " ", "with", " ", 
           "\[Mu]", " ", "and", " ", "the", " ", "values", " ", "of", " ", 
           "the", " ", "free", " ", "energy", " ", "with", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Mu]", " ", "kF"}], ")"}], ".", " ", 
            "\[IndentingNewLine]", "They"}], " ", "should", " ", "now", " ", 
           "be", " ", "O", 
           RowBox[{"(", "1", ")"}], " ", 
           RowBox[{"quantities", "."}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Minimize", " ", "and", " ", "plot", " ", "the", " ", "points", " ", 
          "visited"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"result", ",", " ", "steps"}], "}"}], " ", "=", " ", 
         RowBox[{"Reap", "[", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"n", "=", "0"}], ",", "fval"}], "}"}], ",", 
            RowBox[{"Catch", "@", 
             RowBox[{"FindMinimum", "[", 
              RowBox[{
               RowBox[{"fval", "=", 
                RowBox[{"f", "[", "\[CapitalDelta]00\[Mu]", "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"\[CapitalDelta]00\[Mu]", " ", ",", 
                 RowBox[{
                  RowBox[{"RandomReal", "[", 
                   RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], "]"}], " ", 
                  FractionBox[
                   SqrtBox[
                    RowBox[{"\[Omega]x", " ", "\[Omega]z"}]], "\[Mu]"]}]}], 
                "}"}], ",", 
               RowBox[{"PrecisionGoal", "\[Rule]", "prec"}], ",", 
               RowBox[{"AccuracyGoal", "\[Rule]", "acc"}], ",", 
               RowBox[{"EvaluationMonitor", "\[RuleDelayed]", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\[CapitalDelta]00\[Mu]", " ", "\[Mu]"}], ",", 
                    RowBox[{"fval", " ", "\[Mu]", " ", "kF"}]}], "}"}], "]"}],
                   ";", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"++", "n"}], "\[GreaterEqual]", "iters"}], ",", 
                    RowBox[{"Throw", "[", "0", "]"}]}], "]"}], ";", " ", 
                  RowBox[{"WriteString", "[", 
                   RowBox[{"\"\<stdout\>\"", ",", "\"\<:\>\""}], "]"}], ";"}],
                  ")"}]}]}], "]"}]}]}], "]"}], "]"}]}], ";", " ", 
        RowBox[{"Print", "[", "\"\<\>\"", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"steps", "=", 
         RowBox[{
         "steps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"result", "=", 
         RowBox[{"steps", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
            RowBox[{"Ordering", "[", 
             RowBox[{"steps", "\[LeftDoubleBracket]", 
              RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
            "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           "1"}], "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"fig", "=", 
            RowBox[{"Show", "[", 
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{"steps", ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotStyle", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"Red", ",", "Dotted"}], "}"}]}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}], ",", 
              RowBox[{"ListPlot", "[", 
               RowBox[{"steps", ",", 
                RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}]}], "]"}]}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"fig", "=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Output", ":", " ", 
          RowBox[{
          "\[CapitalDelta]", " ", "in", " ", "the", " ", "lowest", " ", 
           "channel", " ", "and", " ", "the", " ", "figure", " ", "with", " ",
            "the", " ", "steps", " ", "taken", " ", "during", " ", 
           "minimization"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"result", ",", "steps", ",", "fig"}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Minimizes", " ", "free", " ", "energy", " ", "allowing", " ", "for", " ", 
     RowBox[{
      RowBox[{"(", GridBox[{
         {"\[CapitalDelta]00", "\[CapitalDelta]01"},
         {"\[CapitalDelta]10", "\[CapitalDelta]11"}
        }], ")"}], ".", " ", "Real"}], " ", "4", "D", " ", 
     RowBox[{"minimization", ".", " ", "You"}], " ", "can", " ", "set", " ", 
     "the", " ", "max", " ", "number", " ", "of", " ", "function", " ", 
     "evaluations", " ", "allowed", " ", "and", " ", "it", " ", "will", " ", 
     "also", " ", "plot", " ", "the", " ", "evolution", " ", "of", " ", "the",
      " ", "order", " ", 
     RowBox[{"parameter", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "Find\[CapitalDelta]N2", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"AccuracyGoal", "\[Rule]", " ", "4"}], ",", 
       RowBox[{"PrecisionGoal", "\[Rule]", "4"}], ",", 
       RowBox[{"MaxRecursion", "\[Rule]", "100"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Find\[CapitalDelta]N2", "[", 
      RowBox[{
      "\[Omega]x_", ",", "\[Omega]z_", ",", "\[Mu]_", ",", "Vg_", ",", "T_", 
       ",", "a_", ",", "\[CapitalDelta]init_", ",", 
       RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "f", ",", "\[Epsilon]B", ",", "Reg", ",", "x00", ",", "x01", ",", 
         "x10", ",", "x11", ",", "acc", ",", "prec", ",", "iters", ",", 
         "steps", ",", "result", ",", "t", ",", "Nx", ",", "Nz", ",", "pf", 
         ",", "p\[Delta]", ",", "pf\[Delta]", ",", "p\[CapitalDelta]"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"iters", "=", 
         RowBox[{"OptionValue", "[", "MaxRecursion", "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Maximum", " ", "number", " ", "of", " ", "functions", " ", 
          "evaluations"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"acc", "=", 
         RowBox[{"OptionValue", "[", "AccuracyGoal", "]"}]}], ";", "     ", 
        RowBox[{"(*", 
         StyleBox[" ",
          FontSize->12], 
         StyleBox[
          RowBox[{"Accuracy", " ", "goal"}],
          FontSize->12], 
         StyleBox[" ",
          FontSize->12], 
         StyleBox["*)",
          FontSize->12]}], "\[IndentingNewLine]", 
        RowBox[{"prec", "=", 
         RowBox[{"OptionValue", "[", "PrecisionGoal", "]"}]}], ";", " ", 
        StyleBox[" ",
         FontSize->12], 
        RowBox[{"(*", " ", 
         StyleBox[
          RowBox[{"Precision", " ", "goal"}],
          FontSize->12], 
         StyleBox[" ",
          FontSize->12], 
         StyleBox["*)",
          FontSize->12]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Define", " ", "free", " ", "energy", " ", "function"}], " ",
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]B", "=", 
         RowBox[{"EB", "[", 
          RowBox[{"\[Omega]x", ",", "\[Omega]z", ",", "a"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Reg", "=", 
         RowBox[{"RegularizingIntegral", "[", 
          RowBox[{"\[Epsilon]B", ",", "\[Omega]x", ",", "\[Omega]z"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{
           RowBox[{"\[CapitalDelta]00_", "?", "NumericQ"}], ",", 
           RowBox[{"\[CapitalDelta]01_", "?", "NumericQ"}], ",", 
           RowBox[{"\[CapitalDelta]10_", "?", "NumericQ"}], ",", 
           RowBox[{"\[CapitalDelta]11_", "?", "NumericQ"}]}], "]"}], ":=", 
         RowBox[{"Re", "@", 
          RowBox[{"First", "@", 
           RowBox[{"FreeEnergyAndDensity", "[", 
            RowBox[{
            "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", "Vg", ",", 
             RowBox[{"(", GridBox[{
                {"\[CapitalDelta]00", "\[CapitalDelta]01"},
                {"\[CapitalDelta]10", "\[CapitalDelta]11"}
               }], ")"}], ",", "T", ",", "Reg", ",", "\[Epsilon]B", ",", 
             "a"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Go", " ", "through", " ", "the", " ", "minimization", " ", "and", 
          " ", "keep", " ", "track", " ", "of", " ", "the", " ", "points", 
          " ", 
          RowBox[{"visited", ".", " ", "Stop"}], " ", "if", " ", "maximum", 
          " ", "numbers", " ", "of", " ", "iterations", " ", "reached"}], " ",
          "*)"}], "\[IndentingNewLine]", 
        RowBox[{"steps", "=", 
         RowBox[{"Reap", "@", 
          RowBox[{"Block", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"n", "=", "0"}], ",", "fval", ",", 
              RowBox[{"xPrev", "=", "\[CapitalDelta]init"}]}], "}"}], ",", 
            RowBox[{"Catch", "[", 
             RowBox[{"FindMinimum", "[", 
              RowBox[{
               RowBox[{"fval", "=", 
                RowBox[{"f", "[", 
                 RowBox[{"x00", ",", "x01", ",", "x10", ",", "x11"}], "]"}]}],
                ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"x00", ",", 
                   RowBox[{"\[CapitalDelta]init", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"x01", ",", 
                   RowBox[{"\[CapitalDelta]init", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"x10", ",", 
                   RowBox[{"\[CapitalDelta]init", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"x11", ",", 
                   RowBox[{"\[CapitalDelta]init", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                  "}"}]}], "}"}], ",", 
               RowBox[{"AccuracyGoal", "\[Rule]", "acc"}], ",", 
               RowBox[{"PrecisionGoal", "\[Rule]", "prec"}], ",", 
               RowBox[{"EvaluationMonitor", "\[RuleDelayed]", " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Sow", "[", 
                   RowBox[{"{", 
                    RowBox[{"fval", ",", 
                    RowBox[{"(", GridBox[{
                    {"x00", "x01"},
                    {"x10", "x11"}
                    }], ")"}], ",", 
                    RowBox[{"Norm", "[", 
                    RowBox[{
                    RowBox[{"(", GridBox[{
                    {"x00", "x01"},
                    {"x10", "x11"}
                    }], ")"}], "-", "xPrev"}], "]"}]}], "}"}], "]"}], ";", 
                  RowBox[{"xPrev", "=", 
                   RowBox[{"(", GridBox[{
                    {"x00", "x01"},
                    {"x10", "x11"}
                    }], ")"}]}], ";", " ", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"++", "n"}], "\[GreaterEqual]", "iters"}], ",", 
                    RowBox[{"Throw", "[", "0", "]"}]}], "]"}], ";", " ", 
                  RowBox[{"WriteString", "[", 
                   RowBox[{"\"\<stdout\>\"", ",", "\"\<.\>\""}], "]"}], ";"}],
                  ")"}]}]}], "]"}], "]"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"steps", "=", 
         RowBox[{"steps", "\[LeftDoubleBracket]", 
          RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"result", "=", 
         RowBox[{"steps", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"Ordering", "[", 
            RowBox[{"steps", "\[LeftDoubleBracket]", 
             RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], "]"}], 
           "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Plot", " ", "the", " ", "points", " ", "that", " ", "we", " ", 
          "have", " ", "been", " ", "visiting"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"t", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"Nx", "=", "0"}], ",", 
          RowBox[{"Nx", "\[LessEqual]", "1"}], ",", 
          RowBox[{"Nx", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"Nz", "=", "0"}], ",", 
             RowBox[{"Nz", "\[LessEqual]", "1"}], ",", 
             RowBox[{"Nz", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"t", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"Nx", "+", "1"}], ",", 
                 RowBox[{"Nz", "+", "1"}]}], "\[RightDoubleBracket]"}], "=", 
               RowBox[{"Table", "[", 
                RowBox[{
                 FractionBox[
                  RowBox[{"steps", "\[LeftDoubleBracket]", 
                   RowBox[{"i", ",", "2", ",", 
                    RowBox[{"Nx", "+", "1"}], ",", 
                    RowBox[{"Nz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                  SqrtBox[
                   RowBox[{"\[Omega]x", " ", "\[Omega]z"}]]], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"Length", "@", "steps"}]}], "}"}]}], "]"}]}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pf", "=", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"steps", "\[LeftDoubleBracket]", 
               RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{"PlotLabel", "\[Rule]", "\"\<f\>\""}], ",", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"p\[Delta]", "=", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"steps", "\[LeftDoubleBracket]", 
               RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], ",", 
              RowBox[{"PlotLabel", "\[Rule]", "\"\<stepsize\>\""}], ",", 
              RowBox[{"PlotRange", "\[Rule]", "Full"}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"p\[CapitalDelta]", "=", 
            RowBox[{"Show", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"ListPlot", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                   "}"}], ",", 
                  RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                  RowBox[{"PlotStyle", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Lighter", "[", 
                    RowBox[{"Red", ",", "0.75"}], "]"}], ",", 
                    RowBox[{"Lighter", "[", 
                    RowBox[{"Blue", ",", "0.75"}], "]"}], ",", 
                    RowBox[{"Lighter", "[", 
                    RowBox[{"Purple", ",", "0.75"}], "]"}], ",", 
                    RowBox[{"Lighter", "[", 
                    RowBox[{"Gray", ",", "0.75"}], "]"}]}], "}"}]}]}], "]"}], 
                ",", 
                RowBox[{"ListPlot", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"t", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                   "}"}], ",", 
                  RowBox[{"Joined", "\[Rule]", "False"}], ",", 
                  RowBox[{"PlotStyle", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"Red", ",", "Blue", ",", "Purple", ",", "Gray"}], 
                    "}"}]}], ",", 
                  RowBox[{"PlotMarkers", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"Automatic", ",", "Medium"}], "}"}]}], ",", 
                  RowBox[{"PlotLegends", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{
                    "\"\<\[CapitalDelta]00\>\"", ",", 
                    "\"\<\[CapitalDelta]01\>\"", ",", 
                    "\"\<\[CapitalDelta]10\>\"", ",", 
                    "\"\<\[CapitalDelta]11\>\""}], "}"}]}]}], "]"}]}], "}"}], 
              ",", 
              RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"pf\[Delta]", "=", 
            RowBox[{"GraphicsRow", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"pf", ",", "p\[Delta]"}], "}"}], ",", 
              RowBox[{"Spacings", "\[Rule]", "30"}]}], "]"}]}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pf\[Delta]", "=", "0"}], ";", "\[IndentingNewLine]", 
           RowBox[{"p\[CapitalDelta]", "=", "0"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Chopping", " ", "off", " ", "the", " ", "step", " ", "sizes", " ", 
          "from", " ", "the", " ", "array", " ", "\"\<steps\>\""}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"steps", "=", 
         RowBox[{"steps", "\[LeftDoubleBracket]", 
          RowBox[{"All", ",", 
           RowBox[{"1", ";;", "2"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Output", ":", " ", "result", ":", " ", 
           RowBox[{
            RowBox[{
            "best", " ", "value", " ", "of", " ", "the", " ", 
             "\[CapitalDelta]"}], "-", "s"}]}], ",", " ", 
          RowBox[{"steps", ":", " ", 
           RowBox[{
           "visited", " ", "points", " ", "and", " ", "free", " ", "energy", 
            " ", "values"}]}], ",", " ", 
          RowBox[{"pf\[Delta]", " ", "and", " ", 
           RowBox[{"p\[CapitalDelta]", ":", " ", "plots"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
         "result", ",", "steps", ",", "pf\[Delta]", ",", "p\[CapitalDelta]"}],
          "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Minimizes", " ", "free", " ", "energy", " ", "allowing", " ", "for", " ", 
     RowBox[{
      RowBox[{"(", GridBox[{
         {"\[CapitalDelta]00", "\[CapitalDelta]01"},
         {"\[CapitalDelta]10", "\[CapitalDelta]11"}
        }], ")"}], ".", " ", "Real"}], " ", "4", "D", " ", 
     RowBox[{"minimization", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Find\[CapitalDelta]N", "[", 
      RowBox[{
      "\[Omega]x_", ",", "\[Omega]z_", ",", "\[Mu]_", ",", "Vg_", ",", "T_", 
       ",", "a_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[CapitalDelta]00", ",", "\[CapitalDelta]init", ",", "pf\[Delta]", 
         ",", "p\[CapitalDelta]", ",", "result", ",", "steps"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "First", " ", "uses", " ", "1", "D", " ", "line", " ", "search", " ",
           "to", " ", "find", " ", "the", " ", "value", " ", "of", " ", 
          "\[CapitalDelta]00"}], ",", " ", "then", ",", " ", 
         RowBox[{"starting", " ", "from", " ", "this", " ", "point"}], ",", 
         " ", 
         RowBox[{"does", " ", "a", " ", "4", "D", " ", 
          RowBox[{"search", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[CapitalDelta]00", "=", 
         RowBox[{"First", "@", 
          RowBox[{"Find\[CapitalDelta]00", "[", 
           RowBox[{
           "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", "Vg", ",", "T", 
            ",", "a", ",", 
            RowBox[{"MaxRecursion", "\[Rule]", "25"}], ",", 
            RowBox[{"AccuracyGoal", "\[Rule]", "4"}], ",", 
            RowBox[{"PrecisionGoal", "\[Rule]", "4"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"\[CapitalDelta]init", " ", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{
              SuperscriptBox["10", 
               RowBox[{"-", "5"}]], " ", 
              SqrtBox[
               RowBox[{"\[Omega]x", " ", "\[Omega]z"}]]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", ",", "2"}], "}"}]}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[CapitalDelta]init", "\[LeftDoubleBracket]", 
          RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], "=", 
         "\[CapitalDelta]00"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "result", ",", "steps", ",", "pf\[Delta]", ",", 
           "p\[CapitalDelta]"}], "}"}], "=", 
         RowBox[{"Find\[CapitalDelta]N2", "[", 
          RowBox[{
          "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", "Vg", ",", "T", 
           ",", "a", ",", "\[CapitalDelta]init", ",", 
           RowBox[{"MaxRecursion", "\[Rule]", "80"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PlotFreeEnergy", "[", 
      RowBox[{
      "\[Omega]x_", ",", "\[Omega]z_", ",", "\[Mu]_", ",", "Vg_", ",", "T_", 
       ",", "a_", ",", "\[CapitalDelta]min_", ",", "\[CapitalDelta]max_"}], 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Epsilon]B", ",", "Reg", ",", "t"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[Epsilon]B", "=", 
         RowBox[{"EB", "[", 
          RowBox[{"\[Omega]x", ",", "\[Omega]z", ",", "a"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Reg", "=", 
         RowBox[{"RegularizingIntegral", "[", 
          RowBox[{"\[Epsilon]B", ",", "\[Omega]x", ",", "\[Omega]z"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"t", " ", "=", " ", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[CapitalDelta]0", ",", 
             RowBox[{
              RowBox[{"FreeEnergyAndDensity", "[", 
               RowBox[{
               "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", "Vg", ",", 
                RowBox[{"{", 
                 RowBox[{"{", "\[CapitalDelta]0", "}"}], "}"}], ",", "T", ",",
                 "Reg", ",", "\[Epsilon]B", ",", "a"}], "]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], "}"}],
            ",", 
           RowBox[{"{", 
            RowBox[{
            "\[CapitalDelta]0", ",", "\[CapitalDelta]min", ",", 
             "\[CapitalDelta]max", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[CapitalDelta]max", "-", "\[CapitalDelta]min"}], 
               ")"}], "/", "10"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ListPlot", "[", "t", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalDelta]00", "[", "y_", "]"}], ":=", " ", 
     RowBox[{"First", "@", 
      RowBox[{"Find\[CapitalDelta]00", "[", 
       RowBox[{
        RowBox[{"\[Omega]x", "[", "y", "]"}], ",", 
        RowBox[{"\[Omega]z", "[", "y", "]"}], ",", "\[Mu]", ",", 
        RowBox[{"Vg", "[", "y", "]"}], ",", "T", ",", "a"}], "]"}]}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]B", "[", "y_", "]"}], ":=", 
     RowBox[{"EB", "[", 
      RowBox[{
       RowBox[{"\[Omega]x", "[", "y", "]"}], ",", 
       RowBox[{"\[Omega]z", "[", "y", "]"}], ",", "a"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalDelta]N", "[", "y_", "]"}], ":=", " ", 
     RowBox[{"First", "@", 
      RowBox[{"Find\[CapitalDelta]N", "[", 
       RowBox[{
        RowBox[{"\[Omega]x", "[", "y", "]"}], ",", 
        RowBox[{"\[Omega]z", "[", "y", "]"}], ",", "\[Mu]", ",", 
        RowBox[{"Vg", "[", "y", "]"}], ",", "T", ",", "a"}], "]"}]}]}], ";"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", "\[IndentingNewLine]",
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"BCS", " ", "calculation"}], "Title"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"y\[CapitalDelta]", "=", 
     RowBox[{"Table", "[", 
      RowBox[{"y\[CapitalDelta]0", ",", 
       RowBox[{"{", 
        RowBox[{"y\[CapitalDelta]0", ",", "0", ",", 
         RowBox[{"2.25", " ", "dx"}], ",", 
         RowBox[{"0.25", " ", "dx"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"t\[Epsilon]B", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
         "y\[CapitalDelta]", "\[LeftDoubleBracket]", "i", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{"\[Epsilon]B", "[", 
          RowBox[{
          "y\[CapitalDelta]", "\[LeftDoubleBracket]", "i", 
           "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "@", "y\[CapitalDelta]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"t\[CapitalDelta]0", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
         "y\[CapitalDelta]", "\[LeftDoubleBracket]", "i", 
          "\[RightDoubleBracket]"}], ",", 
         RowBox[{"\[CapitalDelta]00", "[", 
          RowBox[{
          "y\[CapitalDelta]", "\[LeftDoubleBracket]", "i", 
           "\[RightDoubleBracket]"}], "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "@", "y\[CapitalDelta]"}]}], "}"}]}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"t\[Epsilon]B", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Reverse", "@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"t\[Epsilon]B", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
              RowBox[{"t\[Epsilon]B", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", 
              RowBox[{"Length", "@", "t\[CapitalDelta]0"}]}], "}"}]}], 
           "]"}]}], ",", "t\[Epsilon]B"}], "}"}], ",", "1"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"t\[CapitalDelta]0", "=", 
     RowBox[{"Flatten", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Reverse", "@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"t\[CapitalDelta]0", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}]}], ",", 
              RowBox[{"t\[CapitalDelta]0", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", 
              RowBox[{"Length", "@", "t\[CapitalDelta]0"}]}], "}"}]}], 
           "]"}]}], ",", "t\[CapitalDelta]0"}], "}"}], ",", "1"}], "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", "\"\<t\[CapitalDelta]0:\>\"", "]"}], ";", 
    RowBox[{"Print", "[", "t\[CapitalDelta]0", "]"}], ";", " ", 
    RowBox[{"Print", "[", "\"\<\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"NotebookSave", "[", "]"}], ";"}]}], "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Save", " ", "results", " ", "and", " ", "parameters"}], "Code"],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Put", "[", 
     RowBox[{
      RowBox[{"Definition", "@", "hbar"}], ",", 
      RowBox[{"Definition", "@", "kB"}], ",", 
      RowBox[{"Definition", "@", "a0"}], ",", 
      RowBox[{"Definition", "@", "nxmaxBCS"}], ",", 
      RowBox[{"Definition", "@", "nzmaxBCS"}], ",", 
      RowBox[{"Definition", "@", "nxmaxTr"}], ",", 
      RowBox[{"Definition", "@", "nzmaxTr"}], ",", 
      RowBox[{"Definition", "@", "Nxmax"}], ",", 
      RowBox[{"Definition", "@", "Nzmax"}], ",", 
      RowBox[{"Definition", "@", "a"}], ",", 
      RowBox[{"Definition", "@", "\[Mu]"}], ",", 
      RowBox[{"Definition", "@", "T"}], ",", 
      RowBox[{"Definition", "@", "dV"}], ",", 
      RowBox[{"Definition", "@", "dz"}], ",", 
      RowBox[{"Definition", "@", "dx"}], ",", 
      RowBox[{"FullDefinition", "@", "Vg"}], ",", 
      RowBox[{"FullDefinition", "@", "\[Omega]x"}], ",", 
      RowBox[{"FullDefinition", "@", "\[Omega]z"}], ",", 
      RowBox[{"Definition", "@", "mass"}], ",", 
      RowBox[{"Definition", "@", "kFa"}], ",", 
      RowBox[{"Definition", "@", "kF"}], ",", 
      RowBox[{"Definition", "@", "\[Lambda]F"}], ",", 
      RowBox[{"Definition", "@", "lx"}], ",", 
      RowBox[{"Definition", "@", "lz"}], ",", 
      RowBox[{"Definition", "@", "yminBCS"}], ",", 
      RowBox[{"Definition", "@", "ymaxBCS"}], ",", 
      RowBox[{"Definition", "@", "yminTr"}], ",", 
      RowBox[{"Definition", "@", "ymaxTr"}], ",", 
      RowBox[{"Definition", "@", "t\[CapitalDelta]0"}], ",", 
      RowBox[{"Definition", "@", "t\[Epsilon]B"}], ",", 
      RowBox[{"Definition", "@", "saveFilename"}], ",", 
      RowBox[{"Definition", "@", "ParamsFilename"}], ",", 
      RowBox[{"Definition", "@", "SmxFilename"}], ",", "ParamsFilename"}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"To", " ", 
     RowBox[{"import", ":", " ", 
      RowBox[{"<<", " ", "ParamsFilename"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"NotebookSave", "[", "]"}], ";"}]}], "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
      RowBox[{
      "If", " ", "we", " ", "did", " ", "not", " ", "run", " ", "the", " ", 
       "notebook", " ", "on", " ", "the", " ", "cluster"}], ",", " ", 
      RowBox[{"we", " ", "can", " ", "plot", " ", "stuff"}]}], "Code"], 
    StyleBox[" ", "Subsubsection"], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Pot", "[", "y_", "]"}], ":=", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Vg", "[", "y", "]"}]}], "+", 
         FractionBox[
          RowBox[{
           RowBox[{"\[Omega]x", "[", "y", "]"}], "+", 
           RowBox[{"\[Omega]z", "[", "y", "]"}]}], "2"]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"p1BCS", "=", 
        RowBox[{"Plot", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"Vg", "[", 
               RowBox[{
                SuperscriptBox["10", 
                 RowBox[{"-", "6"}]], "y"}], "]"}]}], ",", 
             RowBox[{"\[Omega]x", "[", 
              RowBox[{
               SuperscriptBox["10", 
                RowBox[{"-", "6"}]], "y"}], "]"}], ",", 
             RowBox[{"\[Omega]z", "[", 
              RowBox[{
               SuperscriptBox["10", 
                RowBox[{"-", "6"}]], "y"}], "]"}]}], "}"}], "/", 
           RowBox[{"(", 
            RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", 
            RowBox[{
             SuperscriptBox["10", "6"], "yminBCS"}], ",", 
            RowBox[{
             SuperscriptBox["10", "6"], "ymaxBCS"}]}], "}"}], ",", 
          RowBox[{"PlotLegends", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Vg", ",", "\[Omega]x", ",", "\[Omega]z"}], "}"}]}], ",", 
          
          RowBox[{"AxesLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<y (\[Mu]m)\>\"", ",", "\"\<Potentials (Hz)\>\""}], 
            "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p2BCS", "=", 
        RowBox[{"Plot", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Pot", "[", 
              RowBox[{
               SuperscriptBox["10", 
                RowBox[{"-", "6"}]], "y"}], "]"}], ",", "\[Mu]"}], "}"}], "/", 
           RowBox[{"(", 
            RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", 
            RowBox[{
             SuperscriptBox["10", "6"], "yminBCS"}], ",", 
            RowBox[{
             SuperscriptBox["10", "6"], "ymaxBCS"}]}], "}"}], ",", 
          RowBox[{"PlotLegends", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<(0,0) channel\>\"", ",", "\"\<\[Mu]\>\""}], "}"}]}], 
          ",", 
          RowBox[{"AxesLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<y (\[Mu]m)\>\"", ",", "\"\<Potentials (Hz)\>\""}], 
            "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p3BCS", "=", 
        RowBox[{"Plot", "[", 
         RowBox[{
          FractionBox["a", 
           SqrtBox[
            RowBox[{
             RowBox[{"lx", "[", 
              RowBox[{
               SuperscriptBox["10", 
                RowBox[{"-", "6"}]], "y"}], "]"}], " ", 
             RowBox[{"lz", "[", 
              RowBox[{
               SuperscriptBox["10", 
                RowBox[{"-", "6"}]], "y"}], "]"}]}]]], ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", 
            RowBox[{
             SuperscriptBox["10", "6"], "yminBCS"}], ",", 
            RowBox[{
             SuperscriptBox["10", "6"], "ymaxBCS"}]}], "}"}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<y(\[Mu]m)\>\"", ",", "\"\<a/(lx/lz)^0.5\>\""}], 
            "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p4BCS", "=", 
        RowBox[{"Show", "[", 
         RowBox[{
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Pot", "[", 
                   RowBox[{
                    SuperscriptBox["10", 
                    RowBox[{"-", "6"}]], " ", "y"}], "]"}], " ", "+", " ", 
                  RowBox[{"nx", " ", 
                   RowBox[{"\[Omega]x", "[", 
                    RowBox[{
                    SuperscriptBox["10", 
                    RowBox[{"-", "6"}]], " ", "y"}], "]"}]}], " ", "+", " ", 
                  RowBox[{"nz", " ", 
                   RowBox[{"\[Omega]z", "[", 
                    RowBox[{
                    SuperscriptBox["10", 
                    RowBox[{"-", "6"}]], " ", "y"}], "]"}]}]}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"nx", ",", "0", ",", "nxmaxBCS"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"nz", ",", "0", ",", "nzmaxBCS"}], "}"}]}], "]"}], 
             "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"y", ",", 
              RowBox[{"yminBCS", " ", 
               SuperscriptBox["10", "6"]}], ",", 
              RowBox[{"ymaxBCS", " ", 
               SuperscriptBox["10", "6"]}]}], "}"}], ",", 
            RowBox[{"PlotRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "\[Mu]"}], "/", 
                RowBox[{"(", 
                 RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}], ",", 
               RowBox[{"3", 
                RowBox[{"\[Mu]", "/", 
                 RowBox[{"(", 
                  RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}]}]}], "}"}]}]}],
            "]"}], ",", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{"\[Mu]", "/", 
             RowBox[{"(", 
              RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"y", ",", 
              RowBox[{
               SuperscriptBox["10", "6"], "yminBCS"}], ",", 
              RowBox[{
               SuperscriptBox["10", "6"], "ymaxBCS"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
            RowBox[{"AxesLabel", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"\"\<y (\[Mu]m)\>\"", ",", "\"\<Potentials (Hz)\>\""}], 
              "}"}]}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p5BCS", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"t\[CapitalDelta]0", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], " ", 
               SuperscriptBox["10", "6"]}], ",", 
              RowBox[{
               RowBox[{"t\[CapitalDelta]0", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}], "/", 
               RowBox[{"(", 
                RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "@", "t\[CapitalDelta]0"}]}], "}"}]}], "]"}], 
          ",", 
          RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<y(\[Mu]m)\>\"", ",", "\"\<\[CapitalDelta](Hz)\>\""}],
             "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p6BCS", "=", 
        RowBox[{"Show", "[", 
         RowBox[{"p4BCS", ",", "p5BCS"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"p7BCS", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"t\[Epsilon]B", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], " ", 
               SuperscriptBox["10", "6"]}], ",", 
              RowBox[{
               RowBox[{"t\[Epsilon]B", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}], "/", 
               RowBox[{"(", 
                RowBox[{"2", "\[Pi]", " ", "hbar"}], ")"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "@", "t\[CapitalDelta]0"}]}], "}"}]}], "]"}], 
          ",", 
          RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<y(\[Mu]m)\>\"", ",", "\"\<\[Epsilon]B(Hz)\>\""}], 
            "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"saveFilename", "<>", "\"\<Fig1.jpg\>\""}], ",", "p1BCS", 
         ",", "\"\<jpg\>\"", ",", 
         RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"saveFilename", "<>", "\"\<Fig2.jpg\>\""}], ",", "p2BCS", 
         ",", "\"\<jpg\>\"", ",", 
         RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"saveFilename", "<>", "\"\<Fig3.jpg\>\""}], ",", "p3BCS", 
         ",", "\"\<jpg\>\"", ",", 
         RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"saveFilename", "<>", "\"\<Fig4.jpg\>\""}], ",", "p4BCS", 
         ",", "\"\<jpg\>\"", ",", 
         RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"saveFilename", "<>", "\"\<Fig5.jpg\>\""}], ",", "p5BCS", 
         ",", "\"\<jpg\>\"", ",", 
         RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"saveFilename", "<>", "\"\<Fig6.jpg\>\""}], ",", "p6BCS", 
         ",", "\"\<jpg\>\"", ",", 
         RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"saveFilename", "<>", "\"\<Fig7.jpg\>\""}], ",", "p7BCS", 
         ",", "\"\<jpg\>\"", ",", 
         RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"NotebookSave", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Definitions", " ", "for", " ", "the", " ", "transport", " ", 
      "calculation"}], "Title"], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalDelta]", "[", "y_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "\[CapitalDelta]i", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[CapitalDelta]i", "=", 
         RowBox[{"Interpolation", "[", 
          RowBox[{"t\[CapitalDelta]0", ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", "y", "]"}], "<", 
           RowBox[{"Abs", "@", 
            RowBox[{"t\[CapitalDelta]0", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"Max", "[", 
             RowBox[{
              RowBox[{"\[CapitalDelta]i", "[", 
               RowBox[{"Abs", "@", "y"}], "]"}], ",", "0"}], "]"}], "}"}], 
           "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"{", "0.0", "}"}], "}"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Potentials", " ", "and", " ", "\[CapitalDelta]", " ", "in", " ", "a", 
      " ", "single", " ", "struct"}], "Text"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"params", "[", "y_", "]"}], ":=", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<Vg\>\"", "\[Rule]", 
        RowBox[{"Vg", "[", "y", "]"}]}], ",", 
       RowBox[{"\"\<\[Omega]x\>\"", "\[Rule]", 
        RowBox[{"\[Omega]x", "[", "y", "]"}]}], ",", " ", 
       RowBox[{"\"\<\[Omega]z\>\"", "\[Rule]", 
        RowBox[{"\[Omega]z", "[", "y", "]"}]}], ",", 
       RowBox[{"\"\<\[CapitalDelta]\>\"", "\[Rule]", 
        RowBox[{"\[CapitalDelta]", "[", "y", "]"}]}], ",", 
       RowBox[{"\"\<\[Mu]\>\"", "\[Rule]", "\[Mu]"}], ",", 
       RowBox[{"\"\<T\>\"", "\[Rule]", "T"}]}], "|>"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Ordering", " ", "of", " ", 
      RowBox[{"(", 
       RowBox[{"nx", ",", "nz"}], ")"}], " ", "channels"}], "Subsubsection"], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"i2nxnzTr", "[", "i_", "]"}], " ", ":=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Floor", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"i", "-", "1"}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"nzmaxTr", "+", "1"}], ")"}]}], "]"}], ",", " ", 
       RowBox[{"Mod", "[", 
        RowBox[{
         RowBox[{"i", "-", "1"}], ",", " ", 
         RowBox[{"nzmaxTr", "+", "1"}]}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nxnz2iTr", "[", "nxnz_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"1", "+", 
       RowBox[{"nxnz", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
        "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"nzmaxTr", "+", "1"}], ")"}], " ", 
        RowBox[{
        "nxnz", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
      ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"indTr", " ", "=", " ", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"nx", ",", "nz"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"nx", ",", "0", ",", "nxmaxTr"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"nz", ",", "0", ",", "nzmaxTr"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"nzmaxTr", "+", "1"}], ")"}]}], ",", "2"}], "}"}]}], 
      "]"}]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Array", " ", "of", " ", "all", " ", "indices"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Checked", " ", "the", " ", "above", " ", "functions", " ", 
     "numerically"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Matrix", " ", "elements"}], "Subsubsection"], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"VClx", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"VCl", "[", 
        RowBox[{"Nx", ",", "nx1", ",", "nx2"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nx", ",", "0", ",", "Nxmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"nx1", ",", "0", ",", "nxmaxTr"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"nx2", ",", "0", ",", "nxmaxTr"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"VClz", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"VCl", "[", 
        RowBox[{"Nz", ",", "nz1", ",", "nz2"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"Nz", ",", "0", ",", "Nxmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"nz1", ",", "0", ",", "nzmaxTr"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"nz2", ",", "0", ",", "nzmaxTr"}], "}"}]}], "]"}]}], ";"}], 
   "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
    "There", " ", "was", " ", "a", " ", "bug", " ", "here", " ", "in", " ", 
     "earlier", " ", 
     RowBox[{"versions", ":", " ", 
      RowBox[{
       RowBox[{
       "for", " ", "VClz", " ", "the", " ", "indices", " ", "went", " ", 
        "from", " ", "0", " ", "to", " ", 
        RowBox[{"nxmaxTr", ".", " ", "This"}], " ", 
        RowBox[{"wasn", "'"}], "t", " ", "an", " ", "issue", " ", "because", 
        " ", "usually", " ", "nxmaxTr"}], ">", 
       RowBox[{"nzmaxTr", "."}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"VNTr", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"VClx", "\[LeftDoubleBracket]", 
         RowBox[{"iNx", ",", 
          RowBox[{
           RowBox[{"indTr", "\[LeftDoubleBracket]", 
            RowBox[{"i1", ",", "1"}], "\[RightDoubleBracket]"}], "+", "1"}], 
          ",", 
          RowBox[{
           RowBox[{"indTr", "\[LeftDoubleBracket]", 
            RowBox[{"i2", ",", "1"}], "\[RightDoubleBracket]"}], "+", "1"}]}],
          "\[RightDoubleBracket]"}], " ", 
        RowBox[{"VClz", "\[LeftDoubleBracket]", 
         RowBox[{"iNz", ",", 
          RowBox[{
           RowBox[{"indTr", "\[LeftDoubleBracket]", 
            RowBox[{"i1", ",", "2"}], "\[RightDoubleBracket]"}], "+", "1"}], 
          ",", 
          RowBox[{
           RowBox[{"indTr", "\[LeftDoubleBracket]", 
            RowBox[{"i2", ",", "2"}], "\[RightDoubleBracket]"}], "+", "1"}]}],
          "\[RightDoubleBracket]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"iNx", ",", "1", ",", 
         RowBox[{"Nxmax", "+", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"iNz", ",", "1", ",", 
         RowBox[{"Nzmax", "+", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i1", ",", "1", ",", "nChTr"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i2", ",", "1", ",", "nChTr"}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{"Clear", "[", 
    RowBox[{"VClx", ",", "VClz"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", " ", 
    StyleBox["\[CapitalDelta]", "Subsubsection"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[CapitalDelta]Mx", "[", "\[CapitalDelta]_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\[CapitalDelta]mx", ",", "Nxmax", ",", "Nzmax", ",", "iNx", ",", 
         "iNz"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\[CapitalDelta]mx", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"nChTr", ",", "nChTr"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Nxmax", ",", "Nzmax"}], "}"}], "=", 
         RowBox[{"Dimensions", "[", "\[CapitalDelta]", "]"}]}], ";", " ", 
        RowBox[{"Nxmax", "-=", "1"}], ";", " ", 
        RowBox[{"Nzmax", "-=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"iNx", "=", "0"}], ",", 
          RowBox[{"iNx", "\[LessEqual]", "Nxmax"}], ",", 
          RowBox[{"iNx", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"For", "[", 
            RowBox[{
             RowBox[{"iNz", "=", "0"}], ",", 
             RowBox[{"iNz", "\[LessEqual]", "Nzmax"}], ",", 
             RowBox[{"iNz", "++"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"\[CapitalDelta]mx", "=", 
               RowBox[{"\[CapitalDelta]mx", "+", 
                RowBox[{
                 RowBox[{"\[CapitalDelta]", "\[LeftDoubleBracket]", 
                  RowBox[{
                   RowBox[{"iNx", "+", "1"}], ",", 
                   RowBox[{"iNz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                 " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"VNTr", "\[LeftDoubleBracket]", 
                    RowBox[{
                    RowBox[{"iNx", "+", "1"}], ",", 
                    RowBox[{"iNz", "+", "1"}]}], "\[RightDoubleBracket]"}], 
                   ")"}], "\[ConjugateTranspose]"}]}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", "\[CapitalDelta]mx"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"q", " ", "and", " ", "U"}], "Subsubsection"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qU", "[", 
      RowBox[{"params_", ",", "E0_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "Vg", ",", "\[Omega]x", ",", "\[Omega]z", ",", "\[Mu]", ",", 
         "\[CapitalDelta]mx", ",", "II", ",", "\[Epsilon]F", ",", "hmx", ",", 
         "H", ",", "\[Lambda]", ",", "U", ",", "q", ",", "rng", ",", "ord"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Vg", "=", 
         RowBox[{"params", "[", "\"\<Vg\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Omega]x", "=", 
         RowBox[{"params", "[", "\"\<\[Omega]x\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Omega]z", "=", 
         RowBox[{"params", "[", "\"\<\[Omega]z\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Mu]", "=", 
         RowBox[{"params", "[", "\"\<\[Mu]\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[CapitalDelta]mx", "=", 
         RowBox[{"\[CapitalDelta]Mx", "[", 
          RowBox[{"params", "[", "\"\<\[CapitalDelta]\>\"", "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"II", "=", 
         RowBox[{"IdentityMatrix", "[", "nChTr", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]F", "=", 
         RowBox[{"\[Mu]", "+", "Vg", "-", 
          FractionBox[
           RowBox[{"\[Omega]x", "+", "\[Omega]z"}], "2.0"]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"hmx", "=", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"\[Epsilon]F", "-", 
           RowBox[{"indTr", ".", 
            RowBox[{"{", 
             RowBox[{"\[Omega]x", ",", "\[Omega]z"}], "}"}]}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"H", "=", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {
              RowBox[{"hmx", "+", 
               RowBox[{"E0", " ", "II"}]}], 
              RowBox[{"-", "\[CapitalDelta]mx"}]},
             {
              RowBox[{"\[CapitalDelta]mx", "\[ConjugateTranspose]"}], 
              RowBox[{"hmx", "-", 
               RowBox[{"E0", " ", "II"}]}]}
            }], ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Lambda]", ",", "U"}], "}"}], "=", 
         RowBox[{"Eigensystem", "[", 
          RowBox[{"H", "/", "\[Mu]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{
          RowBox[{"Chop", "[", "\[Lambda]", "]"}], " ", "\[Mu]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Remove", " ", "very", " ", "small", " ", "numerical", " ", "error", 
          " ", "that", " ", "could", " ", "spoil", " ", "our", " ", 
          "analytical", " ", "continuation"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"rng", "=", 
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Reverse", "@", 
             RowBox[{"Range", "[", 
              RowBox[{"1", ",", "nChTr"}], "]"}]}], ",", 
            RowBox[{"-", 
             RowBox[{"Range", "[", 
              RowBox[{"1", ",", "nChTr"}], "]"}]}]}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ord", "=", 
         RowBox[{"Reverse", "@", 
          RowBox[{"Ordering", "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Total", "[", 
              RowBox[{"rng", " ", 
               RowBox[{"Abs", "[", 
                RowBox[{
                "U", "\[LeftDoubleBracket]", "i1", "\[RightDoubleBracket]"}], 
                "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "1", ",", 
               RowBox[{"2", "nChTr"}]}], "}"}]}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"U", "=", 
         RowBox[{
         "U", "\[LeftDoubleBracket]", "ord", "\[RightDoubleBracket]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]", "=", 
         RowBox[{
         "\[Lambda]", "\[LeftDoubleBracket]", "ord", 
          "\[RightDoubleBracket]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"U", "=", 
         RowBox[{"U", "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"q", "=", 
         FractionBox[
          SqrtBox[
           RowBox[{"2", " ", "mass", " ", "\[Lambda]"}]], "hbar"]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"q", ",", "U"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox["W", "Subsubsection"], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Clebsch", " ", "matrix", " ", "elements", " ", "between", " ", 
      "harmonic", " ", "oscillator", " ", "bases"}], "Text"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"<", 
       RowBox[{"n_", 
        RowBox[{"{", 
         RowBox[{"x", ",", "i"}], "}"}]}]}], "|", 
      RowBox[{
       RowBox[{"m_", 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{"i", "-", "1"}]}], "}"}]}], ">"}]}], " ", "=", " ", 
     RowBox[{"\[Integral]", 
      RowBox[{"dx", " ", "\[Phi]_n", 
       RowBox[{"(", 
        FractionBox["x", 
         RowBox[{"l_", 
          RowBox[{"{", 
           RowBox[{"x", ",", "i"}], "}"}]}]], ")"}], " ", "\[Phi]_m", 
       RowBox[{
        RowBox[{"(", 
         FractionBox["x", 
          RowBox[{"l_", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{"i", "-", "1"}]}], "}"}]}]], ")"}], "/", 
        SqrtBox[
         RowBox[{"l_", 
          RowBox[{"{", 
           RowBox[{"x", ",", "i"}], "}"}], " ", "l_", 
          RowBox[{"{", 
           RowBox[{"x", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}]}]]}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"<", 
       RowBox[{"n_", 
        RowBox[{"{", 
         RowBox[{"x", ",", "i"}], "}"}]}]}], "|", 
      RowBox[{
       RowBox[{"m_", 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{"i", "-", "1"}]}], "}"}]}], ">"}]}], " ", "=", " ", 
     RowBox[{"Clebsch", "[", 
      RowBox[{"n", ",", " ", "m", ",", " ", 
       RowBox[{"l_", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "i"}], "}"}], "/", "l_"}], 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{"i", "-", "1"}]}], "}"}]}]}], "]"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Checked", " ", "numerically", " ", "that", " ", "the", " ", 
     "implementation", " ", "is", " ", "correct"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Clebsch", "[", 
      RowBox[{"n_", ",", "m_", ",", "\[Gamma]_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       SqrtBox["\[Gamma]"], " ", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"n", "-", 
              RowBox[{"2", "l1"}]}], "\[Equal]", 
             RowBox[{"m", "-", 
              RowBox[{"2", "l2"}]}]}], ",", 
            RowBox[{"(", 
             RowBox[{
              SuperscriptBox["\[Alpha]", 
               RowBox[{"1", "+", "n", "-", 
                RowBox[{"2", "l1"}]}]], 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["\[Alpha]", "2"], "-", "1"}], ")"}], "l1"], 
              " ", 
              SuperscriptBox["\[Beta]", 
               RowBox[{"m", "-", 
                RowBox[{"2", " ", "l2"}]}]], 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{
                 SuperscriptBox["\[Beta]", "2"], "-", "1"}], ")"}], "l2"], 
              RowBox[{"Binomial", "[", 
               RowBox[{"n", ",", 
                RowBox[{"2", "l1"}]}], "]"}], 
              RowBox[{"Binomial", "[", 
               RowBox[{"m", ",", 
                RowBox[{"2", "l2"}]}], "]"}], 
              FractionBox[
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"2", " ", "l1"}], ")"}], "!"}], 
               RowBox[{"l1", "!"}]], " ", 
              FractionBox[
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"2", " ", "l2"}], ")"}], "!"}], 
               RowBox[{"l2", "!"}]], " ", 
              SuperscriptBox["2", 
               RowBox[{
                RowBox[{"-", "l1"}], "-", "l2"}]], 
              SqrtBox[
               FractionBox[
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"n", "-", 
                    RowBox[{"2", "l1"}]}], ")"}], "!"}], " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"m", "-", 
                    RowBox[{"2", "l2"}]}], ")"}], "!"}]}], 
                RowBox[{
                 RowBox[{"n", "!"}], " ", 
                 RowBox[{"m", "!"}]}]]]}], ")"}], ",", "0"}], "]"}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\[Alpha]", "\[Rule]", 
             SqrtBox[
              FractionBox["2", 
               RowBox[{"1", "+", 
                SuperscriptBox["\[Gamma]", "2"]}]]]}], ",", 
            RowBox[{"\[Beta]", "\[Rule]", 
             SqrtBox[
              FractionBox[
               RowBox[{"2", " ", 
                SuperscriptBox["\[Gamma]", "2"]}], 
               RowBox[{"1", "+", 
                SuperscriptBox["\[Gamma]", "2"]}]]]}]}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", "0", ",", 
           RowBox[{"Floor", "[", 
            RowBox[{"n", "/", "2"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"l2", ",", "0", ",", 
           RowBox[{"Floor", "[", 
            RowBox[{"m", "/", "2"}], "]"}]}], "}"}]}], "]"}]}], ")"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ClebschMx", "[", 
      RowBox[{"\[Gamma]_", ",", "nmax_"}], "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Clebsch", "[", 
        RowBox[{"n", ",", "m", ",", "\[Gamma]"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "0", ",", "nmax"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", "0", ",", "nmax"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Derivative", ":", " ", 
      RowBox[{
       RowBox[{"DClebsch", "[", 
        RowBox[{"n", ",", "m", ",", "\[Gamma]"}], "]"}], " ", "\[Equal]", " ", 
       RowBox[{"D", "[", 
        RowBox[{
         RowBox[{"Clebsch", "[", 
          RowBox[{"n", ",", "m", ",", "\[Gamma]"}], "]"}], ",", "\[Gamma]"}], 
        "]"}]}]}], "Text"], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DClebsch", "[", 
      RowBox[{"n_", ",", "m_", ",", "\[Gamma]_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          FractionBox["1", 
           RowBox[{"2", "\[Gamma]"}]], "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"n", "+", "1"}], ")"}], 
           FractionBox["\[Gamma]", 
            RowBox[{"1", "+", 
             SuperscriptBox["\[Gamma]", "2"]}]]}], "+", 
          FractionBox["m", 
           RowBox[{"\[Gamma]", " ", 
            RowBox[{"(", 
             RowBox[{"1", "+", 
              SuperscriptBox["\[Gamma]", "2"]}], ")"}]}]]}], ")"}], 
        RowBox[{"Clebsch", "[", 
         RowBox[{"n", ",", "m", ",", "\[Gamma]"}], "]"}]}], " ", "-", 
       RowBox[{
        FractionBox["\[Gamma]", 
         RowBox[{"1", "+", 
          SuperscriptBox["\[Gamma]", "2"]}]], " ", 
        SqrtBox[
         RowBox[{"n", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]], 
        RowBox[{"Clebsch", "[", 
         RowBox[{
          RowBox[{"n", "-", "2"}], ",", "m", ",", "\[Gamma]"}], "]"}]}], "+", 
       
       RowBox[{
        FractionBox[
         SqrtBox[
          RowBox[{"m", 
           RowBox[{"(", 
            RowBox[{"m", "-", "1"}], ")"}]}]], 
         RowBox[{"\[Gamma]", " ", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            SuperscriptBox["\[Gamma]", "2"]}], ")"}]}]], 
        RowBox[{"Clebsch", "[", 
         RowBox[{"n", ",", 
          RowBox[{"m", "-", "2"}], ",", "\[Gamma]"}], "]"}]}]}], ")"}]}], 
    ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DClebschMx", "[", 
      RowBox[{"\[Gamma]_", ",", "nmax_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Cl", ",", "DC"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Cl", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Clebsch", "[", 
            RowBox[{"n", ",", "m", ",", "\[Gamma]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "0", ",", "nmax"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", "0", ",", "nmax"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DC", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               FractionBox["1", 
                RowBox[{"2", "\[Gamma]"}]], "-", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"n", "+", "1"}], ")"}], 
                FractionBox["\[Gamma]", 
                 RowBox[{"1", "+", 
                  SuperscriptBox["\[Gamma]", "2"]}]]}], "+", 
               FractionBox["m", 
                RowBox[{"\[Gamma]", " ", 
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   SuperscriptBox["\[Gamma]", "2"]}], ")"}]}]]}], ")"}], 
             RowBox[{"Cl", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{"n", "+", "1"}], ",", 
               RowBox[{"m", "+", "1"}]}], "\[RightDoubleBracket]"}]}], "-", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"n", "\[GreaterEqual]", "2"}], ",", 
              RowBox[{
               FractionBox["\[Gamma]", 
                RowBox[{"1", "+", 
                 SuperscriptBox["\[Gamma]", "2"]}]], " ", 
               SqrtBox[
                RowBox[{"n", 
                 RowBox[{"(", 
                  RowBox[{"n", "-", "1"}], ")"}]}]], 
               RowBox[{"Cl", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"n", "-", "1"}], ",", 
                 RowBox[{"m", "+", "1"}]}], "\[RightDoubleBracket]"}]}], ",", 
              "0"}], "]"}], "+", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"m", "\[GreaterEqual]", "2"}], ",", 
              RowBox[{
               FractionBox[
                SqrtBox[
                 RowBox[{"m", 
                  RowBox[{"(", 
                   RowBox[{"m", "-", "1"}], ")"}]}]], 
                RowBox[{"\[Gamma]", " ", 
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   SuperscriptBox["\[Gamma]", "2"]}], ")"}]}]], 
               RowBox[{"Cl", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{"n", "+", "1"}], ",", 
                 RowBox[{"m", "-", "1"}]}], "\[RightDoubleBracket]"}]}], ",", 
              "0"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "0", ",", "nmax"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", "0", ",", "nmax"}], "}"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"DClebschMx0", "[", "nmax", "]"}], "\[Equal]", 
     RowBox[{"DClebschMx", "[", 
      RowBox[{"1", ",", "nmax"}], "]"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DClebschMx0", "[", "nmax_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"DC", ",", "m"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DC", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"nmax", "+", "1"}], ",", 
             RowBox[{"nmax", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"m", "=", "2"}], ",", 
          RowBox[{"m", "\[LessEqual]", "nmax"}], ",", 
          RowBox[{"m", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"DC", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"m", "-", "2", "+", "1"}], ",", 
              RowBox[{"m", "+", "1"}]}], "\[RightDoubleBracket]"}], "=", 
            RowBox[{
             FractionBox["1", "2"], 
             SqrtBox[
              RowBox[{"m", 
               RowBox[{"(", 
                RowBox[{"m", "-", "1"}], ")"}]}]]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"DC", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{"m", "+", "1"}], ",", 
              RowBox[{"m", "-", "2", "+", "1"}]}], "\[RightDoubleBracket]"}], 
            "=", 
            RowBox[{"-", 
             RowBox[{"DC", "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{"m", "-", "2", "+", "1"}], ",", 
               RowBox[{"m", "+", "1"}]}], "\[RightDoubleBracket]"}]}]}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "DC"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Unitary", " ", "version", " ", "of", " ", "ClebschMx"}], "Text"],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"UClebschMx", "[", 
      RowBox[{"\[Gamma]_", ",", "nmax_"}], "]"}], ":=", 
     RowBox[{"MatrixExp", "[", 
      RowBox[{
       RowBox[{"Log", "[", "\[Gamma]", "]"}], " ", 
       RowBox[{"DClebschMx0", "[", "nmax", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "The", " ", "Clebsch", " ", "coefficients", " ", "of", " ", "course", 
      " ", "form", " ", "a", " ", "unitary", " ", "matrix"}], ",", " ", 
     RowBox[{
     "but", " ", "truncation", " ", "in", " ", "channel", " ", "number", " ", 
      "spoils", " ", "its", " ", 
      RowBox[{"unitarity", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "We", " ", "therefore", " ", "take", " ", "the", " ", "derivative", " ", 
      
      RowBox[{"w", ".", "r", ".", "t", ".", " ", 
       RowBox[{"Log", "[", "\[Gamma]", "]"}]}], " ", "at", " ", "\[Gamma]"}], 
     "\[Equal]", 
     RowBox[{"1", " ", "and", " ", "exponentialize", " ", "this", " ", 
      RowBox[{"operator", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Note", ":", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"ClebschMx", "[", "\[Gamma]1", "]"}], ".", 
        RowBox[{"ClebschMx", "[", "\[Gamma]2", "]"}]}], " ", "\[Equal]", " ", 
       
       RowBox[{"ClebschMx", "[", 
        RowBox[{"\[Gamma]1", " ", "\[Gamma]2"}], "]"}]}]}], ",", " ", 
     RowBox[{
     "thus", " ", "the", " ", "exponentialization", " ", "is", " ", 
      "governed", " ", "by", " ", 
      RowBox[{"Log", "[", "\[Gamma]", "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"since", " ", 
       RowBox[{"Log", "[", 
        RowBox[{"\[Gamma]1", " ", "\[Gamma]2"}], "]"}]}], "\[Equal]", 
      RowBox[{
       RowBox[{"Log", "[", "\[Gamma]1", "]"}], "+", 
       RowBox[{"Log", "[", "\[Gamma]2", "]"}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"As", " ", "a", " ", "rule", " ", "of", " ", "thumb"}], ",", " ", 
     RowBox[{
     "UClebschMx", " ", "approximates", " ", "ClebschMx", " ", "very", " ", 
      "well", " ", 
      RowBox[{"(", 
       RowBox[{"to", " ", 
        SuperscriptBox["10", 
         RowBox[{"-", "6"}]]}], ")"}], " ", "for", " ", "channels", " ", 
      "below", " ", 
      RowBox[{"nmax", "/", "2"}]}], ",", " ", 
     RowBox[{
     "even", " ", "for", " ", "\[Gamma]", " ", "as", " ", "large", " ", "as", 
      " ", 
      RowBox[{"1.25", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "W", " ", "matrix", " ", "for", " ", "both", " ", "x", " ", "and", " ", 
      "z", " ", "directions"}], "Text"], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"W", "\[LeftDoubleBracket]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"n_", 
          RowBox[{"{", 
           RowBox[{"x", ",", "i"}], "}"}]}], ",", " ", 
         RowBox[{"n_", 
          RowBox[{"{", 
           RowBox[{"z", ",", "i"}], "}"}]}]}], ")"}], ",", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m_", 
          RowBox[{"{", 
           RowBox[{"x", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}]}], ",", " ", 
         RowBox[{"m_", 
          RowBox[{"{", 
           RowBox[{"z", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}]}]}], ")"}]}], 
      "\[RightDoubleBracket]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{"<", 
       RowBox[{"n_", 
        RowBox[{"{", 
         RowBox[{"x", ",", "i"}], "}"}]}]}], "|", 
      RowBox[{
       RowBox[{"m_", 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{"i", "-", "1"}]}], "}"}]}], ">", " ", "<", 
       RowBox[{"n_", 
        RowBox[{"{", 
         RowBox[{"z", ",", "i"}], "}"}]}]}], "|", 
      RowBox[{
       RowBox[{"m_", 
        RowBox[{"{", 
         RowBox[{"z", ",", 
          RowBox[{"i", "-", "1"}]}], "}"}]}], ">"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"\[Gamma]x", " ", "=", " ", 
      RowBox[{
       RowBox[{"l_", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "i"}], "}"}], "/", "l_"}], 
        RowBox[{"{", 
         RowBox[{"x", ",", 
          RowBox[{"i", "-", "1"}]}], "}"}]}], "=", 
       SqrtBox[
        RowBox[{"\[Omega]_", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"x", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}], "/", "\[Omega]_"}], 
         RowBox[{"{", 
          RowBox[{"x", ",", "i"}], "}"}]}]]}]}], ",", " ", 
     RowBox[{"\[Gamma]z", " ", "=", " ", 
      RowBox[{
       RowBox[{"l_", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"z", ",", "i"}], "}"}], "/", "l_"}], 
        RowBox[{"{", 
         RowBox[{"z", ",", 
          RowBox[{"i", "-", "1"}]}], "}"}]}], "=", 
       SqrtBox[
        RowBox[{"\[Omega]_", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"z", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}], "/", "\[Omega]_"}], 
         RowBox[{"{", 
          RowBox[{"z", ",", "i"}], "}"}]}]]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Tested", " ", "that", " ", "it", " ", "works", " ", "properly"}],
     " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"W", "[", 
      RowBox[{"\[Gamma]x_", ",", "\[Gamma]z_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nChTr", ",", " ", "WMx", ",", "Clx", ",", "Clz"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nChTr", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"nzmaxTr", "+", "1"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Clx", " ", "=", " ", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Clebsch", "[", 
            RowBox[{"nx", ",", "mx", ",", "\[Gamma]x"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nx", ",", "0", ",", "nxmaxTr"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"mx", ",", "0", ",", "nxmaxTr"}], "}"}]}], "]"}]}], ";", 
        " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Clebsch", " ", "coeffs", " ", "in", " ", "the", " ", "x", " ", 
          "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Clz", " ", "=", " ", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Clebsch", "[", 
            RowBox[{"nz", ",", "mz", ",", "\[Gamma]z"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"nz", ",", "0", ",", "nzmaxTr"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"mz", ",", "0", ",", "nzmaxTr"}], "}"}]}], "]"}]}], ";", 
        "  ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Clebsch", " ", "coeffs", " ", "in", " ", "the", " ", "z", " ", 
          "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"WMx", " ", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Clx", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i1", "-", "1"}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"nzmaxTr", "+", "1"}], ")"}]}], "]"}], "+", "1"}], 
              ",", " ", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i2", "-", "1"}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"nzmaxTr", "+", "1"}], ")"}]}], "]"}], "+", "1"}]}],
              "\[RightDoubleBracket]"}], " ", 
            RowBox[{"Clz", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"Mod", "[", 
                RowBox[{
                 RowBox[{"i1", "-", "1"}], ",", " ", 
                 RowBox[{"nzmaxTr", "+", "1"}]}], "]"}], "+", "1"}], ",", 
              RowBox[{
               RowBox[{"Mod", "[", 
                RowBox[{
                 RowBox[{"i2", "-", "1"}], ",", " ", 
                 RowBox[{"nzmaxTr", "+", "1"}]}], "]"}], "+", "1"}]}], 
             "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", "1", ",", "nChTr"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "1", ",", "nChTr"}], "}"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Unitary", " ", "approximation", " ", "of", " ", "the", " ", "W", " ", 
      "matrix"}], "Text"], " ", 
    StyleBox[
     RowBox[{
      StyleBox["*",
       FontSize->12], ")"}]]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"UW", "[", 
      RowBox[{"\[Gamma]x_", ",", "\[Gamma]z_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"nChTr", ",", " ", "WMx", ",", "Clx", ",", "Clz"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nChTr", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
          RowBox[{"(", 
           RowBox[{"nzmaxTr", "+", "1"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Clx", " ", "=", 
         RowBox[{"UClebschMx", "[", 
          RowBox[{"\[Gamma]x", ",", "nxmaxTr"}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Clebsch", " ", "coeffs", " ", "in", " ", "the", " ", "x", " ", 
          "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Clz", " ", "=", 
         RowBox[{"UClebschMx", "[", 
          RowBox[{"\[Gamma]z", ",", "nzmaxTr"}], "]"}]}], ";", "  ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Clebsch", " ", "coeffs", " ", "in", " ", "the", " ", "z", " ", 
          "direction"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"WMx", " ", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Clx", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"indTr", "\[LeftDoubleBracket]", 
                RowBox[{"i1", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
               "1"}], ",", " ", 
              RowBox[{
               RowBox[{"indTr", "\[LeftDoubleBracket]", 
                RowBox[{"i2", ",", "1"}], "\[RightDoubleBracket]"}], "+", 
               "1"}]}], "\[RightDoubleBracket]"}], " ", 
            RowBox[{"Clz", "\[LeftDoubleBracket]", 
             RowBox[{
              RowBox[{
               RowBox[{"indTr", "\[LeftDoubleBracket]", 
                RowBox[{"i1", ",", "2"}], "\[RightDoubleBracket]"}], "+", 
               "1"}], ",", 
              RowBox[{
               RowBox[{"indTr", "\[LeftDoubleBracket]", 
                RowBox[{"i2", ",", "2"}], "\[RightDoubleBracket]"}], "+", 
               "1"}]}], "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", "1", ",", "nChTr"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", "1", ",", "nChTr"}], "}"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Manipulation", " ", "of", " ", "scattering", " ", "and", " ", "tranfer",
       " ", "matrices"}], "Subsubsection"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"S2M", "[", "S_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n", ",", "r", ",", "t", ",", "rp", ",", "tp", ",", "Maa", ",", "Mab",
          ",", "Mba", ",", "Mbb", ",", "M"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Dimensions", "[", "S", "]"}], "\[LeftDoubleBracket]", "1",
            "\[RightDoubleBracket]"}], "/", "2"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"r", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "n"}], ",", 
           RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"t", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}], ",", 
           RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tp", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "n"}], ",", 
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rp", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}], ",", 
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Maa", "=", 
         RowBox[{"(", 
          RowBox[{"t", "-", 
           RowBox[{"rp", ".", 
            RowBox[{"Inverse", "[", "tp", "]"}], ".", "r"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Mab", "=", 
         RowBox[{"rp", ".", 
          RowBox[{"Inverse", "[", "tp", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Mba", "=", 
         RowBox[{"(", 
          RowBox[{"-", 
           RowBox[{
            RowBox[{"Inverse", "[", "tp", "]"}], ".", "r"}]}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Mbb", "=", 
         RowBox[{"Inverse", "[", "tp", "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"M", "=", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {"Maa", "Mab"},
             {"Mba", "Mbb"}
            }], ")"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"M2S", "[", "M_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "n", ",", "Maa", ",", "Mab", ",", "Mba", ",", "Mbb", ",", "r", ",", 
        "t", ",", "rp", ",", "tp", ",", "S"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Dimensions", "[", "M", "]"}], "\[LeftDoubleBracket]", "1",
            "\[RightDoubleBracket]"}], "/", "2"}], ")"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Maa", "=", 
        RowBox[{"M", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "n"}], ",", 
          RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Mab", "=", 
        RowBox[{"M", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "n"}], ",", 
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Mba", "=", 
        RowBox[{"M", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}], ",", 
          RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Mbb", "=", 
        RowBox[{"M", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}], ",", 
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"r", "=", 
        RowBox[{"(", 
         RowBox[{"-", 
          RowBox[{
           RowBox[{"Inverse", "[", "Mbb", "]"}], ".", "Mba"}]}], ")"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"tp", "=", 
        RowBox[{"Inverse", "[", "Mbb", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"t", "=", 
        RowBox[{"(", 
         RowBox[{"Maa", "-", 
          RowBox[{"Mab", ".", 
           RowBox[{"Inverse", "[", "Mbb", "]"}], ".", "Mba"}]}], ")"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"rp", "=", 
        RowBox[{"Mab", ".", 
         RowBox[{"Inverse", "[", "Mbb", "]"}]}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"S", "=", 
        RowBox[{"ArrayFlatten", "[", 
         RowBox[{"(", GridBox[{
            {"r", "tp"},
            {"t", "rp"}
           }], ")"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "Concatenation", " ", "of", " ", "two", " ", "S", " ", "matrices"}], ",",
      " ", 
     RowBox[{"following", " ", "Brouwer", " ", "et", " ", 
      RowBox[{"al", "."}]}], ",", " ", 
     RowBox[{"PRB", " ", "84"}], ",", " ", 
     RowBox[{"144526", " ", 
      RowBox[{
       RowBox[{"(", "2011", ")"}], "."}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"If", " ", "M1"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"S2M", "[", "S1", "]"}], " ", "and", " ", "M2"}], "=", 
       RowBox[{"S2M", "[", "S2", "]"}]}]}], ",", " ", 
     RowBox[{
      RowBox[{"then", " ", 
       RowBox[{"Scat", "[", 
        RowBox[{"S1", ",", "S2"}], "]"}]}], "\[Equal]", 
      RowBox[{
       RowBox[{"M2S", "[", 
        RowBox[{"M2", ".", "M1"}], "]"}], "."}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SCat", "[", 
     RowBox[{"S1_", ",", "S2_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "n", ",", "II", ",", "r1", ",", "r2", ",", "t1", ",", "t2", ",", "rp1",
         ",", "rp2", ",", "tp1", ",", "tp2", ",", "r12", ",", "t12", ",", 
        "rp12", ",", "tp12", ",", "S12"}], "}"}], ",", "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{"n", "=", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"Dimensions", "[", "S1", "]"}], "\[LeftDoubleBracket]", 
           "1", "\[RightDoubleBracket]"}], "/", "2"}], ")"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"II", "=", 
        RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"r1", "=", 
        RowBox[{"S1", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "n"}], ",", 
          RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t1", "=", 
        RowBox[{"S1", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}], ",", 
          RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tp1", "=", 
        RowBox[{"S1", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "n"}], ",", 
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"rp1", "=", 
        RowBox[{"S1", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}], ",", 
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"r2", "=", 
        RowBox[{"S2", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "n"}], ",", 
          RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t2", "=", 
        RowBox[{"S2", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}], ",", 
          RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tp2", "=", 
        RowBox[{"S2", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", "n"}], ",", 
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"rp2", "=", 
        RowBox[{"S2", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}], ",", 
          RowBox[{
           RowBox[{"n", "+", "1"}], ";;", 
           RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"r12", "=", 
        RowBox[{"(", 
         RowBox[{"r1", "+", 
          RowBox[{"tp1", ".", 
           RowBox[{"Inverse", "[", 
            RowBox[{"II", "-", 
             RowBox[{"r2", ".", "rp1"}]}], "]"}], ".", "r2", ".", "t1"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"t12", "=", 
        RowBox[{"(", 
         RowBox[{"t2", ".", 
          RowBox[{"Inverse", "[", 
           RowBox[{"II", "-", 
            RowBox[{"rp1", ".", "r2"}]}], "]"}], ".", "t1"}], ")"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"tp12", "=", 
        RowBox[{"(", 
         RowBox[{"tp1", ".", 
          RowBox[{"Inverse", "[", 
           RowBox[{"II", "-", 
            RowBox[{"r2", ".", "rp1"}]}], "]"}], ".", "tp2"}], ")"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"rp12", "=", 
        RowBox[{"(", 
         RowBox[{"rp2", "+", 
          RowBox[{"t2", ".", 
           RowBox[{"Inverse", "[", 
            RowBox[{"II", "-", 
             RowBox[{"rp1", ".", "r2"}]}], "]"}], ".", "rp1", ".", "tp2"}]}], 
         ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"S12", "=", 
        RowBox[{"ArrayFlatten", "[", 
         RowBox[{"(", GridBox[{
            {"r12", "tp12"},
            {"t12", "rp12"}
           }], ")"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rt", "[", "S_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n", ",", "r", ",", "t", ",", "rp", ",", "tp"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Function", " ", "to", " ", "extract", " ", "the", " ", "reflection", 
         " ", "and", " ", "transmission", " ", "coefficients", " ", 
         RowBox[{"(", 
          RowBox[{"r", ",", 
           RowBox[{"r", "'"}], ",", "t", ",", 
           RowBox[{"t", "'"}]}], ")"}], " ", "from", " ", "the", " ", 
         "scattering", " ", "matrix", " ", "S"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"n", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"Dimensions", "[", "S", "]"}], "\[LeftDoubleBracket]", 
            "1", "\[RightDoubleBracket]"}], "/", "2"}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"r", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "n"}], ",", 
           RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"t", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}], ",", 
           RowBox[{"1", ";;", "n"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tp", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "n"}], ",", 
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rp", "=", 
         RowBox[{"S", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}], ",", 
           RowBox[{
            RowBox[{"n", "+", "1"}], ";;", 
            RowBox[{"2", "n"}]}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"r", ",", "t", ",", "rp", ",", "tp"}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Setting", " ", "up", " ", "the", " ", "ideal", " ", "stepsize"}], 
     "Subsubsection"], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Gamma]max", "[", "nmax_", "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{"1.01", "+", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"nmax", "<", "40"}], ",", 
         RowBox[{"0.01", " ", "nmax"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"0.4", " ", "+", 
            RowBox[{"0.003", " ", 
             RowBox[{"(", 
              RowBox[{"nmax", "-", "40"}], ")"}]}]}], ",", "0.6"}], "]"}]}], 
        "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "This", " ", "function", " ", "tells", " ", "us", " ", "the", " ", 
     "ideal", " ", "value", " ", "of", " ", "\[Gamma]", " ", "that", " ", 
     "we", " ", "are", " ", "allowed", " ", "to", " ", "take", " ", "when", 
     " ", "calculating", " ", 
     RowBox[{"UW", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"With", " ", "this", " ", "choice", " ", "the", " ", "error", " ", 
     RowBox[{"Norm", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ClebschMx", "[", 
          RowBox[{"\[Gamma]", ",", "nmax"}], "]"}], "-", 
         RowBox[{"UClebschMx", "[", 
          RowBox[{"\[Gamma]", ",", "nmax"}], "]"}]}], ")"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{
        RowBox[{"1", ";;", 
         RowBox[{"Floor", "@", 
          FractionBox[
           RowBox[{"nmax", "+", "1"}], "2"]}]}], ",", 
        RowBox[{"1", ";;", 
         RowBox[{"Floor", "@", 
          FractionBox[
           RowBox[{"nmax", "+", "1"}], "2"]}]}]}], "\[RightDoubleBracket]"}], 
      "]"}], " ", "is", " ", "smaller", " ", "than", " ", 
     RowBox[{
      SuperscriptBox["10", 
       RowBox[{"-", "6"}]], "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qmaxValue", "[", 
      RowBox[{"y_", ",", "nxmaxTr_", ",", "nzmaxTr_"}], "]"}], ":=", 
     RowBox[{"Abs", "[", 
      RowBox[{
       SqrtBox[
        RowBox[{"2", " ", "mass", 
         RowBox[{"(", 
          RowBox[{"\[Mu]", "+", 
           RowBox[{"Vg", "[", "y", "]"}], "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nxmaxTr", "+", 
              FractionBox["1", "2"]}], ")"}], 
            RowBox[{"\[Omega]x", "[", "y", "]"}]}], "-", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nzmaxTr", "+", 
              FractionBox["1", "2"]}], ")"}], 
            RowBox[{"\[Omega]z", "[", "y", "]"}]}]}], ")"}]}]], "/", "hbar"}],
       "]"}]}], ";"}], " ", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "The", " ", "absolute", " ", "value", " ", "of", " ", "the", " ", 
     "largest", " ", "q", " ", "momentum"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]Fmin", "[", 
      RowBox[{"params_", ",", "nxmaxTr_", ",", "nzmaxTr_"}], "]"}], ":=", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"params", "[", "\"\<\[Mu]\>\"", "]"}], "+", 
       RowBox[{"params", "[", "\"\<Vg\>\"", "]"}], "-", 
       RowBox[{
        RowBox[{"params", "[", "\"\<\[Omega]x\>\"", "]"}], 
        RowBox[{"(", 
         RowBox[{"nxmaxTr", "+", "0.5"}], ")"}]}], "-", 
       RowBox[{
        RowBox[{"params", "[", "\"\<\[Omega]z\>\"", "]"}], 
        RowBox[{"(", 
         RowBox[{"nzmaxTr", "+", "0.5"}], ")"}]}]}], ")"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"yGrid", "[", 
      RowBox[{
      "ymin_", ",", "ymax_", ",", "nxmaxSm_", ",", "nxmaxLg_", ",", 
       "nzmaxSm_", ",", "nzmaxLg_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ymin1", ",", "ymax1", ",", "y", ",", "\[CapitalDelta]y", ",", 
         "\[Gamma]xmax", ",", "\[Gamma]zmax", ",", "\[Gamma]x", ",", 
         "\[Gamma]z", ",", "yValues", ",", "qmaxVal"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Function", " ", "that", " ", "divides", " ", "the", " ", 
         RowBox[{"interval", " ", "[", 
          RowBox[{"ymin", ",", " ", "ymax"}], "]"}], " ", "for", " ", 
         RowBox[{"us", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "Since", " ", "during", " ", "a", " ", "simulation", " ", "I", " ", 
          "may", " ", "take", " ", "different", " ", "values", " ", "of", " ",
           "nxmaxTr", " ", "and", " ", "nzmaxTr"}], ",", " ", 
         RowBox[{
         "but", " ", "I", " ", "want", " ", "to", " ", "use", " ", "the", " ",
           "same", " ", "spatial", " ", "grid", " ", "for", " ", "all", " ", 
          "of", " ", "these", " ", 
          RowBox[{"runs", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"nxmaxSm", " ", "\[Equal]", " ", 
         RowBox[{"smallest", " ", "value", " ", "of", " ", 
          RowBox[{"nxmaxTr", ".", " ", "Similarly"}], " ", "for", " ", 
          RowBox[{"nzmaxSm", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"nxmaxLg", " ", "\[Equal]", " ", 
         RowBox[{"largest", " ", "value", " ", "of", " ", 
          RowBox[{"nxmaxTr", ".", " ", "Similarly"}], " ", "for", " ", 
          RowBox[{"nzmaxLg", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Conditions", " ", "enforced", " ", 
           RowBox[{"(", 
            RowBox[{
            "in", " ", "order", " ", "to", " ", "avoid", " ", "numerical", 
             " ", "errors"}], ")"}]}], ":", " ", 
          RowBox[{"\[CapitalDelta]y", "<", 
           RowBox[{"\[Lambda]F", "/", "3"}]}]}], ",", " ", 
         RowBox[{"\[Gamma]x", "\[LessEqual]", 
          RowBox[{"\[Gamma]max", "[", "nxmaxSm", "]"}]}], ",", " ", 
         RowBox[{"\[Gamma]z", "\[LessEqual]", 
          RowBox[{"\[Gamma]max", "[", "nzmaxSm", "]"}]}], ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"qmaxValue", "[", 
            RowBox[{"y", ",", "nxmaxLg", ",", "nzmaxLg"}], "]"}], 
           "\[CapitalDelta]y"}], "<", "3"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ymin1", "=", "ymin"}], ";", "\[IndentingNewLine]", 
        RowBox[{"ymax1", "=", "ymax"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"In", " ", "earlier", " ", "versions"}], ",", " ", 
          RowBox[{
          "we", " ", "ensured", " ", "that", " ", "at", " ", "the", " ", 
           "end", " ", "of", " ", "the", " ", "channel"}], ",", " ", 
          RowBox[{
          "all", " ", "bands", " ", "were", " ", "below", " ", "the", " ", 
           "chemical", " ", 
           RowBox[{"potential", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"If", " ", "not"}], ",", " ", 
          RowBox[{
          "then", " ", "we", " ", "took", " ", "a", " ", "longer", " ", 
           RowBox[{"channel", ".", " ", "However"}]}], ",", " ", 
          RowBox[{
          "this", " ", "feature", " ", "had", " ", "become", " ", 
           "unnecessary", " ", "and", " ", "wrong", " ", "due", " ", "to", 
           " ", "the", " ", "updates", " ", "in", " ", 
           RowBox[{"Stotal", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Epsilon]Fmin", "[", 
              RowBox[{
               RowBox[{"params", "[", "ymin1", "]"}], ",", "nxmaxLg", ",", 
               "nzmaxLg"}], "]"}], "\[LessEqual]", "0"}], ",", 
            RowBox[{
             RowBox[{"ymin1", "-=", "\[Lambda]F"}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"While", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Epsilon]Fmin", "[", 
              RowBox[{
               RowBox[{"params", "[", "ymax1", "]"}], ",", "nxmaxLg", ",", 
               "nzmaxLg"}], "]"}], "\[LessEqual]", "0"}], ",", 
            RowBox[{
             RowBox[{"ymax1", "+=", "\[Lambda]F"}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ymax", "\[NotEqual]", "ymax1"}], ",", 
            RowBox[{"Print", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Waveguide had to be enlarged so that all channels are \
below the chemical potential at the leads.\>\"", ",", "Red"}], "]"}], "]"}]}],
            "]"}], ";"}], "\[IndentingNewLine]", "*)"}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"\[Gamma]xmax", "=", 
         RowBox[{"\[Gamma]max", "[", "nxmaxSm", "]"}]}], ";", " ", 
        RowBox[{"\[Gamma]zmax", "=", 
         RowBox[{"\[Gamma]max", "[", "nzmaxSm", "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "Maximal", " ", "value", " ", "of", " ", "\[Gamma]", " ", "allowed",
            " ", "in", " ", "the", " ", "x", " ", "and", " ", "the", " ", "z",
            " ", "direction"}], ",", " ", 
          RowBox[{"respectively", "."}]}], " ", "*)"}], "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"y", "=", "ymin1"}], ";", 
        RowBox[{"\[CapitalDelta]y", " ", "=", " ", "\[Lambda]F"}], ";", 
        RowBox[{"yValues", "=", 
         RowBox[{"{", "y", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{
          RowBox[{"y", "<", "ymax1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[Gamma]x", "=", 
            SqrtBox[
             FractionBox[
              RowBox[{"\[Omega]x", "[", 
               RowBox[{"y", "+", "\[CapitalDelta]y"}], "]"}], 
              RowBox[{"\[Omega]x", "[", "y", "]"}]]]}], ";", " ", 
           RowBox[{"\[Gamma]x", "=", 
            RowBox[{"Max", "[", 
             RowBox[{"\[Gamma]x", ",", 
              FractionBox["1", "\[Gamma]x"]}], "]"}]}], ";", " ", 
           RowBox[{"\[Gamma]z", "=", 
            SqrtBox[
             FractionBox[
              RowBox[{"\[Omega]z", "[", 
               RowBox[{"y", "+", "\[CapitalDelta]y"}], "]"}], 
              RowBox[{"\[Omega]z", "[", "y", "]"}]]]}], ";", " ", 
           RowBox[{"\[Gamma]z", "=", 
            RowBox[{"Max", "[", 
             RowBox[{"\[Gamma]z", ",", 
              FractionBox["1", "\[Gamma]z"]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"qmaxVal", "=", 
            RowBox[{"qmaxValue", "[", 
             RowBox[{"y", ",", "nxmaxLg", ",", "nzmaxLg"}], "]"}]}], " ", ";",
            "\[IndentingNewLine]", 
           RowBox[{"While", "[", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"\[Gamma]x", "\[LessEqual]", "\[Gamma]xmax"}], " ", "&&",
                 " ", 
                RowBox[{"\[Gamma]z", "\[LessEqual]", "\[Gamma]zmax"}], "&&", 
                " ", 
                RowBox[{
                 RowBox[{"qmaxVal", " ", "\[CapitalDelta]y"}], " ", 
                 "\[LessEqual]", "3"}], "&&", 
                RowBox[{"\[CapitalDelta]y", "<", 
                 RowBox[{"\[Lambda]F", "/", "3"}]}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"\[CapitalDelta]y", "*=", "0.9"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"\[Gamma]x", "=", 
               SqrtBox[
                FractionBox[
                 RowBox[{"\[Omega]x", "[", 
                  RowBox[{"y", "+", "\[CapitalDelta]y"}], "]"}], 
                 RowBox[{"\[Omega]x", "[", "y", "]"}]]]}], ";", " ", 
              RowBox[{"\[Gamma]x", "=", 
               RowBox[{"Max", "[", 
                RowBox[{"\[Gamma]x", ",", 
                 FractionBox["1", "\[Gamma]x"]}], "]"}]}], ";", " ", 
              RowBox[{"\[Gamma]z", "=", 
               SqrtBox[
                FractionBox[
                 RowBox[{"\[Omega]z", "[", 
                  RowBox[{"y", "+", "\[CapitalDelta]y"}], "]"}], 
                 RowBox[{"\[Omega]z", "[", "y", "]"}]]]}], ";", " ", 
              RowBox[{"\[Gamma]z", "=", 
               RowBox[{"Max", "[", 
                RowBox[{"\[Gamma]z", ",", 
                 FractionBox["1", "\[Gamma]z"]}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"y", "=", 
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"y", "+", "\[CapitalDelta]y"}], ",", "ymax1"}], "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"yValues", ",", "y"}], "]"}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"\[CapitalDelta]y", "*=", "1.1"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "yValues"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Checked", " ", "numerically"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Scattering", " ", "calculation"}], "Subsubsection"], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"M", "[", 
      RowBox[{
      "paramsL_", ",", "paramsS_", ",", "paramsR_", ",", "\[CapitalDelta]y_", 
       ",", "E0_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "VgL", ",", "\[Omega]xL", ",", "\[Omega]zL", ",", "VgS", ",", 
         "\[Omega]xS", ",", "\[Omega]zS", ",", "\[CapitalDelta]S", ",", "VgR",
          ",", "\[Omega]xR", ",", "\[Omega]zR", ",", "\[Mu]", ",", 
         "\[Epsilon]FL", ",", "\[Epsilon]FR", ",", "qeL", ",", "qhL", ",", 
         "qeR", ",", "qhR", ",", "veL", ",", "veR", ",", "vhL", ",", "vhR", 
         ",", "qS", ",", "US", ",", "II", ",", "ZZ", ",", "zz", ",", "Pi4", 
         ",", "WL", ",", "WR", ",", "WRU", ",", "IUWL", ",", "cosq", ",", 
         "sinq", ",", "M"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"paramsL", ":", " ", 
         RowBox[{
         "parameters", " ", "of", " ", "the", " ", "left", " ", "imaginary", 
          " ", "lead"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"paramsR", ":", " ", 
         RowBox[{
         "parameters", " ", "of", " ", "the", " ", "right", " ", "imaginary", 
          " ", "lead"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"paramsS", ":", " ", 
         RowBox[{
         "parameters", " ", "of", " ", "the", " ", "system", " ", "in", " ", 
          "between"}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"E0", ":", " ", 
         RowBox[{
         "energy", " ", "of", " ", "the", " ", "particle", " ", "measured", 
          " ", "from", " ", "the", " ", "chemical", " ", "potential", " ", 
          "of", " ", "the", " ", "system"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"VgL", "=", 
         RowBox[{"paramsL", "[", "\"\<Vg\>\"", "]"}]}], ";", "  ", 
        RowBox[{"\[Omega]xL", "=", 
         RowBox[{"paramsL", "[", "\"\<\[Omega]x\>\"", "]"}]}], ";", "  ", 
        RowBox[{"\[Omega]zL", "=", 
         RowBox[{"paramsL", "[", "\"\<\[Omega]z\>\"", "]"}]}], ";", "  ", 
        "\[IndentingNewLine]", 
        RowBox[{"VgS", "=", 
         RowBox[{"paramsS", "[", "\"\<Vg\>\"", "]"}]}], ";", "  ", 
        RowBox[{"\[Omega]xS", "=", 
         RowBox[{"paramsS", "[", "\"\<\[Omega]x\>\"", "]"}]}], ";", "  ", 
        RowBox[{"\[Omega]zS", "=", 
         RowBox[{"paramsS", "[", "\"\<\[Omega]z\>\"", "]"}]}], ";", "  ", 
        RowBox[{"\[CapitalDelta]S", "=", 
         RowBox[{"paramsS", "[", "\"\<\[CapitalDelta]\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"VgR", "=", 
         RowBox[{"paramsR", "[", "\"\<Vg\>\"", "]"}]}], ";", "  ", 
        RowBox[{"\[Omega]xR", "=", 
         RowBox[{"paramsR", "[", "\"\<\[Omega]x\>\"", "]"}]}], ";", "  ", 
        RowBox[{"\[Omega]zR", "=", 
         RowBox[{"paramsR", "[", "\"\<\[Omega]z\>\"", "]"}]}], ";", "  ", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Mu]", "=", 
         RowBox[{"paramsS", "[", "\"\<\[Mu]\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"Parameters", " ", "of", " ", "the", " ", "leads"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]FL", "=", 
         RowBox[{"(", 
          RowBox[{"\[Mu]", "+", "VgL", "-", 
           FractionBox[
            RowBox[{"\[Omega]xL", "+", "\[Omega]zL"}], "2.0"], "-", 
           RowBox[{"indTr", ".", 
            RowBox[{"{", 
             RowBox[{"\[Omega]xL", ",", "\[Omega]zL"}], "}"}]}]}], ")"}]}], 
        ";", "  ", 
        RowBox[{"qeL", "=", 
         FractionBox[
          SqrtBox[
           RowBox[{"2", " ", "mass", " ", 
            RowBox[{"(", 
             RowBox[{"\[Epsilon]FL", "+", "E0"}], ")"}]}]], "hbar"]}], ";", 
        "  ", 
        RowBox[{"qhL", "=", 
         RowBox[{"-", 
          FractionBox[
           SqrtBox[
            RowBox[{"2", " ", "mass", " ", 
             RowBox[{"(", 
              RowBox[{"\[Epsilon]FL", "-", "E0"}], ")"}]}]], "hbar"]}]}], ";", 
        RowBox[{"veL", " ", "=", 
         FractionBox[
          RowBox[{"hbar", " ", "qeL"}], "mass"]}], ";", " ", 
        RowBox[{"vhL", "=", 
         RowBox[{"-", 
          FractionBox[
           RowBox[{"hbar", " ", "qhL"}], "mass"]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Epsilon]FR", "=", 
         RowBox[{"(", 
          RowBox[{"\[Mu]", "+", "VgR", "-", 
           FractionBox[
            RowBox[{"\[Omega]xR", "+", "\[Omega]zR"}], "2.0"], "-", 
           RowBox[{"indTr", ".", 
            RowBox[{"{", 
             RowBox[{"\[Omega]xR", ",", "\[Omega]zR"}], "}"}]}]}], ")"}]}], 
        ";", "  ", 
        RowBox[{"qeR", "=", 
         FractionBox[
          SqrtBox[
           RowBox[{"2", " ", "mass", " ", 
            RowBox[{"(", 
             RowBox[{"\[Epsilon]FR", "+", "E0"}], ")"}]}]], "hbar"]}], ";", 
        "  ", 
        RowBox[{"qhR", "=", 
         RowBox[{"-", 
          FractionBox[
           SqrtBox[
            RowBox[{"2", " ", "mass", " ", 
             RowBox[{"(", 
              RowBox[{"\[Epsilon]FR", "-", "E0"}], ")"}]}]], "hbar"]}]}], ";", 
        RowBox[{"veR", " ", "=", 
         FractionBox[
          RowBox[{"hbar", " ", "qeR"}], "mass"]}], ";", " ", 
        RowBox[{"vhR", "=", 
         RowBox[{"(", 
          RowBox[{"-", 
           FractionBox[
            RowBox[{"hbar", " ", "qhR"}], "mass"]}], ")"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"qS", ",", "US"}], "}"}], "=", 
         RowBox[{"qU", "[", 
          RowBox[{"paramsS", ",", "E0"}], "]"}]}], ";", "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"WL", "=", 
         RowBox[{"UW", "[", 
          RowBox[{
           SqrtBox[
            FractionBox["\[Omega]xS", "\[Omega]xL"]], ",", 
           SqrtBox[
            FractionBox["\[Omega]zS", "\[Omega]zL"]]}], "]"}]}], ";", " ", 
        RowBox[{"WR", "=", 
         RowBox[{"UW", "[", 
          RowBox[{
           SqrtBox[
            FractionBox["\[Omega]xS", "\[Omega]xR"]], ",", 
           SqrtBox[
            FractionBox["\[Omega]zS", "\[Omega]zR"]]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Unitary", " ", "transformation", " ", "from", " ", "one", " ", 
          RowBox[{"harm", ".", " ", "osc", ".", " ", "basis"}], " ", "to", 
          " ", "the", " ", "other"}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"II", "=", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"2", "nChTr"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ZZ", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "nChTr"}], ",", 
             RowBox[{"2", "nChTr"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"zz", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"nChTr", ",", "nChTr"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Pi4", "=", 
         RowBox[{"(", 
          RowBox[{
           FractionBox["1", 
            SqrtBox["2.0"]], 
           RowBox[{"ArrayFlatten", "[", 
            RowBox[{"(", GridBox[{
               {"II", 
                RowBox[{"-", "II"}]},
               {"II", "II"}
              }], ")"}], "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"WRU", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"veR", "/", "vF"}], ",", 
                RowBox[{"vhR", "/", "vF"}]}], "}"}], "]"}], "]"}], "]"}], ".", 
           RowBox[{"ArrayFlatten", "[", GridBox[{
              {"WR", "zz"},
              {"zz", "WR"}
             }], "]"}], ".", "US"}], ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IUWL", "=", 
         RowBox[{"Inverse", "[", 
          RowBox[{
           RowBox[{"DiagonalMatrix", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"veL", "/", "vF"}], ",", 
                RowBox[{"vhL", "/", "vF"}]}], "}"}], "]"}], "]"}], "]"}], ".", 
           RowBox[{"ArrayFlatten", "[", GridBox[{
              {"WL", "zz"},
              {"zz", "WL"}
             }], "]"}], ".", "US"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"cosq", "=", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{"Cos", "[", 
           RowBox[{"qS", " ", "\[CapitalDelta]y"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"sinq", "=", 
         RowBox[{"DiagonalMatrix", "[", 
          RowBox[{
           RowBox[{"-", "\[ImaginaryI]"}], " ", 
           RowBox[{"Sin", "[", 
            RowBox[{"qS", " ", "\[CapitalDelta]y"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Max", "[", 
            RowBox[{"Abs", "[", 
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{"cosq", ",", "sinq"}], "}"}]}], "]"}], "]"}], ">", 
           "100"}], ",", 
          RowBox[{
          "Print", "[", 
           "\"\<Error in function M: \[CapitalDelta]y too large, may lead to \
large numerical errors.\>\"", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"M", "=", 
         RowBox[{"(", 
          RowBox[{"Pi4", ".", 
           RowBox[{"ArrayFlatten", "[", 
            RowBox[{"(", GridBox[{
               {"WRU", "ZZ"},
               {"ZZ", 
                RowBox[{
                 RowBox[{"DiagonalMatrix", "[", 
                  RowBox[{"Flatten", "@", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{"\[CapitalDelta]y", " ", "qeR"}], ")"}]}], ",", 
                    RowBox[{"1", "/", 
                    RowBox[{"(", 
                    RowBox[{"\[CapitalDelta]y", " ", "qhR"}], ")"}]}]}], 
                    "}"}]}], "]"}], ".", "WRU", ".", 
                 RowBox[{"DiagonalMatrix", "[", 
                  RowBox[{"\[CapitalDelta]y", " ", "qS"}], "]"}]}]}
              }], ")"}], "]"}], ".", 
           RowBox[{"ArrayFlatten", "[", 
            RowBox[{"(", GridBox[{
               {"cosq", "sinq"},
               {"sinq", "cosq"}
              }], ")"}], "]"}], ".", 
           RowBox[{"ArrayFlatten", "[", 
            RowBox[{"(", GridBox[{
               {"IUWL", "ZZ"},
               {"ZZ", 
                RowBox[{
                 RowBox[{"DiagonalMatrix", "[", 
                  RowBox[{"1", "/", 
                   RowBox[{"(", 
                    RowBox[{"\[CapitalDelta]y", " ", "qS"}], ")"}]}], "]"}], 
                 ".", "IUWL", ".", 
                 RowBox[{"DiagonalMatrix", "[", 
                  RowBox[{"Flatten", "@", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\[CapitalDelta]y", " ", "qeL"}], ",", 
                    RowBox[{"\[CapitalDelta]y", " ", "qhL"}]}], "}"}]}], 
                  "]"}]}]}
              }], ")"}], "]"}], ".", 
           RowBox[{"Pi4", "\[Transpose]"}]}], ")"}]}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
      RowBox[{
       RowBox[{
       "In", " ", "case", " ", "the", " ", "channel", " ", "is", " ", 
        "symmetric", " ", "and", " ", "we", " ", "are", " ", "interested", 
        " ", "in", " ", "the", " ", "E0"}], "=", 
       RowBox[{"0", " ", "case"}]}], ",", " ", 
      RowBox[{
      "we", " ", "can", " ", "halve", " ", "our", " ", "computation", " ", 
       "time", " ", "using", " ", "this", " ", 
       RowBox[{"routine", "."}]}]}], "Text"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"StotalSymm", "[", 
      RowBox[{"yValues_", ",", "params_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "iy", ",", "yValuesPos", ",", "ly", ",", "yS", ",", 
         "\[CapitalDelta]yS", ",", "paramsS", ",", "paramsL", ",", "paramsR", 
         ",", "i", ",", "II", ",", "ZZ", ",", "I0", ",", "Z0", ",", "II0", 
         ",", "S", ",", "Si", ",", "SiN", ",", "Mi", ",", "d"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "This", " ", "function", " ", "assumes", " ", "that", " ", "the", 
          " ", 
          StyleBox["channel", "Text"], 
          StyleBox[" ", "Text"], 
          StyleBox["is", "Text"], 
          StyleBox[" ", "Text"], 
          StyleBox["symmetric", "Text"], " ", "and", " ", "calculates", " ", 
          "the", " ", "S"}], "-", 
         RowBox[{
         "matrices", " ", "for", " ", "the", " ", "intervals", " ", "for", 
          " ", "positive", " ", "y"}], "-", 
         RowBox[{"s", " ", 
          RowBox[{"only", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Since", " ", "L"}], "-", 
          RowBox[{"R", " ", "symmetry", " ", "is", " ", "assumed"}]}], ",", 
         " ", 
         RowBox[{
          RowBox[{"only", " ", "E0"}], "=", 
          RowBox[{"0", " ", 
           RowBox[{"possible", "!"}]}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "params", " ", "is", " ", "a", " ", "function", " ", "that", " ", 
         "can", " ", "be", " ", "evaluated", " ", "at", " ", "each", " ", 
         "point", " ", "to", " ", "get", " ", "the", " ", "parameters", " ", 
         "of", " ", "the", " ", "channel", " ", "at", " ", "that", " ", 
         "point"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "we", " ", "assume", " ", "that", " ", "the", " ", "left", " ", "and",
          " ", "right", " ", "leads", " ", "have", " ", "the", " ", "same", 
         " ", "parameters", " ", "as", " ", "of", " ", "the", " ", "leftmost",
          " ", "and", " ", "rightmost", " ", "imaginary", " ", "intervals"}], 
        " ", "*)"}], 
       RowBox[{"(*", " ", 
        RowBox[{
        "this", " ", "means", " ", "that", " ", "all", " ", "of", " ", "the", 
         " ", "channels", " ", "here", " ", "have", " ", "to", " ", "be", " ",
          "in", " ", "the", " ", "normal", " ", "phase", " ", "and", " ", 
         "below", " ", "the", " ", "chemical", " ", "potential"}], " ", 
        "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        StyleBox[
         RowBox[{
         "Checking", " ", "mirror", " ", "symmetry", " ", "of", " ", "the", 
          " ", "channel"}], "Text"], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        StyleBox[
         RowBox[{
         "Checking", " ", "if", " ", "yValues", " ", "is", " ", 
          "monotonically", " ", "increasing"}], "Code"], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Sort", "[", "yValues", "]"}], "\[Equal]", "yValues"}], 
            " ", ")"}]}], ",", " ", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"Style", "[", 
             RowBox[{
             "\"\<y values are not monotonically increasing\>\"", ",", 
              "Red"}], "]"}], "]"}], ";", " ", 
           RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         StyleBox[
          RowBox[{
          "Selecting", " ", "only", " ", "the", " ", "positive", " ", "part", 
           " ", "of", " ", "yValues"}], "Code"], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"iy", "=", 
         RowBox[{"First", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"yValues", ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}], "]"}], 
          "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "First", " ", "positive", " ", "element", " ", "in", " ", 
          "yValues"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"yValuesPos", "=", 
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{"0.0", ",", 
            RowBox[{"yValues", "\[LeftDoubleBracket]", 
             RowBox[{"iy", ";;", 
              RowBox[{"Length", "@", "yValues"}]}], 
             "\[RightDoubleBracket]"}]}], "}"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         StyleBox[
          RowBox[{
           RowBox[{
           "Testing", " ", "if", " ", "the", " ", "channel", " ", "is", " ", 
            "symmetric", " ", 
            RowBox[{"w", ".", "r", ".", "t", ".", " ", "y"}]}], "=", "0.0"}], 
          "Code"], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"params", "[", "yValuesPos", "]"}], "\[NotEqual]", 
           RowBox[{"params", "[", 
            RowBox[{"-", "yValuesPos"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<Channel not symmetric w.r.t y=0\>\"", ",", "Red"}], 
             "]"}], "]"}], ";", " ", 
           RowBox[{"Return", "[", "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Parameters", " ", "of", " ", "the", " ", "intervals", " ", "of", 
          " ", "the", " ", "system"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ly", " ", "=", " ", 
         RowBox[{"Length", "@", "yValuesPos"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"yS", "=", 
         FractionBox[
          RowBox[{
           RowBox[{"yValuesPos", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", 
             RowBox[{"(", 
              RowBox[{"ly", "-", "1"}], ")"}]}], "\[RightDoubleBracket]"}], 
           "+", 
           RowBox[{"yValuesPos", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;", "ly"}], "\[RightDoubleBracket]"}]}], "2.0"]}], 
        ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"middle", " ", "of", " ", "the", " ", "intervals"}], ",", 
          " ", 
          RowBox[{
          "where", " ", "the", " ", "system", " ", "parameters", " ", "are", 
           " ", "evaluated"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"paramsS", "=", 
         RowBox[{"params", "/@", "yS"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[CapitalDelta]yS", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"yValuesPos", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;", "ly"}], "\[RightDoubleBracket]"}], "-", 
           RowBox[{"yValuesPos", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", 
             RowBox[{"(", 
              RowBox[{"ly", "-", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
          ")"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"length", " ", "of", " ", "each", " ", "interval"}], " ", 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"II", " ", "=", " ", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"2", "nChTr"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ZZ", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "nChTr"}], ",", 
             RowBox[{"2", "nChTr"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {"ZZ", "II"},
             {"II", "ZZ"}
            }], ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"I0", "=", 
         RowBox[{"IdentityMatrix", "[", "nChTr", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Z0", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"nChTr", ",", "nChTr"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"II0", "=", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {"Z0", "Z0", "Z0", "I0"},
             {"Z0", "Z0", 
              RowBox[{"-", "I0"}], "Z0"},
             {"Z0", "I0", "Z0", "Z0"},
             {
              RowBox[{"-", "I0"}], "Z0", "Z0", "Z0"}
            }], ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"paramsL", " ", "and", " ", 
          RowBox[{"paramsR", ":", " ", 
           RowBox[{
           "the", " ", "imaginary", " ", "leads", " ", "to", " ", "the", " ", 
            "left", " ", "and", " ", "to", " ", "the", " ", "right", " ", 
            "from", " ", "the", " ", "system"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"paramsL", "=", 
         RowBox[{"params", "[", 
          RowBox[{
          "yValuesPos", "\[LeftDoubleBracket]", "1", 
           "\[RightDoubleBracket]"}], "]"}]}], ";", " ", 
        RowBox[{
         RowBox[{"paramsL", "[", "\"\<\[CapitalDelta]\>\"", "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", "0.0", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"paramsL", "[", "\"\<Vg\>\"", "]"}], "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
            RowBox[{"paramsL", "[", "\"\<\[Omega]x\>\"", "]"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nzmaxTr", "+", "1"}], ")"}], 
            RowBox[{"paramsL", "[", "\"\<\[Omega]z\>\"", "]"}]}], "-", 
           RowBox[{"paramsL", "[", "\"\<\[Mu]\>\"", "]"}], "+", 
           RowBox[{"0.1", " ", 
            RowBox[{"Abs", "@", 
             RowBox[{"paramsL", "[", "\"\<\[Mu]\>\"", "]"}]}]}]}], ")"}]}], 
        ";", 
        RowBox[{"(*", " ", 
         RowBox[{
         "We", " ", "need", " ", "to", " ", "make", " ", "sure", " ", "that", 
          " ", "all", " ", "levels", " ", "in", " ", "the", " ", "imaginary", 
          " ", "lead", " ", "are", " ", "below", " ", "the", " ", "local", 
          " ", "Fermi", " ", "energy"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<", 
           RowBox[{"ly", "-", "1"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"paramsR", "=", "paramsL"}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "chemical", " ", "potential", " ", "has", " ", "to", " ", "be", 
              " ", "the", " ", "same", " ", "for", " ", "the", " ", 
              "imaginary", " ", "leads"}], ",", " ", 
             RowBox[{
              RowBox[{"and", " ", "\[CapitalDelta]"}], "\[Equal]", "0."}]}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"paramsR", "[", "\"\<\[Omega]x\>\"", "]"}], "=", 
            RowBox[{
             RowBox[{"paramsS", "\[LeftDoubleBracket]", 
              RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "[", 
             "\"\<\[Omega]x\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"paramsR", "[", "\"\<\[Omega]z\>\"", "]"}], "=", 
            RowBox[{
             RowBox[{"paramsS", "\[LeftDoubleBracket]", 
              RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "[", 
             "\"\<\[Omega]z\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "With", " ", "this", " ", "choice", " ", "of", " ", "the", " ", 
              "trapping", " ", "frequencies", " ", "of", " ", "the", " ", 
              "imaginary", " ", "leads"}], ",", " ", 
             RowBox[{
             "one", " ", "of", " ", "the", " ", "W", " ", "matrices", " ", 
              "is", " ", "unity", " ", "at", " ", 
              RowBox[{"least", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{
            RowBox[{"paramsR", "[", "\"\<Vg\>\"", "]"}], "=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
               RowBox[{"paramsR", "[", "\"\<\[Omega]x\>\"", "]"}]}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"nzmaxTr", "+", "1"}], ")"}], 
               RowBox[{"paramsR", "[", "\"\<\[Omega]z\>\"", "]"}]}], "-", 
              RowBox[{"0.9", 
               RowBox[{"paramsR", "[", "\"\<\[Mu]\>\"", "]"}]}]}], ")"}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "We", " ", "need", " ", "to", " ", "make", " ", "sure", " ", 
             "that", " ", "all", " ", "levels", " ", "in", " ", "the", " ", 
             "imaginary", " ", "lead", " ", "are", " ", "below", " ", "the", 
             " ", "local", " ", "Fermi", " ", "energy"}], " ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Mi", "=", 
            RowBox[{"M", "[", 
             RowBox[{"paramsL", ",", 
              RowBox[{
              "paramsS", "\[LeftDoubleBracket]", "i", 
               "\[RightDoubleBracket]"}], ",", "paramsR", ",", 
              RowBox[{
              "\[CapitalDelta]yS", "\[LeftDoubleBracket]", "i", 
               "\[RightDoubleBracket]"}], ",", "0.0"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Si", "=", 
            RowBox[{"M2S", "@", "Mi"}]}], ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{"S", "-", 
             RowBox[{
             "matrix", " ", "of", " ", "the", " ", "interval", " ", 
              "considered", " ", "here"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"SiN", "=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"II0", "\[ConjugateTranspose]"}], ".", 
              RowBox[{"Si", "\[ConjugateTranspose]"}], ".", "II0"}], ")"}]}], 
           ";", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Corresponding", " ", "interval", " ", "on", " ", "the", " ", 
             "negative", " ", "y", " ", "side", " ", "of", " ", "the", " ", 
             "channel"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"S", "=", 
            RowBox[{"SCat", "[", 
             RowBox[{"S", ",", "Si"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"S", "=", 
            RowBox[{"SCat", "[", 
             RowBox[{"SiN", ",", "S"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"d", "=", 
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Si", "\[ConjugateTranspose]"}], ".", "Si"}], "-", 
              RowBox[{"IdentityMatrix", "[", 
               RowBox[{"4", "nChTr"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"d", ">", 
              SuperscriptBox["10", 
               RowBox[{"-", "6"}]]}], ",", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{"\"\<S-matrix non-unitary!\>\"", ",", "Red"}], "]"}], 
               "]"}], ";", " ", 
              RowBox[{"Print", "[", 
               RowBox[{"{", 
                RowBox[{"d", ",", 
                 RowBox[{
                  RowBox[{
                  "yValuesPos", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "/", "\[Lambda]F"}]}], "}"}], 
               "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"paramsL", "=", "paramsR"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Imaginary", " ", "leads", " ", "at", " ", "the", " ", "end", " ", 
          "of", " ", "the", " ", "channel", " ", "are", " ", "supposed", " ", 
          "to", " ", "be", " ", "identical", " ", "to", " ", "the", " ", 
          "real", " ", "leads"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"paramsR", "=", 
         RowBox[{"params", "[", 
          RowBox[{"Last", "@", "yValuesPos"}], "]"}]}], ";", " ", 
        RowBox[{
         RowBox[{"paramsR", "[", "\"\<\[CapitalDelta]\>\"", "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", "0.0", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Mi", "=", 
         RowBox[{"M", "[", 
          RowBox[{"paramsL", ",", 
           RowBox[{"Last", "@", "paramsS"}], ",", "paramsR", ",", 
           RowBox[{"Last", "@", "\[CapitalDelta]yS"}], ",", "0.0"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Si", "=", 
         RowBox[{"M2S", "@", "Mi"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"SiN", "=", 
         RowBox[{
          RowBox[{"II0", "\[ConjugateTranspose]"}], ".", 
          RowBox[{"Si", "\[ConjugateTranspose]"}], ".", "II0"}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Corresponding", " ", "interval", " ", "on", " ", "the", " ", 
          "negative", " ", "y", " ", "side", " ", "of", " ", "the", " ", 
          "channel"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"SCat", "[", 
          RowBox[{"S", ",", "Si"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"SCat", "[", 
          RowBox[{"SiN", ",", "S"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Stotal", "[", 
      RowBox[{"yValues_", ",", "params_", ",", "E0_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ly", ",", "yS", ",", "\[CapitalDelta]yS", ",", "paramsS", ",", 
         "paramsL", ",", "paramsR", ",", "i", ",", "II", ",", "ZZ", ",", "S", 
         ",", "Si", ",", "Mi", ",", "d", ",", "\[Epsilon]F", ",", "kE0", ",", 
         "SLead", ",", "keL", ",", "keR", ",", "khL", ",", "khR", ",", "kIeL",
          ",", "kIeR", ",", "kIhL", ",", "kIhR", ",", "paramsLeadL", ",", 
         "paramsLeadR", ",", "paramsIL", ",", "paramsIR", ",", "zz", ",", 
         "rLe", ",", "tLe", ",", "rpLe", ",", "tpLe", ",", "rLh", ",", "tLh", 
         ",", "rpLh", ",", "tpLh", ",", "rRe", ",", "tRe", ",", "rpRe", ",", 
         "tpRe", ",", "rRh", ",", "tRh", ",", "rpRh", ",", "tpRh", ",", 
         "SLeadL", ",", "SLeadR"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "params", " ", "is", " ", "a", " ", "function", " ", "that", " ", 
         "can", " ", "be", " ", "evaluated", " ", "at", " ", "each", " ", 
         "point", " ", "to", " ", "get", " ", "the", " ", "parameters", " ", 
         "of", " ", "the", " ", "channel", " ", "at", " ", "that", " ", 
         "point"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "we", " ", "assume", " ", "that", " ", "the", " ", "left", " ", "and",
          " ", "right", " ", "leads", " ", "have", " ", "the", " ", "same", 
         " ", "parameters", " ", "as", " ", "of", " ", "the", " ", "leftmost",
          " ", "and", " ", "rightmost", " ", "imaginary", " ", "intervals"}], 
        " ", "*)"}], 
       RowBox[{"(*", " ", 
        RowBox[{
        "this", " ", "means", " ", "that", " ", "all", " ", "of", " ", "the", 
         " ", "channels", " ", "here", " ", "have", " ", "to", " ", "be", " ",
          "in", " ", "the", " ", "normal", " ", "phase", " ", "and", " ", 
         "below", " ", "the", " ", "chemical", " ", "potential"}], " ", 
        "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Parameters", " ", "of", " ", "the", " ", "intervals", " ", "of", " ",
          "the", " ", "system"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ly", " ", "=", " ", 
         RowBox[{"Length", "@", "yValues"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"yS", "=", 
         FractionBox[
          RowBox[{
           RowBox[{"yValues", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", 
             RowBox[{"(", 
              RowBox[{"ly", "-", "1"}], ")"}]}], "\[RightDoubleBracket]"}], 
           "+", 
           RowBox[{"yValues", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;", "ly"}], "\[RightDoubleBracket]"}]}], "2.0"]}], 
        ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"middle", " ", "of", " ", "the", " ", "intervals"}], ",", 
          " ", 
          RowBox[{
          "where", " ", "the", " ", "system", " ", "parameters", " ", "are", 
           " ", "evaluated"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"paramsS", "=", 
         RowBox[{"params", "/@", "yS"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[CapitalDelta]yS", "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"yValues", "\[LeftDoubleBracket]", 
            RowBox[{"2", ";;", "ly"}], "\[RightDoubleBracket]"}], "-", 
           RowBox[{"yValues", "\[LeftDoubleBracket]", 
            RowBox[{"1", ";;", 
             RowBox[{"(", 
              RowBox[{"ly", "-", "1"}], ")"}]}], "\[RightDoubleBracket]"}]}], 
          ")"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"length", " ", "of", " ", "each", " ", "interval"}], " ", 
         "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"II", " ", "=", " ", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"2", "nChTr"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ZZ", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"2", "nChTr"}], ",", 
             RowBox[{"2", "nChTr"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {"ZZ", "II"},
             {"II", "ZZ"}
            }], ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "We", " ", "assume", " ", "that", " ", "the", " ", "system", " ", 
           "has", " ", "a", " ", "very", " ", "long", " ", "lead", " ", 
           "attached", " ", "to", " ", "it"}], ",", " ", 
          RowBox[{
          "whose", " ", "parameters", " ", "are", " ", "those", " ", "of", 
           " ", 
           RowBox[{"params", "[", 
            RowBox[{
            "yValues", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
             "]"}], " ", "and", " ", 
           RowBox[{"params", "[", 
            RowBox[{"Last", "@", "yValues"}], "]"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "At", " ", "the", " ", "end", " ", "of", " ", "this", " ", "long", 
           " ", "lead"}], ",", " ", 
          RowBox[{
          "the", " ", "gate", " ", "potential", " ", "adiabatically", " ", 
           "grows", " ", "to", " ", "a", " ", "very", " ", "large", " ", 
           RowBox[{"value", ".", " ", "Since"}], " ", "we", " ", "know", " ", 
           "that", " ", "this", " ", "part", " ", "of", " ", "the", " ", 
           "waveguide"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"is", " ", "transmitting", " ", "for", " ", "non"}], "-", 
           RowBox[{"evanescent", " ", "channels"}]}], ",", " ", 
          RowBox[{
          "and", " ", "reflecting", " ", "for", " ", "evanescent", " ", 
           "ones"}], ",", " ", 
          RowBox[{
          "we", " ", "just", " ", "determine", " ", "the", " ", "S", " ", 
           "matrix", " ", "of", " ", "this", " ", "part", " ", 
           "analytically"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"paramsLeadL", " ", "and", " ", 
          RowBox[{"paramsLeadR", ":", " ", 
           RowBox[{
           "parameters", " ", "of", " ", "the", " ", "long", " ", "leads", 
            " ", "to", " ", "the", " ", "left", " ", "and", " ", "to", " ", 
            "the", " ", "right", " ", "of", " ", "the", " ", "system"}]}]}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"paramsIL", " ", "and", " ", 
           RowBox[{"paramsIR", ":", " ", 
            RowBox[{"the", " ", "imaginary"}]}]}], ",", " ", 
          RowBox[{
          "zero", " ", "width", " ", "leads", " ", "that", " ", "we", " ", 
           "insert", " ", "between", " ", "the", " ", 
           RowBox[{"system", "'"}], "s", " ", "ends", " ", "and", " ", "the", 
           " ", "long", " ", "leads"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"SLeadL", " ", "and", " ", 
           RowBox[{"SLeadR", ":", " ", 
            RowBox[{
            "the", " ", "S", " ", "matrices", " ", "of", " ", "the", " ", 
             "long", " ", "external", " ", "leads"}]}]}], ",", " ", 
          RowBox[{
          "ending", " ", "at", " ", "the", " ", "imaginary", " ", "leads", 
           " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"paramsIL", " ", "and", " ", "paramsIR"}], ")"}], 
            "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"paramsLeadL", "=", 
         RowBox[{"params", "[", 
          RowBox[{
          "yValues", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], ";", " ", 
        RowBox[{
         RowBox[{"paramsLeadL", "[", "\"\<\[CapitalDelta]\>\"", "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", "0.0", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"paramsLeadR", "=", 
         RowBox[{"params", "[", 
          RowBox[{"Last", "@", "yValues"}], "]"}]}], ";", " ", 
        RowBox[{
         RowBox[{"paramsLeadR", "[", "\"\<\[CapitalDelta]\>\"", "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", "0.0", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"paramsIL", "=", 
         RowBox[{"params", "[", 
          RowBox[{
          "yValues", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], ";", " ", 
        RowBox[{
         RowBox[{"paramsIL", "[", "\"\<\[CapitalDelta]\>\"", "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", "0.0", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"paramsIL", "[", "\"\<Vg\>\"", "]"}], "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
            RowBox[{"paramsIL", "[", "\"\<\[Omega]x\>\"", "]"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nzmaxTr", "+", "1"}], ")"}], 
            RowBox[{"paramsIL", "[", "\"\<\[Omega]z\>\"", "]"}]}], "-", 
           RowBox[{"0.9", 
            RowBox[{"paramsIL", "[", "\"\<\[Mu]\>\"", "]"}]}], "+", 
           RowBox[{"Abs", "@", "E0"}], " ", "+", " ", 
           RowBox[{
            RowBox[{"RandomReal", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1"}], "}"}], "]"}], 
            RowBox[{"Abs", "[", 
             RowBox[{"paramsIL", "[", "\"\<\[Mu]\>\"", "]"}], "]"}]}]}], 
          ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"paramsIR", "=", 
         RowBox[{"params", "[", 
          RowBox[{
          "yValues", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          "]"}]}], ";", " ", 
        RowBox[{
         RowBox[{"paramsIR", "[", "\"\<\[CapitalDelta]\>\"", "]"}], "=", 
         RowBox[{"{", 
          RowBox[{"{", "0.0", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"paramsIR", "[", "\"\<Vg\>\"", "]"}], "=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
            RowBox[{"paramsIR", "[", "\"\<\[Omega]x\>\"", "]"}]}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"nzmaxTr", "+", "1"}], ")"}], 
            RowBox[{"paramsIR", "[", "\"\<\[Omega]z\>\"", "]"}]}], "-", 
           RowBox[{"0.9", 
            RowBox[{"paramsIR", "[", "\"\<\[Mu]\>\"", "]"}]}], "+", 
           RowBox[{"Abs", "@", "E0"}], "+", " ", 
           RowBox[{
            RowBox[{"RandomReal", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", "1"}], "}"}], "]"}], 
            RowBox[{"Abs", "[", 
             RowBox[{"paramsIL", "[", "\"\<\[Mu]\>\"", "]"}], "]"}]}]}], 
          ")"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         StyleBox[
          RowBox[{
          "Create", " ", "S", " ", "matrix", " ", "of", " ", "the", " ", 
           "system"}], "Code"], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"paramsL", "=", "paramsIL"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "<", 
           RowBox[{"ly", "-", "1"}]}], ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"paramsR", "=", "paramsL"}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"paramsR", "[", "\"\<\[Omega]x\>\"", "]"}], "=", 
            RowBox[{
             RowBox[{"paramsS", "\[LeftDoubleBracket]", 
              RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "[", 
             "\"\<\[Omega]x\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"paramsR", "[", "\"\<\[Omega]z\>\"", "]"}], "=", 
            RowBox[{
             RowBox[{"paramsS", "\[LeftDoubleBracket]", 
              RowBox[{"i", "+", "1"}], "\[RightDoubleBracket]"}], "[", 
             "\"\<\[Omega]z\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "With", " ", "this", " ", "choice", " ", "of", " ", "the", " ", 
              "trapping", " ", "frequencies", " ", "in", " ", "the", " ", 
              "imaginary", " ", "leads"}], ",", " ", 
             RowBox[{
             "at", " ", "least", " ", "one", " ", "of", " ", "the", " ", "W", 
              " ", "matrices", " ", "is", " ", "the", " ", 
              RowBox[{"identity", "."}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"paramsR", "[", "\"\<Vg\>\"", "]"}], "=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"nxmaxTr", "+", "1"}], ")"}], 
               RowBox[{"paramsR", "[", "\"\<\[Omega]x\>\"", "]"}]}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"nzmaxTr", "+", "1"}], ")"}], 
               RowBox[{"paramsR", "[", "\"\<\[Omega]z\>\"", "]"}]}], "-", 
              RowBox[{"0.9", 
               RowBox[{"paramsR", "[", "\"\<\[Mu]\>\"", "]"}]}], "+", 
              RowBox[{"Abs", "@", "E0"}], "+", " ", 
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], "]"}], 
               RowBox[{"Abs", "[", 
                RowBox[{"paramsIL", "[", "\"\<\[Mu]\>\"", "]"}], "]"}]}]}], 
             ")"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "We", " ", "need", " ", "to", " ", "make", " ", "sure", " ", 
             "that", " ", "all", " ", "levels", " ", "in", " ", "the", " ", 
             "imaginary", " ", "lead", " ", "are", " ", "below", " ", "the", 
             " ", "local", " ", "Fermi", " ", "energy"}], " ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Mi", "=", 
            RowBox[{"M", "[", 
             RowBox[{"paramsL", ",", 
              RowBox[{
              "paramsS", "\[LeftDoubleBracket]", "i", 
               "\[RightDoubleBracket]"}], ",", "paramsR", ",", 
              RowBox[{
              "\[CapitalDelta]yS", "\[LeftDoubleBracket]", "i", 
               "\[RightDoubleBracket]"}], ",", "E0"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Si", "=", 
            RowBox[{"M2S", "@", "Mi"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"S", "=", 
            RowBox[{"SCat", "[", 
             RowBox[{"S", ",", "Si"}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"d", "=", 
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Si", "\[ConjugateTranspose]"}], ".", "Si"}], "-", 
              RowBox[{"IdentityMatrix", "[", 
               RowBox[{"4", "nChTr"}], "]"}]}], "]"}]}], ";", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"d", ">", 
              SuperscriptBox["10", 
               RowBox[{"-", "6"}]]}], ",", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"Style", "[", 
                RowBox[{"\"\<S-matrix non-unitary!\>\"", ",", "Red"}], "]"}], 
               "]"}], ";", " ", 
              RowBox[{"Print", "[", 
               RowBox[{"{", 
                RowBox[{"d", ",", 
                 RowBox[{
                  RowBox[{
                  "yValues", "\[LeftDoubleBracket]", "i", 
                   "\[RightDoubleBracket]"}], "/", "\[Lambda]F"}]}], "}"}], 
               "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"paramsL", "=", "paramsR"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"paramsR", "=", "paramsIR"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Mi", "=", 
         RowBox[{"M", "[", 
          RowBox[{"paramsL", ",", 
           RowBox[{"Last", "@", "paramsS"}], ",", "paramsR", ",", 
           RowBox[{"Last", "@", "\[CapitalDelta]yS"}], ",", "E0"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Si", "=", 
         RowBox[{"M2S", "@", "Mi"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"SCat", "[", 
          RowBox[{"S", ",", "Si"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         StyleBox[
          RowBox[{
          "Create", " ", "S", " ", "matrix", " ", "of", " ", "the", " ", 
           "leads"}], "Code"], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Epsilon]F", "[", "paramsA_", "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"paramsA", "[", "\"\<\[Mu]\>\"", "]"}], "+", 
           RowBox[{"paramsA", "[", "\"\<Vg\>\"", "]"}], "-", 
           FractionBox[
            RowBox[{
             RowBox[{"paramsA", "[", "\"\<\[Omega]x\>\"", "]"}], "+", 
             RowBox[{"paramsA", "[", "\"\<\[Omega]z\>\"", "]"}]}], "2.0"], 
           "-", 
           RowBox[{"indTr", ".", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"paramsA", "[", "\"\<\[Omega]x\>\"", "]"}], ",", 
              RowBox[{"paramsA", "[", "\"\<\[Omega]z\>\"", "]"}]}], "}"}]}]}],
           ")"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"kE0", "[", 
          RowBox[{"paramsA_", ",", "Energy_"}], "]"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           SqrtBox[
            RowBox[{" ", 
             RowBox[{"2", " ", "mass", " ", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"\[Epsilon]F", "[", "paramsA", "]"}], "+", "Energy"}],
                ")"}]}]}]], "/", "hbar"}], ")"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"SLead", "[", 
          RowBox[{"kL_", ",", "kI_"}], "]"}], ":=", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "r", ",", "t", ",", "rp", ",", "tp"}], "}"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"S", " ", "matrix", " ", "of", " ", "a", " ", "semi"}], 
             "-", 
             RowBox[{
             "infinite", " ", "lead", " ", "with", " ", "a", " ", "potential",
               " ", 
              RowBox[{"jump", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "kL", " ", "and", " ", "kI", " ", "denote", " ", "the", " ", 
              "wave", " ", "vector", " ", "of", " ", "the", " ", "particle", 
              " ", "on", " ", "the", " ", "left", " ", "and", " ", "on", " ", 
              "the", " ", "right"}], ",", " ", 
             RowBox[{"respectively", "."}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"At", " ", "y"}], "\[Rule]", 
              RowBox[{"-", "\[Infinity]"}]}], ",", " ", 
             RowBox[{
             "the", " ", "gate", " ", "potential", " ", "grows", " ", 
              "adiabatically", " ", "until", " ", "it", " ", "pulls", " ", 
              "down", " ", "all", " ", "channels", " ", "below", " ", "the", 
              " ", "chemical", " ", "potential"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"r", "=", 
             RowBox[{"DiagonalMatrix", "@", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    "kL", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "]"}], "\[Equal]", "0"}], " ", 
                   "&&", " ", 
                   RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    "kI", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "]"}], "\[Equal]", "0"}]}], 
                  ",", 
                  FractionBox[
                   RowBox[{
                    RowBox[{
                    "kL", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "-", 
                    RowBox[{
                    "kI", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}]}], 
                   RowBox[{
                    RowBox[{
                    "kL", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    "kI", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}]}]], ",", "1"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", "1", ",", "nChTr"}], "}"}]}], "]"}]}]}], 
            ";", " ", 
            RowBox[{"rp", "=", 
             RowBox[{"-", "r"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"t", "=", 
             RowBox[{"DiagonalMatrix", "@", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    "kL", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "]"}], "\[Equal]", "0"}], " ", 
                   "&&", " ", 
                   RowBox[{
                    RowBox[{"Im", "[", 
                    RowBox[{
                    "kI", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "]"}], "\[Equal]", "0"}]}], 
                  ",", 
                  FractionBox[
                   RowBox[{"2", " ", 
                    SqrtBox[
                    RowBox[{
                    RowBox[{
                    "kL", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], 
                    RowBox[{
                    "kI", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}]}]]}], 
                   RowBox[{
                    RowBox[{
                    "kL", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}], "+", 
                    RowBox[{
                    "kI", "\[LeftDoubleBracket]", "i1", 
                    "\[RightDoubleBracket]"}]}]], ",", "0"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", "1", ",", "nChTr"}], "}"}]}], "]"}]}]}], 
            ";", " ", 
            RowBox[{"tp", "=", "t"}], ";", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"r", ",", "t", ",", "rp", ",", "tp"}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"keL", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsLeadL", ",", "E0"}], "]"}]}], ";", " ", 
        RowBox[{"khL", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsLeadL", ",", 
           RowBox[{"-", "E0"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"keR", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsLeadR", ",", "E0"}], "]"}]}], ";", " ", 
        RowBox[{"khR", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsLeadR", ",", 
           RowBox[{"-", "E0"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"kIeL", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsIL", ",", "E0"}], "]"}]}], ";", " ", 
        RowBox[{"kIhL", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsIL", ",", 
           RowBox[{"-", "E0"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"kIeR", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsIR", ",", "E0"}], "]"}]}], ";", " ", 
        RowBox[{"kIhR", "=", 
         RowBox[{"kE0", "[", 
          RowBox[{"paramsIR", ",", 
           RowBox[{"-", "E0"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"rLe", ",", "tLe", ",", "rpLe", ",", "tpLe"}], "}"}], "=", 
         RowBox[{"SLead", "[", 
          RowBox[{"keL", ",", "kIeL"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"rLh", ",", "tLh", ",", "rpLh", ",", "tpLh"}], "}"}], "=", 
         RowBox[{"SLead", "[", 
          RowBox[{"khL", ",", "kIhL"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"rRe", ",", "tRe", ",", "rpRe", ",", "tpRe"}], "}"}], "=", 
         RowBox[{"SLead", "[", 
          RowBox[{"kIeR", ",", "keR"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"rRh", ",", "tRh", ",", "rpRh", ",", "tpRh"}], "}"}], "=", 
         RowBox[{"SLead", "[", 
          RowBox[{"kIhR", ",", "khR"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"zz", " ", "=", " ", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"nChTr", ",", "nChTr"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"SLeadL", "=", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {"rLe", "zz", "tpLe", "zz"},
             {"zz", "rLh", "zz", "tpLh"},
             {"tLe", "zz", "rpLe", "zz"},
             {"zz", "tLh", "zz", "rpLh"}
            }], ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"SLeadR", "=", 
         RowBox[{"ArrayFlatten", "[", 
          RowBox[{"(", GridBox[{
             {"rRe", "zz", "tpRe", "zz"},
             {"zz", "rRh", "zz", "tpRh"},
             {"tRe", "zz", "rpRe", "zz"},
             {"zz", "tRh", "zz", "rpRh"}
            }], ")"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         StyleBox[
          RowBox[{"Concatenate", " ", "S", " ", "with", " ", "the", " ", 
           RowBox[{"leads", "'"}], " ", "S", " ", "matrix"}], "Code"], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"SCat", "[", 
          RowBox[{"SLeadL", ",", "S"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"S", "=", 
         RowBox[{"SCat", "[", 
          RowBox[{"S", ",", "SLeadR"}], "]"}]}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Checked", " ", 
      RowBox[{"numerically", ":", " ", 
       RowBox[{
       "it", " ", "is", " ", "compatible", " ", "with", " ", "the", " ", 
        "earlier", " ", "versions", " ", "of", " ", "Stotal"}]}]}], ",", " ", 
     
     RowBox[{
     "assuming", " ", "that", " ", "we", " ", "consider", " ", "the", " ", 
      "full", " ", "length", " ", "of", " ", "the", " ", "channel"}], ",", 
     " ", "\[IndentingNewLine]", 
     RowBox[{
     "where", " ", "the", " ", "Gaussian", " ", "beams", " ", "have", " ", 
      "already", " ", 
      RowBox[{"decayed", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Conductance", "[", "S_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "r", ",", "t", ",", "rp", ",", "tp", ",", "ree", ",", "rhe", ",", "G",
          ",", "GS"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"r", ",", "t", ",", "rp", ",", "tp"}], "}"}], "=", 
         RowBox[{"rt", "[", "S", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ree", "=", 
         RowBox[{"r", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", "nChTr"}], ",", 
           RowBox[{"1", ";;", "nChTr"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rhe", "=", 
         RowBox[{"r", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
            RowBox[{"nChTr", "+", "1"}], ";;", 
            RowBox[{"2", " ", "nChTr"}]}], ",", 
           RowBox[{"1", ";;", "nChTr"}]}], "\[RightDoubleBracket]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"G", "=", 
         RowBox[{"Re", "@", 
          RowBox[{"Tr", "[", 
           RowBox[{
            RowBox[{"IdentityMatrix", "[", "nChTr", "]"}], "-", 
            RowBox[{
             RowBox[{"ree", "\[ConjugateTranspose]"}], ".", "ree"}], " ", "+",
             " ", 
            RowBox[{
             RowBox[{"rhe", "\[ConjugateTranspose]"}], ".", "rhe"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"GS", "=", 
         RowBox[{"Re", "@", 
          RowBox[{"Tr", "[", 
           RowBox[{
            RowBox[{"IdentityMatrix", "[", "nChTr", "]"}], "-", 
            RowBox[{
             RowBox[{"ree", "\[ConjugateTranspose]"}], ".", "ree"}], " ", "-",
             " ", 
            RowBox[{
             RowBox[{"rhe", "\[ConjugateTranspose]"}], ".", "rhe"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"G", ",", "GS"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Finite", " ", "temperature", " ", "conductance"}], 
     "Subsubsection"], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"f", "[", "x_", "]"}], ":=", 
     FractionBox["1", 
      RowBox[{
       RowBox[{"Exp", "[", "x", "]"}], "+", "1"}]]}], ";"}], " ", 
   RowBox[{"(*", " ", 
    RowBox[{"Fermi", " ", "function"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Df", "[", "x_", "]"}], ":=", 
     RowBox[{"-", 
      FractionBox[
       SuperscriptBox["\[ExponentialE]", "x"], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"1", "+", 
          SuperscriptBox["\[ExponentialE]", "x"]}], ")"}], "2"]]}]}], ";"}], 
   " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Derivative", " ", "of", " ", "the", " ", "Fermi", " ", "function"}], " ",
     "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ConductanceT", "[", "params_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "T", ",", "E0Max", ",", "yValues", ",", "E0Values", ",", "tS", ",", 
         "tCond", ",", "GFn", ",", "GSFn", ",", "pG", ",", "pGS", ",", "p", 
         ",", "G", ",", "GS"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"T", "=", 
         RowBox[{
          RowBox[{"params", "[", "0", "]"}], "[", "\"\<T\>\"", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"E0Max", "=", 
         RowBox[{"5", "T"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Upper", " ", "bound", " ", "of", " ", 
           RowBox[{"integration", ".", " ", "Lower"}], " ", "bound"}], " ", 
          "\[Equal]", " ", 
          RowBox[{"-", "E0Max"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"yValues", "=", 
         RowBox[{"yGrid", "[", 
          RowBox[{
          "yminTr", ",", "ymaxTr", ",", "nxmaxTr", ",", "nxmaxTr", ",", 
           "nzmaxTr", ",", "nzmaxTr"}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Spatial", " ", "grid"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"E0Values", "=", 
         RowBox[{"(", 
          RowBox[{"E0Max", "  ", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Sign", "[", "i", "]"}], " ", 
              SuperscriptBox[
               RowBox[{"Abs", "[", "i", "]"}], "1.5"]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"-", "1"}], ",", "1", ",", "0.04"}], "}"}]}], "]"}]}], 
          ")"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Energies", " ", "at", " ", "which", " ", "we", " ", "will", " ", 
          "evaluate", " ", "the", " ", "conductance"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"tS", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "E0Values", "\[LeftDoubleBracket]", "i", 
              "\[RightDoubleBracket]"}], ",", 
             RowBox[{"Stotal", "[", 
              RowBox[{"yValues", ",", "params", ",", 
               RowBox[{
               "E0Values", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "@", "E0Values"}]}], "}"}]}], "]"}]}], ";", 
        " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"E0", ",", " ", "G", ",", " ", "GS"}], "}"}], " ", 
          "array"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"tCond", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"tS", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], ",", " ", 
              RowBox[{"Conductance", "[", 
               RowBox[{"tS", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}], "]"}]}], 
             "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "@", "E0Values"}]}], "}"}]}], "]"}]}], ";", 
        " ", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"E0", ",", " ", "G", ",", " ", "GS"}], "}"}], " ", 
          "array"}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"GFn", "=", 
         RowBox[{"Interpolation", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"tCond", "\[LeftDoubleBracket]", 
                 RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], "/", 
                "T"}], ",", 
               RowBox[{"tCond", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}]}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "@", "E0Values"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"GSFn", "=", 
         RowBox[{"Interpolation", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"tCond", "\[LeftDoubleBracket]", 
                 RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], "/", 
                "T"}], ",", 
               RowBox[{"tCond", "\[LeftDoubleBracket]", 
                RowBox[{"i", ",", "3"}], "\[RightDoubleBracket]"}]}], "}"}], 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "@", "E0Values"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "Notice", " ", "that", " ", "GFn", " ", "and", " ", "GSFn", " ", 
          "are", " ", "the", " ", "functions", " ", "of", " ", 
          RowBox[{"E0", "/", 
           RowBox[{"T", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"pG", "=", 
            RowBox[{"Show", "[", 
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], "/", 
                    "T"}], ",", 
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                   "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "@", "E0Values"}]}], "}"}]}], "]"}], 
                ",", 
                RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"1.1", 
                    RowBox[{"Max", "[", 
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "]"}]}]}], "}"}]}]}], "]"}], ",", 
              RowBox[{"Plot", "[", 
               RowBox[{
                RowBox[{"GFn", "[", "x", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", 
                  RowBox[{
                   RowBox[{"-", "E0Max"}], "/", "T"}], ",", 
                  RowBox[{"E0Max", "/", "T"}]}], "}"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"1.1", 
                    RowBox[{"Max", "[", 
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], 
                    "]"}]}]}], "}"}]}]}], "]"}], ",", 
              RowBox[{"Plot", "[", 
               RowBox[{
                RowBox[{
                 FractionBox[
                  RowBox[{"Df", "[", "x", "]"}], 
                  RowBox[{"Df", "[", "0", "]"}]], " ", "0.5", " ", 
                 RowBox[{"Max", "[", 
                  RowBox[{"tCond", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], 
                  "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", 
                  RowBox[{
                   RowBox[{"-", "E0Max"}], "/", "T"}], ",", 
                  RowBox[{"E0Max", "/", "T"}]}], "}"}], ",", 
                RowBox[{"PlotStyle", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"Gray", ",", "Dotted"}], "}"}]}]}], "]"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"pGS", "=", 
            RowBox[{"Show", "[", 
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "1"}], "\[RightDoubleBracket]"}], "/", 
                    "T"}], ",", 
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"i", ",", "3"}], "\[RightDoubleBracket]"}]}], 
                   "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "@", "E0Values"}]}], "}"}]}], "]"}], 
                ",", 
                RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"1.1", 
                    RowBox[{"Max", "[", 
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], 
                    "]"}]}]}], "}"}]}]}], "]"}], ",", 
              RowBox[{"Plot", "[", 
               RowBox[{
                RowBox[{"GSFn", "[", "x", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", 
                  RowBox[{
                   RowBox[{"-", "E0Max"}], "/", "T"}], ",", 
                  RowBox[{"E0Max", "/", "T"}]}], "}"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"1.1", 
                    RowBox[{"Max", "[", 
                    RowBox[{"tCond", "\[LeftDoubleBracket]", 
                    RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], 
                    "]"}]}]}], "}"}]}]}], "]"}], ",", 
              RowBox[{"Plot", "[", 
               RowBox[{
                RowBox[{
                 FractionBox[
                  RowBox[{"Df", "[", "x", "]"}], 
                  RowBox[{"Df", "[", "0", "]"}]], "0.5", " ", 
                 RowBox[{"Max", "[", 
                  RowBox[{"tCond", "\[LeftDoubleBracket]", 
                   RowBox[{"All", ",", "3"}], "\[RightDoubleBracket]"}], 
                  "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", 
                  RowBox[{
                   RowBox[{"-", "E0Max"}], "/", "T"}], ",", 
                  RowBox[{"E0Max", "/", "T"}]}], "}"}], ",", 
                RowBox[{"PlotStyle", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"Gray", ",", "Dotted"}], "}"}]}]}], "]"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"p", "=", 
            RowBox[{"GraphicsRow", "[", 
             RowBox[{"{", 
              RowBox[{"pG", ",", "pGS"}], "}"}], "]"}]}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"p", "=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"G", "=", 
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"Df", "[", "x", "]"}]}], 
            RowBox[{"GFn", "[", "x", "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{"-", "E0Max"}], "/", "T"}], ",", 
             RowBox[{"E0Max", "/", "T"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"GS", "=", 
         RowBox[{"NIntegrate", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"Df", "[", "x", "]"}]}], 
            RowBox[{"GSFn", "[", "x", "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{"-", "E0Max"}], "/", "T"}], ",", 
             RowBox[{"E0Max", "/", "T"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"G", ",", "GS", ",", "p", ",", "tCond", ",", "tS"}], 
         "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{"Transport", " ", "calculation"}], "Title"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{"G", ",", "GS", ",", "pTr", ",", "tCond", ",", "tS"}], "}"}], 
     "=", 
     RowBox[{"ConductanceT", "[", "params", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Conductance: \>\"", "<>", 
      RowBox[{"ToString", "[", "G", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Spin conductance: \>\"", "<>", 
      RowBox[{"ToString", "[", "GS", "]"}]}], "]"}], ";", 
    RowBox[{"Print", "[", "\"\<\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{"SmxFilename", ",", "tS", ",", "\"\<Package\>\""}], "]"}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
      RowBox[{"Export", "[", 
       RowBox[{
        RowBox[{"saveFilename", "<>", "\"\<Fig8.jpg\>\""}], ",", "pTr", ",", 
        "\"\<jpg\>\"", ",", 
        RowBox[{"ImageResolution", "\[Rule]", "300"}]}], "]"}]}], "]"}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Put", "[", 
     RowBox[{
      RowBox[{"Definition", "@", "hbar"}], ",", 
      RowBox[{"Definition", "@", "kB"}], ",", 
      RowBox[{"Definition", "@", "a0"}], ",", 
      RowBox[{"Definition", "@", "nxmaxBCS"}], ",", 
      RowBox[{"Definition", "@", "nzmaxBCS"}], ",", 
      RowBox[{"Definition", "@", "nxmaxTr"}], ",", 
      RowBox[{"Definition", "@", "nzmaxTr"}], ",", 
      RowBox[{"Definition", "@", "Nxmax"}], ",", 
      RowBox[{"Definition", "@", "Nzmax"}], ",", 
      RowBox[{"Definition", "@", "a"}], ",", 
      RowBox[{"Definition", "@", "\[Mu]"}], ",", 
      RowBox[{"Definition", "@", "T"}], ",", 
      RowBox[{"Definition", "@", "dV"}], ",", 
      RowBox[{"Definition", "@", "dz"}], ",", 
      RowBox[{"Definition", "@", "dx"}], ",", 
      RowBox[{"FullDefinition", "@", "Vg"}], ",", 
      RowBox[{"FullDefinition", "@", "\[Omega]x"}], ",", 
      RowBox[{"FullDefinition", "@", "\[Omega]z"}], ",", 
      RowBox[{"Definition", "@", "mass"}], ",", 
      RowBox[{"Definition", "@", "kFa"}], ",", 
      RowBox[{"Definition", "@", "kF"}], ",", 
      RowBox[{"Definition", "@", "\[Lambda]F"}], ",", 
      RowBox[{"Definition", "@", "lx"}], ",", 
      RowBox[{"Definition", "@", "lz"}], ",", 
      RowBox[{"Definition", "@", "yminBCS"}], ",", 
      RowBox[{"Definition", "@", "ymaxBCS"}], ",", 
      RowBox[{"Definition", "@", "yminTr"}], ",", 
      RowBox[{"Definition", "@", "ymaxTr"}], ",", 
      RowBox[{"Definition", "@", "f"}], ",", 
      RowBox[{"Definition", "@", "Df"}], ",", 
      RowBox[{"Definition", "@", "t\[CapitalDelta]0"}], ",", 
      RowBox[{"Definition", "@", "tCond"}], ",", 
      RowBox[{"Definition", "@", "saveFilename"}], ",", 
      RowBox[{"Definition", "@", "ParamsFilename"}], ",", 
      RowBox[{"Definition", "@", "t\[Epsilon]B"}], ",", 
      RowBox[{"Definition", "@", "SmxFilename"}], ",", "ParamsFilename"}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"To", " ", 
     RowBox[{"import", ":", " ", 
      RowBox[{"<<", 
       RowBox[{"(", 
        RowBox[{"saveFilename", "<>", "\"\<params.m\>\""}], ")"}]}]}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"NotebookSave", "[", "]"}], ";"}]}], "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Print", " ", "out", " ", "the", " ", "conductance", " ", "as", " ", "a",
       " ", "function", " ", "of", " ", "energy"}], "Code"], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", "\"\<tCond:\>\"", "]"}], ";", " ", 
    RowBox[{"Print", "[", "tCond", "]"}], ";", " ", 
    RowBox[{"Print", "[", "\"\<\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"NotebookSave", "[", "]"}], ";"}]}], "]"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", "\[IndentingNewLine]", 
   
   RowBox[{"(*", " ", 
    StyleBox[
     RowBox[{
     "Elapsed", " ", "time", " ", "and", " ", "memory", " ", "usage"}], 
     "Title"], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tEnd", "=", 
     RowBox[{"AbsoluteTime", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tTotal", "=", 
     RowBox[{"tEnd", "-", "tStart"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"days", "=", 
     RowBox[{"Floor", "[", 
      FractionBox["tTotal", "86400"], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"hrs", "=", 
     RowBox[{"Floor", "[", 
      FractionBox[
       RowBox[{"tTotal", "-", 
        RowBox[{"86400", " ", "days"}]}], "3600"], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"mins", "=", 
     RowBox[{"Ceiling", "[", 
      FractionBox[
       RowBox[{"tTotal", "-", 
        RowBox[{"86400", " ", "days"}], "-", 
        RowBox[{"3600", " ", "hrs"}]}], "60"], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", "\"\<\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Memory used: \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"Ceiling", "[", 
        RowBox[{
         RowBox[{"N", "@", 
          RowBox[{"MaxMemoryUsed", "[", "]"}]}], "/", 
         SuperscriptBox["10", "6"]}], "]"}], "]"}], "<>", "\"\< MB\>\""}], 
     "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Runtime: \>\"", "<>", 
      RowBox[{"ToString", "[", "days", "]"}], "<>", "\"\<-\>\"", "<>", 
      RowBox[{"ToString", "[", "hrs", "]"}], "<>", "\"\<:\>\"", "<>", 
      RowBox[{"ToString", "[", "mins", "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"ClusterRunQ", "\[Equal]", "0"}], ",", 
     RowBox[{
      RowBox[{"NotebookSave", "[", "]"}], ";"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.659406212744129*^9, 3.659406253387239*^9}, {
   3.659406446080264*^9, 3.6594064548357143`*^9}, 3.6594076656673603`*^9, {
   3.659408748786131*^9, 3.659408763487351*^9}}],

Cell[CellGroupData[{

Cell["\<\
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\
\
\>", "Print",
 CellChangeTimes->{3.6594079580932007`*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659407975829911*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659407998830201*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408020730997*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408041631646*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408051985025*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.6594080666945133`*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408084195348*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408094838407*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.65940811675758*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408127491519*^9}],

Cell[BoxData["\<\"t\[CapitalDelta]0:\"\>"], "Print",
 CellChangeTimes->{3.659408127521134*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.0000126`"}], ",", "1.7364428011564204`*^-38"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "0.0000112`"}], ",", "8.074353866009653`*^-38"}], "}"}], 
   ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "9.8`*^-6"}], ",", 
     RowBox[{"-", "8.787622283545229`*^-38"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "8.4`*^-6"}], ",", 
     RowBox[{"-", "6.241226867773848`*^-38"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "7.`*^-6"}], ",", 
     RowBox[{"-", "1.1066924526166176`*^-37"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "5.6`*^-6"}], ",", 
     RowBox[{"-", "6.88734485467937`*^-37"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "4.2`*^-6"}], ",", 
     RowBox[{"-", "2.4658832770949137`*^-36"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.8`*^-6"}], ",", "2.1826258365373158`*^-30"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.4`*^-6"}], ",", "3.223237844511226`*^-30"}], "}"}], ",", 
   
   RowBox[{"{", 
    RowBox[{"0.`", ",", "3.604789600859162`*^-30"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1.4`*^-6", ",", "3.223237844511226`*^-30"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"2.8`*^-6", ",", "2.1826258365373158`*^-30"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4.2`*^-6", ",", 
     RowBox[{"-", "2.4658832770949137`*^-36"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5.6`*^-6", ",", 
     RowBox[{"-", "6.88734485467937`*^-37"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"7.`*^-6", ",", 
     RowBox[{"-", "1.1066924526166176`*^-37"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"8.4`*^-6", ",", 
     RowBox[{"-", "6.241226867773848`*^-38"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"9.8`*^-6", ",", 
     RowBox[{"-", "8.787622283545229`*^-38"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.0000112`", ",", "8.074353866009653`*^-38"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.0000126`", ",", "1.7364428011564204`*^-38"}], "}"}]}], 
  "}"}]], "Print",
 CellChangeTimes->{3.659408127526699*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.65940812753011*^9}],

Cell[BoxData["\<\"Conductance: 1.74548\"\>"], "Print",
 CellChangeTimes->{3.659408158803543*^9}],

Cell[BoxData["\<\"Spin conductance: 0.343507\"\>"], "Print",
 CellChangeTimes->{3.659408158806629*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.6594081588095083`*^9}],

Cell[BoxData["\<\"tCond:\"\>"], "Print",
 CellChangeTimes->{3.6594081593489447`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "4.397365536200001`*^-30"}], ",", "0.02737554050042168`", 
     ",", "0.025083326305600506`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "4.1361798820570186`*^-30"}], ",", "0.5312268971663966`", 
     ",", "0.5214005954380613`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "3.8803804634787905`*^-30"}], ",", "0.9826479007054926`", 
     ",", "0.9805247916255122`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "3.630083179834653`*^-30"}], ",", "1.0054760703975798`", 
     ",", "0.9943941570935956`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "3.3854117519084656`*^-30"}], ",", "1.0168418124397764`", 
     ",", "0.9830843061212018`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "3.1464986434745653`*^-30"}], ",", "1.0090660915692073`", 
     ",", "0.9908802055480846`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.913486142495862`*^-30"}], ",", "1.0001753039053862`", 
     ",", "0.999814684136165`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.686527639362626`*^-30"}], ",", "1.0189459369270084`", 
     ",", "0.9811149508237887`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.4657891509076683`*^-30"}], ",", "1.0420947364756121`", 
     ",", "0.9580436893487471`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.2514511545344008`*^-30"}], ",", "1.0252841871648863`", 
     ",", "0.9749349739421956`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.0437108186666864`*^-30"}], ",", "1.0033410260017`", ",", 
     "0.9969697046228062`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.842784746977204`*^-30"}], ",", "1.1639748776615155`", 
     ",", "0.8369559439636789`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.6489123994436398`*^-30"}], ",", "1.4992157483845`", ",", 
     "0.5030947388361192`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.4623604214049461`*^-30"}], ",", "1.7412165912006472`", 
     ",", "0.2627503035745692`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.2834282163661542`*^-30"}], ",", "1.8615505987674392`", 
     ",", "0.14420753743705927`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.1124552638975691`*^-30"}], ",", "1.9198591184545934`", 
     ",", "0.0878127694891454`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "9.498309558192002`*^-31"}], ",", "1.950414226784609`", ",",
      "0.05923970018900415`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "7.96008189440778`*^-31"}], ",", "1.9678918619093775`", ",",
      "0.04366291283336954`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "6.515227954273585`*^-31"}], ",", "1.978616730801606`", ",",
      "0.03465351742765754`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "5.170224852571273`*^-31"}], ",", "1.9854818958022937`", 
     ",", "0.029238039048045006`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "3.933123304343205`*^-31"}], ",", "1.989913633441509`", ",",
      "0.02593676574011472`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "2.8143139431680014`*^-31"}], ",", "1.992703773475597`", 
     ",", "0.02395701518795812`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1.8279505267561826`*^-31"}], ",", "1.994329322788006`", 
     ",", "0.022838609855606706`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "9.950102368009718`*^-32"}], ",", "1.9951434027198591`", 
     ",", "0.0222869737799285`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "3.5178924289600056`*^-32"}], ",", "1.9954409432892175`", 
     ",", "0.02208749920759756`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0.`", ",", "1.9954834289141115`", ",", "0.022059182023844603`"}],
     "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "3.5178924289600056`*^-32", ",", "1.995440990137102`", ",", 
     "0.02208754605548957`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "9.95010236800974`*^-32", ",", "1.995143533341301`", ",", 
     "0.022287104401389146`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.827950526756185`*^-31", ",", "1.9943295766988398`", ",", 
     "0.022838863766441064`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.8143139431679983`*^-31", ",", "1.9927042662744483`", ",", 
     "0.023957507986813398`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "3.933123304343205`*^-31", ",", "1.9899144764533503`", ",", 
     "0.02593760875196227`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "5.170224852571273`*^-31", ",", "1.9854828613896378`", ",", 
     "0.029239004635359556`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "6.515227954273585`*^-31", ",", "1.9786177054520873`", ",", 
     "0.03465449207813909`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "7.960081894407783`*^-31", ",", "1.9678939231948325`", ",", 
     "0.04366497411882797`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "9.498309558192007`*^-31", ",", "1.9504198457206783`", ",", 
     "0.059245319125049156`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.1124552638975695`*^-30", ",", "1.9198722963463073`", ",", 
     "0.08782594738086169`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.2834282163661542`*^-30", ",", "1.8615780287150248`", ",", 
     "0.1442349673846447`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.4623604214049461`*^-30", ",", "1.7413034244319134`", ",", 
     "0.2628371368058513`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.6489123994436398`*^-30", ",", "1.4995657996192233`", ",", 
     "0.5034447900708409`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "1.842784746977204`*^-30", ",", "1.1656368141811804`", ",", 
     "0.838617880483344`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.0437108186666867`*^-30", ",", "1.0176387337333443`", ",", 
     "1.0112674123544514`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.251451154534401`*^-30", ",", "1.1702302318249849`", ",", 
     "1.1198810186022936`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.4657891509076683`*^-30", ",", "1.7190725849616553`", ",", 
     "1.6350215378347897`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.686527639362626`*^-30", ",", "1.9823066683474142`", ",", 
     "1.9444756822441946`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "2.913486142495862`*^-30", ",", "1.9974333279204184`", ",", 
     "1.9970727081511974`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "3.1464986434745653`*^-30", ",", "2.008949926927392`", ",", 
     "1.990764040906269`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "3.3854117519084656`*^-30", ",", "2.017107058983959`", ",", 
     "1.9833495526653846`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "3.630083179834653`*^-30", ",", "2.006976957168588`", ",", 
     "1.9958950438646035`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "3.8803804634787905`*^-30", ",", "2.0094900675864196`", ",", 
     "2.0073669585064393`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "4.1361798820570186`*^-30", ",", "2.05378849684612`", ",", 
     "2.0439621951177847`"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
    "4.397365536200001`*^-30", ",", "2.2412047399527775`", ",", 
     "2.2389125257579563`"}], "}"}]}], "}"}]], "Print",
 CellChangeTimes->{3.659408159358838*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408159364645*^9}],

Cell[BoxData["\<\"\"\>"], "Print",
 CellChangeTimes->{3.659408159431653*^9}],

Cell[BoxData["\<\"Memory used: 132 MB\"\>"], "Print",
 CellChangeTimes->{3.659408159441701*^9}],

Cell[BoxData["\<\"Runtime: 0-0:4\"\>"], "Print",
 CellChangeTimes->{3.6594081594445543`*^9}]
}, Open  ]]
}, Open  ]]
},
Evaluator->"Kernel2",
WindowSize->{1259, 724},
WindowMargins->{{Automatic, 9}, {3, Automatic}},
FrontEndVersion->"10.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September 9, \
2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 300436, 7350, 23098, "Input"],
Cell[CellGroupData[{
Cell[301041, 7376, 468, 8, 21, "Print"],
Cell[301512, 7386, 76, 1, 21, "Print"],
Cell[301591, 7389, 76, 1, 21, "Print"],
Cell[301670, 7392, 76, 1, 21, "Print"],
Cell[301749, 7395, 76, 1, 21, "Print"],
Cell[301828, 7398, 76, 1, 21, "Print"],
Cell[301907, 7401, 78, 1, 21, "Print"],
Cell[301988, 7404, 76, 1, 21, "Print"],
Cell[302067, 7407, 76, 1, 21, "Print"],
Cell[302146, 7410, 75, 1, 21, "Print"],
Cell[302224, 7413, 76, 1, 21, "Print"],
Cell[302303, 7416, 94, 1, 21, "Print"],
Cell[302400, 7419, 2187, 64, 86, "Print"],
Cell[304590, 7485, 75, 1, 21, "Print"],
Cell[304668, 7488, 96, 1, 21, "Print"],
Cell[304767, 7491, 102, 1, 22, "Print"],
Cell[304872, 7494, 78, 1, 21, "Print"],
Cell[304953, 7497, 84, 1, 21, "Print"],
Cell[305040, 7500, 7540, 206, 266, "Print"],
Cell[312583, 7708, 76, 1, 21, "Print"],
Cell[312662, 7711, 76, 1, 21, "Print"],
Cell[312741, 7714, 95, 1, 22, "Print"],
Cell[312839, 7717, 92, 1, 21, "Print"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
